var BF_UniversalDOM=function(){this.UNIVERSAL_DOM_CLASS="bf_dom";this.UNIVERSAL_DOM_ATTR="rel:bf_bucket";this.UNIVERSAL_DOM_DATA_ATTR="rel:bf_bucket_data";this.UNIVERSAL_DOM_BUCKET_DATA_ATTR="rel:bf_data";this._bucket={};this._element_assignment_lookup={};this.init=function(){universal_dom._bucket={};$$("."+universal_dom.UNIVERSAL_DOM_CLASS).each(function(el){universal_dom._assign(el)})};this.get_bucket_elements=function(bucket){if(typeof universal_dom._bucket[bucket]=="undefined"){return[]}var elements=[];universal_dom._bucket[bucket].elements.each(function(obj){elements.push(obj.element)});return elements};this.get_bucket_elements_with_data=function(bucket,data){if(typeof universal_dom._bucket[bucket]=="undefined"){return[]}var elements=[];universal_dom._bucket[bucket].elements.each(function(el){var matches=true;for(var each in data){if(typeof el.data[each]=="undefined"||el.data[each]!=data[each]){matches=false}}if(matches){elements.push(el.element)}});return elements};this.class_regex=new RegExp(this.UNIVERSAL_DOM_CLASS);this.update=function(snippet){var s=$(snippet);if(s){var elements=s.select('[class~="'+universal_dom.UNIVERSAL_DOM_CLASS+'"]');if(elements.length==0&&s.innerHTML.match(universal_dom.class_regex)){elements=new Array();universal_dom.extract_dom_class_elements(snippet,elements)}if(s.hasClassName(this.UNIVERSAL_DOM_CLASS)){elements.push(s)}elements.each(function(el){universal_dom._assign(el)})}};this.extract_dom_class_elements=function(snippet,list){if(snippet.className&&snippet.className.match(universal_dom.class_regex)){list.push(snippet)}for(var i=0;i<snippet.childNodes.length;i++){universal_dom.extract_dom_class_elements(snippet.childNodes[i],list)}};this.assign_handler=function(obj){var bucket=obj.bucket;var handler=obj.handler;var event=obj.event||"immediate";var needs_to_be_added=true;var my_bucket=universal_dom._bucket[bucket]||{};var handlers=my_bucket.handlers||{};var handler_list=handlers[event]||[];handler_list.each(function(fn){if(fn==handler){needs_to_be_added=false}});if(needs_to_be_added){handler_list.push(handler);handlers[event]=handler_list;my_bucket.handlers=handlers;universal_dom._bucket[bucket]=my_bucket}universal_dom._assign_handler(bucket)};this.add_element_to_bucket=function(obj){var bucket=obj.bucket;var element=obj.element;var data=obj.data;var the_bucket=universal_dom._bucket[bucket]||{};var bucket_elements=the_bucket.elements||[];bucket_elements.push({element:element,data:data});the_bucket.elements=bucket_elements;universal_dom._bucket[bucket]=the_bucket;universal_dom._assign_handler(bucket);var assigned_to_buckets=universal_dom._element_assignment_lookup[element]||[];assigned_to_buckets.push(bucket);universal_dom._element_assignment_lookup[element]=assigned_to_buckets};this.remove_element_from_buckets=function(element){var buckets=universal_dom._element_assignment_lookup[element];if(buckets){buckets.each(function(bucket){var new_bucket_elements=[];universal_dom._bucket[bucket].elements.each(function(el){if(el.element!=element){new_bucket_elements.push(el)}});universal_dom._bucket[bucket].elements=new_bucket_elements})}};this.refresh_immediate_bucket=function(bucket){if(universal_dom._bucket[bucket].elements){universal_dom._bucket[bucket].elements.each(function(obj){if(universal_dom._bucket[bucket].handlers.immediate){universal_dom._bucket[bucket].handlers.immediate.each(function(fn){fn(obj.element,obj.data)})}})}};this._assign_handler=function(for_bucket){var bucket=universal_dom._bucket[for_bucket];var handlers=bucket.handlers;if(typeof bucket.elements=="undefined"){bucket.elements=[]}for(var i=0;i<bucket.elements.length;i++){var element=bucket.elements[i].element;var data=bucket.elements[i].data;data.element=element;for(var event in handlers){handlers[event].each(function(fn){var assigned=data.assigned||{};if(typeof assigned[fn.toString()]=="undefined"){if(event=="immediate"){fn(element,data)}else{var cl=Object.clone(data);element.observe(event,function(e){for(var each in cl){e[each]=cl[each]}fn(e)})}}assigned[fn.toString()]=true;data.assigned=assigned;universal_dom._bucket[for_bucket].elements[i].data=data})}}};this._assign=function(el){if(el.hasAttribute(this.UNIVERSAL_DOM_ATTR)){this.bucket_attr(el)}else{if(el.hasAttribute(this.UNIVERSAL_DOM_DATA_ATTR)){this.bucket_data_attr(el)}else{}}};this.update_or_add_element_in_bucket=function(obj){var bucket=obj.bucket;var element=obj.element;var data=obj.data;var b=universal_dom._bucket[bucket];if(typeof b=="undefined"||typeof b.elements=="undefined"||b.elements.length==0){universal_dom.add_element_to_bucket({bucket:bucket,element:element,data:data});return}var exists=0;b.elements.each(function(b_element,index){if(b_element.element==element){b.elements[index].data=data;exists=1;throw $break}});if(!exists){universal_dom.add_element_to_bucket({bucket:bucket,element:element,data:data})}};this.bucket_attr=function(el){var bucket="";try{bucket=el.getAttribute(universal_dom.UNIVERSAL_DOM_ATTR);var data={};var data_attr=el.getAttribute(universal_dom.UNIVERSAL_DOM_BUCKET_DATA_ATTR);if(data_attr){data=eval("("+data_attr+")")}var buckets=bucket.split(" ");buckets.each(function(bucket_name){universal_dom.update_or_add_element_in_bucket({element:el,bucket:bucket_name,data:data})})}catch(e){console.error(e+bucket+el.id+universal_dom.UNIVERSAL_DOM_BUCKET_DATA_ATTR)}};this.bucket_data_attr=function(el){var data=el.getAttribute(universal_dom.UNIVERSAL_DOM_DATA_ATTR);try{var obj=eval("("+data+")")}catch(e){console.error("Failed to parse JSON ("+data+") for element "+el+" (id:"+el.id+",class:"+el.className+",tag:"+el.tagName+")")}for(var bucket_name in obj){universal_dom.update_or_add_element_in_bucket({element:el,bucket:bucket_name,data:obj[bucket_name]})}};this.remove_bucket_elements=function(array_of_buckets){array_of_buckets.each(function(bucket){if(typeof universal_dom._bucket[bucket]!="undefined"){delete universal_dom._bucket[bucket].elements}})};this.assign_ids_to_elements_in_bucket=function(bucket,callback){universal_dom._bucket[bucket].elements.each(function(el,idx){if(typeof el.element!="undefined"&&!el.element.id){el.element.id=callback(idx)}})}};var universal_dom=new BF_UniversalDOM();universal_dom.init();universal_dom.assign_handler({bucket:"toggle",event:"click",handler:function(b){b.stop();var a=function(c){if(c.style.display=="none"){c.toggle()}else{if(c.hasClassName("hidden")){c.removeClassName("hidden")}else{c.addClassName("hidden")}}};if(typeof b.el!="undefined"){a($(b.el))}if(typeof b.els!="undefined"){b.els.each(function(c){a($(c))})}}});universal_dom.assign_handler({bucket:"stop",event:"click",handler:Event.stop});BF_ProgLoad_Images=function(){this.images=new Hash();this.index=1;this.DEBUG=false;this.bad_browser=0;this.autoload=false;this.autoload_interval=1000;this.min_lookahead_pixels=400;this.init_total_delay=0;this.init_max_delay=10000;this.init_delay_interval=250;var a=this;this.init=function(){bf_prog_load.media=new Hash();if(document.location.search.match(/progload_debug=true/)){this.DEBUG=true;console.debug("init progressive image loader...")}try{this.lookahead_pixels=document.viewport.getHeight();if(window.BF_IS_TOP_LIST&&this.lookahead_pixels<2000){this.lookahead_pixels=2000}if(this.lookahead_pixels<a.min_lookahead_pixels&&a.init_total_delay<a.init_max_delay){a.init_total_delay+=a.init_delay_interval;setTimeout(bf_prog_load.init,a.init_delay_interval);return}var c=document.viewport.getScrollOffsets();var b=c[1];b=document.viewport.getHeight()+b;universal_dom.get_bucket_elements("progload").each(function(g){var f=g.getAttribute("rel:bf_image_src");var e=g.cumulativeOffset()[1];if(bf_prog_load.DEBUG){console.log("INIT viewport: %s image offset: %s image: %s lookahead: %s pixels",b,e,f,bf_prog_load.lookahead_pixels);g.title=e}if(b>(e-bf_prog_load.lookahead_pixels)){if(bf_prog_load.DEBUG){g.style.border="solid red 1px"}a.load_image(g,((f.indexOf("http://")==0)?f:BF_STATIC.image_root+f))}else{var h={el:g,position:e,src:f};bf_prog_load.media.set(""+bf_prog_load.index,h);bf_prog_load.index++}});universal_dom.get_bucket_elements("progload_video").each(function(g){var f=g.cumulativeOffset()[1];bf_prog_load.media.set(""+bf_prog_load.index,{data:g,position:f,type:"video"});bf_prog_load.index++});if((Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6)||Prototype.Browser.Opera||!!window.fb_app){bf_prog_load.bad_browser=1;setTimeout(function(){bf_prog_load.scrolled("all")},500)}else{Event.observe(window,"scroll",function(f){bf_prog_load.scrolled()})}}catch(d){console.error(d)}universal_dom.assign_handler({bucket:"add_to_prog_load",handler:bf_prog_load.add});a.autoload_images()};this.autoload_images=function(){a.autoload=true;if(a.DEBUG){console.info("Starting image autoload")}var b;b=setInterval(function(){if(!bf_prog_load.media.size()){if(a.DEBUG){console.info("End image autoload")}a.autoload=false;clearInterval(b)}else{bf_prog_load.media.each(function(d){if(!d.value.type){var c=d.value.el.getAttribute("rel:bf_image_src");if(c==d.value.el.src){return}if(a.DEBUG){d.value.el.style.border="solid orange 1px"}a.load_image(d.value.el,((d.value.src.indexOf("http://")==0)?d.value.src:BF_STATIC.image_root+d.value.src));bf_prog_load.media.unset(d.key);throw $break}})}},a.autoload_interval)};this.image_watcher=function(c,e,d,b){this.maxRetries=3;this.retry=0;this.retryTimeout=[10000,20000,30000];this.el=c;this.src=e;this.success=d;this.error=b;this.load=function(){if(a.DEBUG){console.log((this.retry==0?"First":("Try #"+this.retry))+" load "+this.src)}this.image=new Image();this.image.onload=function(f){return function(){f.onsuccess.call(f)}}(this);this.image.onabort=function(f){return function(){f.timeout.call(f)}}(this);this.image.onerror=function(f){return function(){f.timeout.call(f)}}(this);this.image.src=this.src};this.onsuccess=function(){this.image=null;this.success(this)};this.timeout=function(){this.image=null;if(this.retry>=this.maxRetries){this.error(this);return}if(a.DEBUG){console.log("Waiting "+this.retryTimeout[this.retry]+" ms on "+this.src)}setTimeout(function(f){return function(){f.load.call(f)}}(this),this.retryTimeout[this.retry]);this.retry++}};this.load_image=function(b,c){new this.image_watcher(b,c,function(d){if(a.DEBUG){console.info("Image %s was loaded successfully.",d.src)}b.src=c},function(d){if(a.DEBUG){console.error("Image %s wasn't loaded.",d.src)}b.src=BF_STATIC.image_root+"/static/images/public/backgrounds/trans.gif"}).load()};this.scrolled=function(b){try{bf_prog_load.media.each(function(f){var e=document.viewport.getScrollOffsets();var d=e[1];d=document.viewport.getHeight()+d;if(d>(f.value.position-bf_prog_load.lookahead_pixels)||b){if(bf_prog_load.DEBUG){console.log("SCROLL viewport: %s image offset: %s image: %s",d,f.value.position,f.value.src);if(b){f.value.el.style.border="solid green 1px"}else{f.value.el.style.border="solid blue 1px"}}if(f.value.data){embed_video.load_video(f.value.data,true)}else{a.load_image(f.value.el,((f.value.src.indexOf("http://")==0)?f.value.src:BF_STATIC.image_root+f.value.src))}bf_prog_load.media.unset(f.key)}})}catch(c){console.error(c)}};this.add=function(f){var d=f.getAttribute("rel:bf_image_src");var b=f.cumulativeOffset()[1];var g=document.viewport.getScrollOffsets();var c=g[1];c=document.viewport.getHeight()+c;if(c>(b-bf_prog_load.lookahead_pixels)||bf_prog_load.bad_browser){if(bf_prog_load.DEBUG){f.style.border="solid yellow 1px";console.log("SHOW (add). offset: %s image: %s lookahead: %s pixels",b,d,bf_prog_load.lookahead_pixels)}a.load_image(f,((d.indexOf("http://")==0)?d:BF_STATIC.image_root+d))}else{var i={el:f,position:b,src:d};if(bf_prog_load.DEBUG){console.log("ADDING image. offset: %s image: %s lookahead: %s pixels",b,d,bf_prog_load.lookahead_pixels)}bf_prog_load.media.set(""+bf_prog_load.index,i);bf_prog_load.index++;if(!a.autoload){a.autoload_images()}}var e=f.getAttribute("rel:bf_bucket");var h=e.replace("add_to_prog_load","xx");f.setAttribute("rel:bf_bucket",h)}};var bf_prog_load=new BF_ProgLoad_Images();BuzzLoader.register(function(){bf_prog_load.init()},2);var SigninAnywhere=function(){this.init=function(){universal_dom.assign_handler({bucket:"SigninAnywhere.open",event:"click",handler:signin_anywhere.open});universal_dom.assign_handler({bucket:"SigninAnywhere.close",event:"click",handler:signin_anywhere.close});universal_dom.assign_handler({bucket:"sign-in",event:"click",handler:signin_anywhere.reset});signin_anywhere.dialog=null;bf_login.init({current_page:"signin_anywhere"})};this.close=function(){if(signin_anywhere.dialog){signin_anywhere.dialog.hide()}};this.open=function(h){var i=document.getElementsByTagName("BODY");if(!i){return}var n=$(h.el);var f;var l;var c="login";if(signin_anywhere.dialog){l=signin_anywhere.dialog;j=l.getElementsByTagName("IFRAME")[0];if((new BF_User().isLoggedIn())){if(typeof h.logged_in_iframe_url!="undefined"){j.src=h.logged_in_iframe_url;c="react"}}else{j.src=BF_STATIC.web_root+"/signin_anywhere?logged_in_iframe_url="+h.logged_in_iframe_url}l.show()}else{l=document.createElement("div");l.id="signin_anywhere_container";var j=document.createElement("iframe");j.id="signin_anywhere_iframe";if((new BF_User().isLoggedIn())){if(typeof h.logged_in_iframe_url!="undefined"){j.src=h.logged_in_iframe_url;c="react"}}else{j.src=BF_STATIC.web_root+"/signin_anywhere"+(h.logged_in_iframe_url?"?logged_in_iframe_url="+h.logged_in_iframe_url:"")}i[0].appendChild(l);signin_anywhere.dialog=l;signin_anywhere.loading=f;l.insert(j);universal_dom.update(l)}if(c=="login"){var d={width:620,height:520};if(Prototype.Browser.IE){d.height=560}var g=i[0].getDimensions();var m=Math.round(parseInt(g.width)/2-parseInt(d.width)/2);var k=n.cumulativeOffset().top-200;var e={top:k+"px",left:m+"px"};f=document.createElement("div");f.id="signin_anywhere_loading";f.innerHTML='<img src="/static/images/public/spinners/big_on_e6e6e6.gif" style="margin:'+d.height/2+"px "+(d.width/2-15)+'px;" />';f.setStyle({left:m,top:k});l.setStyle({zIndex:"1001",padding:"20px 0px 0px 0px",display:"block",position:"absolute",top:e.top,left:e.left,background:"#fff","box-shadow":"2px 2px 2px #888",width:d.width+"px",height:d.height+"px",border:"1px solid #000"});l.insert({top:f});j.setStyle({width:d.width+"px",height:d.height+"px"});if(!$("exit_bar")){var b='					<div id="exit_bar" style="width:100%;height:25px;background-color:#000000; position: absolute; top: 0px;"> 					<a class="bf_dom" style="float:right;color:white;margin:2px 5px; font-size:16px; font-family:Helvetica; font-weight:bold;" onclick="signin_anywhere.close();" href="javascript:;">x</a> 					</div> 				';l.insert({top:b})}}else{if(c="react"){a(n,l,j)}}j.observe("load",function(){if((new BF_User()).isLoggedIn()){(new BF_UserNav()).init()}if(f){f.hide()}var o=$("signin_anywhere_iframe").contentWindow.document.getElementById("social-actions");if(o){o.observe("set:reaction",function(p){a(n,l,j);if($("reaction-message")){$("reaction-message").addClassName("reaction-complete")}if(n.hasClassName("heart")){n.up().addClassName("deactivated")}else{n.addClassName("deactivated")}})}else{window.parent.bf_login.loggedInCallbacks.push(function(){signin_anywhere.close()})}});function a(s,p,r){r.addClassName("hidden");p.addClassName("hidden");var o=' 			<div id="reaction-message"> 				<span class="icon timetoshare"></span> 				<span class="icon checkmark"></span> 				<h3>Yes! Share it with friends</h3> 			</div> 			';if(!$("reaction-message")){if($(s).up(".splash_dfp_story")){s.up("div").insert({after:o})}else{if($$(".one_vid").length>0){$$(".badges.one_vid")[0].insert({bottom:o});$("reaction-message").setStyle({width:"410px"});$$(".icon.timetoshare")[0].hide();var q=new RegExp("^[0-9]+");var t=q.exec("150px");$$(".video-module-sharing.one_vid")[0].setStyle({left:(t*1+290)+"px"})}}}}};this.reset=function(){$("new-registration-form").hide();$("login-form").show()}};var signin_anywhere=new SigninAnywhere();BuzzLoader.register(function(){signin_anywhere.init()},2);var BF_SignIn=function(){this.wrap;this.section;this.overlay;this.signin_page;this.social_register=false;this.email_updates=0;this.reg_name;this.email;this.fb_done=0;this.fb_edit;this.spin_el;this.modal_type;this.modal_mode;this.page_location;this.callbacks={onLogin:[],onRegister:[]};this.keydown_enabled=true;this.mousedown_enabled=true;this.close_enabled=true;this.mask_hidden=true;this.signup_test=false;this.opened=false;this.is_gplus=false;this.android_app_package="com.buzzfeed.android";this.html={section_wrapper:'<div class="signin_section" id="signin_modal" rel:gt_cat="'+BF_STATIC.tt_page+':Signin-Modal"><a href="javascript:;" onclick="signin.close()" class="signin_close" rel:gt_act="sign-in-close">&times;</a><div class="signin_content">#{content}</div></div>',section_content:{initial:'				<div class="signin_upper">					<div class="msg-text" id="initial-msg"></div>					<header id="initial_header">'+local.t("Sign in here!")+'</header>					<a href="javascript:;" onclick="signin.fb_login()" class="fb-button bf_dom" rel:gt_act="initial-fb-sign">						<div class="fb-icon">&nbsp;</div>						<div class="fb-label" id="initial_fb_text">'+local.t("Sign in with Facebook")+'</div>					</a>  					<a class="bf-gplus-button bf_dom hidden" id="gplus-signin-button" rel:gt_act="googleplus-signin">  					<span id="g-signin-button"></span>  					<div class="gplus-icon">&nbsp;</div>					<div class="gplus-label" id="initial_gplus_text"><span class="visually-hidden">'+local.t("Sign in with Google")+'</span></div>  					</a>				  </div>				<div class="signin_sep"></div>				<div class="signin_lower">					<span class="mid-text hide_for_non_english"> You can also:&nbsp; <a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="email_signup" rel:gt_act="sign-up" id="signup-email">Sign up with email</a></span>					<span class="mid-text"> '+local.t("Have an account?")+'&nbsp; <a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="signin" rel:gt_act="sign-in" id="signin-initial">'+local.t("Sign in")+'</a></span>				</div>				<div class="brand_publisher-text"><a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="brand_publisher_signup" rel:gt_act="sign-up" id="signin-brand_publisher">'+local.t("Create an account")+"</a>&nbsp;"+local.t("for your brand or organization")+'</div>				<div class="bottom-text">'+local.t("By signing up for BuzzFeed, you agree to our")+'&nbsp;<a href="'+BF_STATIC.web_root+'/about/useragreement" target="_blank">'+local.t("Terms and Conditions")+"</a></div>			",signin:'				<div class="signin_upper">					<header>'+local.t("Sign In To BuzzFeed")+'</header>					<form id="login-form">						<input rel:gt_act="email-signin-input" id="login-username" class="bf_dom initial-field-state" type="text" rel:bf_bucket="event_handler" 						       rel:actions="change:map_into focus:clear_default_field blur:restore_default_field" defaultvalue="'+local.t("Username")+'" value="'+local.t("Username")+'">						<span id="reg_error_username" class="hidden"></span>						<input rel:gt_act="email-signin-input" id="login-password" class="bf_dom initial-field-state" type="password" rel:bf_bucket="event_handler" 						       rel:actions="change:map_into change:mark_as_edited focus:clear_default_field blur:restore_default_field" rel:data="{clear_default_field:{set_type:\'password\'}, mark_as_edited:{set_type:\'password\'}}" 						       defaultvalue="'+local.t("Password")+'" value="'+local.t("Password")+'">						<button rel:gt_act="signin" onclick="signin.login(this)" id="login-submit" class="bf_dom button2 submit">'+local.t("Sign in")+'</button>					</form>					<a class="trouble_signin" rel:type_data="trouble_signin" onclick="signin.set_template(this)" rel:gt_act="trouble_signin" id="forgot-password-link">'+local.t("Trouble Signing In?")+'</a>				</div>				<div class="signin_sep"></div>				<div class="signin_lower">						<span class="mid-text hide_for_non_english"> You can also:&nbsp; <a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="email_signup" rel:gt_act="also-signup">Sign Up With Email</a></span>						<a href="javascript:;" onclick="signin.fb_login()" class="fb-button-small" rel:gt_act="signin-fb"><div class="fb-icon">&nbsp;</div><div class="fb-label">'+local.t("Sign in with Facebook")+'</div></a>						<a class="bf-gplus-button-small bf_dom hidden" id="gplus-signin-button" rel:gt_act="googleplus-signin" rel:gt_label="googleplus">	  					<span id="g-signin-button"></span>	  					<div class="gplus-icon">&nbsp;</div>						<div class="gplus-label" id="initial_gplus_text"><span class="visually-hidden">'+local.t("Sign in with Google")+'</span></div>						</a>	  			</div>				<div class="bottom-text">'+local.t("Sign up for BuzzFeed to react, comment, or publish your own ideas!")+"</div>			",trouble_signin:'				<div class="signin_upper trouble_sign">					<header>'+local.t("Trouble Signing In?")+'</header>					<span class="mid-text">'+local.t("Enter the email address for your account and we'll send you your username and a link to reset your password.")+'</span>					<form id="forgot-password-form">						<input rel:gt_act="ignore" type="text" id="login-email" class="bf_dom initial-field-state" type="text" rel:bf_bucket="event_handler" 						       rel:actions="change:map_into focus:clear_default_field blur:restore_default_field" defaultvalue="'+local.t("Email address")+'" value="'+local.t("Email address")+'">						<div id="reg_error_email" class="hidden"></div>						<button onclick="signin.reset_password()" id="forgot-password-submit" type="submit" value="Reset Password" class="button2" >'+local.t("Reset Password")+'</button>					</form>					<a href="javascript:;" rel:type_data="signin" onclick="signin.set_template(this)" rel:gt_act="cancel-trouble-signin">'+local.t("Cancel")+'</a>				</div>				<div class="signin_lower"></div>			',trouble_signin_resp:'				<div class="signin_upper trouble_resp" id="request_pw_response">					<header>'+local.t("Trouble Signing In?")+'</header>					<div class="account_details">						<p id="password_text">'+local.t("OK, check your email - we've sent you a link to reset your password")+'</p>						<span class="green_check"></span>					</div>				</div>				<div class="signin_lower trouble_resp">					<a href="javascript:;" rel:type_data="signin" onclick="signin.set_template(this)" rel:gt_act="back-to-signin">'+local.t("Back to Sign in")+"</a>				</div>			",fb_signup:'				<div id="signup_form_wrap">					<div id="signup_complete">						<header id="custom-reg-message">'+local.t("Welcome to BuzzFeed!")+'</header>						<span class="mid-text">'+local.t("Here's your new BuzzFeed account:")+'</span>						<div class="account_details fb_account">							<div class="tooltip_content fb_tooltip hidden hide_for_non_english" id="user-image_tooltip">								<p>'+local.t('You can change your profile picture on your <a href="/settings">settings page</a>')+'</p>								<span class="arrow_down">&nbsp;</span>							</div>							<div class="tooltip_content fb_tooltip hidden hide_for_non_english" id="reg_username_tooltip">								<p>'+local.t("Click the edit button to the right to modify your display name")+'</p>								<span class="arrow_down">&nbsp;</span>							</div>							<div class="tooltip_content fb_tooltip hidden hide_for_non_english" id="reg_url_tooltip">								<p>'+local.t("Click the edit button above to modify your custom buzzfeed URL")+'</p>								<span class="arrow_up">&nbsp;</span>							</div>							<a href="javascript:;" onclick="signin.fb_update(this)" class="edit_pencil" id="edit_update" rel:gt_act="edit-user-info">&nbsp;</a>							<a href="javascript:;" onclick="signin.cancel_fb_update(false, null, null)" class="edit_cancel hidden" id="cancel_update" rel:gt_act="cancel-edit-user-info">&nbsp;</a>							<span class="default_image"><img src="" id="user-image"/></span>							<span class="register_username" id="reg_username"></span>							<input rel:gt_act="ignore" type="text" id="update_display_name" class="hidden" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" 							       rel:actions="keyup:filter_chars focus:clear_default_field change:map_into blur:restore_default_field" 							       rel:data="{filter_chars:{disallow:/[^A-Za-z0-9]/g},map_into:{target:\'submit-button\',field:\'register.username\'}}" rel:gt_act="ignore">							<span id="reg_error_displayname" class="hidden"></span>							<div class="register_url" id="reg_url"><span style="float:left">http://buzzfeed.com/</span><span class="register_link" id="reg_link"></span><input rel:gt_act="ignore" type="text" id="update_user_name" class="hidden" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" rel:actions="keyup:filter_chars focus:clear_default_field change:map_into blur:restore_default_field" rel:data="{filter_chars:{disallow:/[^A-Za-z0-9]/g},map_into:{target:\'submit-button\',field:\'register.username\'}}" rel:gt_act="ignore"></div>							<span id="reg_error_new_username" class="hidden new_user_error"></span>						</div>					</div>				</div>			',email_signup:'				<div id="signup_form_wrap">					<div class="signin_upper" >						<header>'+local.t("Sign up with email")+'</header>						<form id="registration-form">							<input id="register-username"  rel:gt_act="sign-up-input" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" type="text" value="'+local.t("Pick a Username")+'" 							       rel:actions="keyup:filter_chars focus:clear_default_field change:map_into blur:restore_default_field" 							       rel:data="{filter_chars:{disallow:/[^A-Za-z0-9]/g},map_into:{target:\'submit-button\',field:\'register.username\'}}" />							<span id="reg_error_username" class="hidden"></span>							<input id="register-password" rel:gt_act="sign-up-input" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" type="password" 							       value="'+local.t("Create a Password")+'" rel:actions="focus:clear_default_field change:map_into blur:restore_default_field" 							       rel:data="{clear_default_field:{set_type:\'password\'},map_into:{target:\'submit-button\',field:\'register.pw\'}}" autocomplete="off" />							<span id="reg_error_pw" class="hidden"></span>							<input id="register-email" rel:gt_act="sign-up-input" class="initial-field-state bf_dom" rel:bf_bucket="event_handler" type="text" 							       value="'+local.t("Enter Your Email")+'" rel:actions="focus:clear_default_field change:map_into blur:restore_default_field" 							       rel:data="{map_into:{target:\'submit-button\',field:\'register.email\'}}" />							<span id="reg_error_email" class="hidden"></span>							<div class="bf_email_check">								<label for="email_signup"><input rel:gt_act="checkbox" type="checkbox" id="email_signup" checked="true"> '+local.t("Let me know when BuzzFeed launches cool stuff")+'</label>							</div>							<button id="register-button" class="bf_dom button2 submit" onclick="signin.register(this)" rel:gt_act="email-signup">'+local.t("Sign Up")+'</button>						</form>						<div class="signup_terms">'+local.t('By signing up for BuzzFeed, you agree to our <a href="http://www.buzzfeed.com/about/useragreement" target="_blank">Terms and Conditions</a>')+'</div>					</div>					<div class="signin_sep"></div>					<div class="signin_lower">						<span class="mid-text"> '+local.t("Have an account?")+'&nbsp; <a href="javascript:;" onclick="signin.set_template(this)" rel:type_data="signin" rel:gt_act="signin-screen">'+local.t("Sign in")+'</a></span>						<div class="signin_lower_social">							<a href="javascript:;" onclick="signin.fb_login()" class="fb-button-small" rel:gt_act="fb_signup"><div class="fb-icon">&nbsp;</div><div class="fb-label">'+local.t("Sign up with Facebook")+'</div></a>							<a class="bf-gplus-button-small bf_dom hidden" id="gplus-signin-button" rel:gt_act="googleplus-signin" rel:gt_label="googleplus">		  					<span id="g-signin-button"></span>		  					<div class="gplus-icon">&nbsp;</div>							<div class="gplus-label gplus-label-signup" id="initial_gplus_text"><span class="visually-hidden">'+local.t("Sign up with Google")+'</span></div>							</a>						</div>					</div>					<div class="bottom-text">'+local.t("Sign up for BuzzFeed to react, comment, or publish your own ideas!")+'</div>				</div>				<div class="hidden" id="signup_complete">					<header class="complete">'+local.t("Thanks!")+'</header>					<div class="message_wrapper">						<span class="mid-text email_confirm bold_signup">'+local.t("Go check your mail and click the confirmation link.")+'</span>						<span class="email_tooltip" id="show_tooltip">&nbsp;</span>					</div>					<div class="message_wrapper" id="msg_wrap">						<span class="mid-text email_confirm" id="action_msg"><span class="text">'+local.t("This will be your new BuzzFeed account:")+'</span></span>						<div class="hidden tooltip_content" id="tooltip_text">							<span class="arrow_up"></span>							<p>'+local.t("If you don't recieve the mail in a few minutes, please check your spam folder")+".</p>							<p>"+local.t('If the email doesn\'t arrive, go to the <a href="/signin"> sign in page</a> and click "forgot password" to resend the email.')+'</p>						</div>					</div>					<div class="account_details">						<div class="default_image" id="default_image_wrap">							<img src="" id="user-image"/>							<div class="tooltip_content fb_tooltip hidden" id="user-image_tooltip">								<p>'+local.t('You can change your profile picture on your <a href="/settings">settings page</a>')+'</p>								<span class="arrow_down">&nbsp;</span>							</div>						</div>						<span class="register_username" id="reg_username"></span>						<span class="register_link" id="reg_link"></span>					</div>				</div>			',ok_content:'			<div class="get_bf_email email_signup" id="reg_email_check">				<input type="checkbox" id="daily_email_signup" onchange="signin.test_email_signup(this)" rel:gt_act="newsletter-signup">				<div class="email_tag"><p id="email_msg">'+local.t("Get the")+'</p></div>				<div class="logo_text"><span class="bf_logo"></span> <span class="daily_text">'+local.t("DAILY EMAIL")+'</span></div>				<div class="email_signup_request hidden" id="email-request">Done!</div>			</div>			<div class="bf-buttons" id="bf-follow">				<a href="https://www.facebook.com/BuzzFeed"  alt="Like Us on Facebook" rel:gt_act="signup-bf-facebook"></a>				<a href="https://twitter.com/intent/user?screen_name=BuzzFeed" class="tw-follow" alt="Follow us on Twitter" rel:gt_act="signup-bf-twitter"></a>			</div>			<a href="javascript:;" onclick="signin.update_user_info(false)" class="button2 email ok_button" rel:gt_act="email-update-user-info">'+local.t("OK!")+"</a>			"}};this.init=function(){};this.keydown=function(ev){if(!signin.keydown_enabled){return false}if(ev.keyCode==Event.KEY_ESC){if(signin.modal_type=="initial"){signin.close()}}};this.mousedown=function(ev){if(!signin.mousedown_enabled){return false}if(ev.target.hasClassName("signin_overlay")&&signin.modal_type=="initial"){signin.close()}};this.open=function(e){try{if(signin.opened){return}if(typeof bf_rdio!="undefined"&&bf_rdio.hide){bf_rdio.hide()}signin.page_location=e.location;signin.modal_type=e.signin_type;if(e.reg_params){signin.reg_params=e.reg_params}if(e.mode){signin.modal_mode=e.mode}signin.signin_page=true;signin.overlay=new Element("div",{"class":"signin_overlay"});signin.wrap=new Element("div",{"class":"signin_wrapper"});if(isIE8()||isIE7()){signin.overlay.addClassName("signin_ie")}signin.overlay.setStyle({opacity:0});$$("body")[0].insert(signin.overlay);signin.overlay.insert(signin.wrap);signin.mask_hidden=false;BF_Effect.FadeIn(signin.overlay,1,0.1);signin.section=new Template(signin.html.section_wrapper);if(e.signin_type=="signin"){signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.initial}))}else{signin.wrap.update(signin.section.evaluate({content:signin.html.section_content[e.signin_type]}))}setTimeout(function(){signin.set_input_events()},5);if(e.mode){signin.set_mode(e.mode,e.signin_type)}if(typeof e.keydown_enabled!="undefined"&&!e.keydown_enabled||e.keydown_disabled){signin.keydown_enabled=false}if(typeof e.mousedown_enabled!="undefined"&&!e.mousedown_enabled||e.mousedown_disabled){signin.mousedown_enabled=false}if(typeof e.close_enabled!="undefined"&&!e.close_enabled||e.close_disabled){signin.close_enabled=false}if(signin.signin_page){document.observe("click",signin.mousedown);document.observe("keydown",signin.keydown)}bf_login.loggedInCallbacks.push.apply(bf_login.loggedInCallbacks,signin.callbacks.onLogin);signin.opened=true;signin.append_gtrack();if(!isIE8()){$("gplus-signin-button").removeClassName("hidden");$("gplus-signin-button").observe("click",function(e){signin._gplus_render()})}gtrack.track_events(BF_STATIC.tt_page+":Signin-Modal","[nc]imp-signin-"+signin.page_location,gtrack.postEvents.toString(),"",true)}catch(e){console.error(e)}};this.set_signup_buttons=function(){$("signup_complete").insert(signin.html.section_content.ok_content);if(signin.social_register){$$(".ok_button")[0].setAttribute("onclick","signin.update_user_info(true)")}};this.test_email_signup=function(e,is_ie){if((e&&e.checked)||is_ie){signin.email_signup(signin.email,true)}};this.close=function(){document.stopObserving("keydown",signin.keydown);signin.mask_hidden=false;BF_Effect.FadeOut(signin.overlay,false,false,function(){signin.mask_hidden=true});setTimeout(function(){if(signin.callbacks.onLogin.length&&bf_login.loggedInCallbacks.length){var cbs=[];for(var i=0;i<bf_login.loggedInCallbacks.length;i++){var ifcb=false;for(var j=0;j<signin.callbacks.onLogin.length;j++){if(bf_login.loggedInCallbacks[i]==signin.callbacks.onLogin[j]){ifcb=true}}if(!ifcb){cbs.push(bf_login.loggedInCallbacks[i])}}bf_login.loggedInCallbacks=cbs}signin.callbacks.onLogin=[];signin.callbacks.onRegister=[];if(signin.wrap&&signin.wrap.parentNode){signin.wrap.remove()}if(signin.overlay&&signin.overlay.parentNode){signin.overlay.remove()}signin.opened=false},500)};this.set_template=function(e){setTimeout(function(){signin.set_input_events()},5);signin.modal_type=e.getAttribute("rel:type_data");var template=(signin.modal_type=="brand_publisher_signup"?"email_signup":signin.modal_type);signin.wrap.update(signin.section.evaluate({content:signin.html.section_content[template]}));if(signin.modal_type=="trouble_signin"){var forgot_password_form=$("forgot-password-form");if(forgot_password_form){if(!bf_login.initialized){forgot_password_form.observe("submit",function(event){event.stop()}.bind(this))}}}else{if(signin.modal_type=="brand_publisher_signup"){var form=$$(".signin_wrapper")[0];form.select("header")[0].innerHTML=local.t("Create an account for your brand or organization");form.select(".signup_terms")[0].hide();form.select(".signin_lower_social")[0].hide();form.select(".bottom-text")[0].innerHTML=local.t('By signing up for BuzzFeed, you agree to our <a href="'+BF_STATIC.web_root+'/about/useragreement" target="_blank">Terms and Conditions</a>');form.select("#register-button")[0].addClassName("brand_publisher")}}var reg_form=$("registration-form");if(reg_form){reg_form.observe("submit",function(event){event.stop()}.bind(this))}var login_form=signin.wrap.select("#login-form")[0];if(login_form){login_form.observe("submit",function(event){event.stop()}.bind(this))}var reset_form=signin.wrap.select("#forgot-password-form")[0];if(reset_form){reset_form.observe("submit",function(event){event.stop()}.bind(this))}signin.append_gtrack();if(signin.modal_type=="signin"||signin.modal_type=="email_signup"){if(!isIE8()){$("gplus-signin-button").removeClassName("hidden");$("gplus-signin-button").observe("click",function(e){signin._gplus_render()})}}};this.set_mode=function(mode,type){try{if(type=="initial"){if(mode=="signup"){$("initial_header").update(local.t("Sign up here!"));$("initial_fb_text").update(local.t("Sign up with Facebook"))}else{if(mode=="contribution"){try{$("reg_username_tooltip").hide();$("reg_url_tooltip").hide();$("edit_update").hide()}catch(e){}try{$("initial-msg").update(local.t("Thanks for your response."));$("initial_header").update(local.t("Just one more step!"))}catch(e){}try{$("custom-reg-message").update(local.t("Your response was posted!"));$$("#signup_complete .mid-text")[0].update(local.t("And here's your new BuzzFeed account:"))}catch(e){}}else{if(mode=="voting"){try{$("initial-msg").update(local.t("Thanks for your vote."));$("initial_header").update(local.t("Just one more step!"))}catch(e){}try{$("custom-reg-message").update(local.t("Your vote was submitted!"));$$("#signup_complete .mid-text")[0].update(local.t("And here's your new BuzzFeed account:"))}catch(e){}}else{if(mode=="badges"){try{$("initial-msg").update(local.t("Thanks for your reaction."));$("initial_header").update(local.t("Just one more step!"))}catch(e){}try{$("custom-reg-message").update(local.t("Your reaction was posted!"));$$("#signup_complete .mid-text")[0].update(local.t("And here's your new BuzzFeed account:"))}catch(e){}}else{if(mode=="submissions"){try{$("initial-msg").update(local.t("Thanks for your submission."));$("initial_header").update(local.t("Just one more step!"))}catch(e){}try{$("custom-reg-message").update(local.t("Your photo was submitted!"));$$("#signup_complete .mid-text")[0].update(local.t("And here's your new BuzzFeed account:"))}catch(e){}}}}}}}else{if(type=="email_signup"&&$$("#action_msg .text")[0]){if(mode=="contribution"){$$("#action_msg .text")[0].innerHTML=local.t("Click the link to post your comment.")}else{if(mode=="voting"){$$("#action_msg .text")[0].innerHTML=local.t("Click the link to submit your vote.")}else{if(mode=="badges"){$$("#action_msg .text")[0].innerHTML=local.t("Click the link to post your reaction.")}else{if(mode=="submissions"){$$("#action_msg .text")[0].innerHTML=local.t("Click the link to submit your photo.")}}}}}}}catch(e){console.error(e)}};this.login=function(e){signin.clear_errors();bf_login.login();signin.spinner();bf_login.loggedInCallbacks.push(function(){signin.close()})};this.fb_login=function(perms,onFail){facebook.FB_login(perms,onFail);signin.spinner();bf_login.loggedInCallbacks.push(function(){if(!signin.social_register){signin.close()}})};this.reset_password=function(){signin.clear_errors();if($("forgot-password-submit")){$("forgot-password-submit").disabled=true}if(bf_login.already_sent){signin.register_errors("email",local.t("A request has already been sent for this email."))}else{signin.spinner();bf_login.reset_password()}};this.pw_response=function(resp){var obj=resp.responseText.evalJSON();if(obj.error){signin.register_errors("email",obj.error);bf_login.already_sent=false;$("forgot-password-submit").disabled=false}else{signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.trouble_signin_resp}))}};this.register=function(e){try{if($("register-button")){$("register-button").disabled=true}signin.clear_errors();signin.spinner();var username=signin.wrap.select("#register-username")[0].value;if(username==local.t("Pick a Username")){username=""}var password=signin.wrap.select("#register-password")[0].value;if(password==local.t("Create a Password")){password=""}signin.email=signin.wrap.select("#register-email")[0].value;signin.email_updates=$F("email_signup")?1:0;var params={username:username,email:signin.email,pw:password,allow_email_updates:signin.email_updates,contribute:1,import_fb_profile:true};if(e.hasClassName("brand_publisher")){params.create_brand_publisher_account=1}if(signin.reg_params){params.params=signin.reg_params}bf_register.new_register(params);bf_register.newRegisterCallbacks.push.apply(bf_register.newRegisterCallbacks,signin.callbacks.onRegister)}catch(err){console.log(err)}};this.register_settings=function(obj){try{if(obj){if(signin.social_register){var user_image=obj.image?BF_STATIC.image_root+obj.image:BF_STATIC.static_root+"/images/public/signin/default_pug.png";signin.fb_edit=0;signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.fb_signup}));signin.set_input_events();if($("reg_email_check")){$("reg_email_check").removeClassName("hidden")}if($("reg_username")){$("reg_username").update(obj.username)}if($("user-image")){$("user-image").src=user_image}if($("reg_link")){var link=obj.username;$("reg_link").update(link);signin.tooltip()}}else{signin.wrap.update(signin.section.evaluate({content:signin.html.section_content.email_signup}));$("signup_form_wrap").addClassName("hidden");if($("signup_complete")){$("signup_complete").removeClassName("hidden")}if($("reg_username")){$("reg_username").update(obj.username)}if($("reg_link")){var link="http://buzzfeed.com/"+obj.username;$("reg_link").update(link)}if($("user-image")){$("user-image").src=BF_STATIC.static_root+"/images/public/signin/default_pug.png"}signin.tooltip()}if(signin.modal_mode){signin.set_mode(signin.modal_mode,signin.modal_type)}}signin.set_signup_buttons()}catch(err){console.error(err)}};this.fb_update=function(e){signin.fb_edit=1;signin.reg_name=$("reg_username").innerHTML;$("reg_username").addClassName("hidden");$("reg_link").addClassName("hidden");$("update_display_name").value=signin.reg_name;if($("update_display_name")){$("update_display_name").removeClassName("hidden")}$("update_user_name").value=signin.reg_name;if($("update_user_name")){$("update_user_name").removeClassName("hidden")}$("edit_update").addClassName("hidden");if($("cancel_update")){$("cancel_update").removeClassName("hidden")}};this.update_user_info=function(is_fb){try{signin.clear_errors();signin.set_input_events();var new_errors=false;var email_signup=$("daily_email_signup").checked;if(is_fb){document.observe("do:reload",function(){this.mailready=false;this.updateready=false;return function(ev){this[ev.memo.what]=true;if(this.mailready&&this.updateready){window.location.reload()}}}())}if(email_signup){signin.email_signup(signin.email)}else{document.fire("do:reload",{what:"mailready"})}if(signin.social_register){var display=$F("update_display_name");var user=$F("update_user_name");if(signin.fb_done||!signin.fb_edit||(display==signin.reg_name&&user==signin.reg_name)){signin.close();document.fire("do:reload",{what:"updateready"})}else{var new_display=$F("update_display_name");var new_user=$F("update_user_name");if(!new_display){signin.register_errors("displayname",local.t("Your display name cannot be blank."));new_errors=true;$("update_display_name").addClassName("fb_errors")}if(new_user.length<3||new_user.length>30){signin.register_errors("new_username",local.t("please enter a username between 3 and 30 characters"));new_errors=true;$("update_user_name").addClassName("fb_errors")}if(!new_errors&&!signin.fb_done){var params={};params.action="update_username";if(new_display!=signin.reg_name){params.new_display_name=new_display}if(new_user!=signin.reg_name){params.new_username=new_user}new Ajax.Request("/buzzfeed/_edit_user",{method:"post",parameters:{action:"update_username",new_display_name:new_display,new_username:new_user},onSuccess:function(resp){var obj=eval("("+resp.responseText+")");if(!obj.success){signin.register_errors("new_username",obj.message);$("update_user_name").addClassName("fb_errors")}else{if(obj.success){if(obj.session_key){BFW_Util.setCookie({name:BFW_COOKIE,value:obj.session_key})}bf_login.cookieLogin();signin.cancel_fb_update(true,new_user,new_display)}}},onFailure:function(resp){console.log(resp);document.fire("do:reload",{what:"updateready"})}})}}}else{if(!is_fb){signin.close();document.fire("do:reload",{what:"updateready"})}}}catch(e){console.log(e)}};this.cancel_fb_update=function(new_info,new_user,new_display){signin.clear_errors();if(new_info){if(new_user){$("reg_link").update(new_user)}if(new_display){$("reg_username").update(new_display)}if($("reg_username")){$("reg_username").removeClassName("hidden")}if($("reg_link")){$("reg_link").removeClassName("hidden")}$("cancel_update").remove();$("edit_update").remove();if($("update_display_name")){$("update_display_name").addClassName("hidden")}if($("update_user_name")){$("update_user_name").addClassName("hidden")}signin.fb_done=1;setTimeout(signin.close(),1000)}else{if($("reg_username")){$("reg_username").removeClassName("hidden")}if($("reg_link")){$("reg_link").removeClassName("hidden")}$("update_display_name").addClassName("hidden");if($("update_user_name")){$("update_user_name").addClassName("hidden")}if($("edit_update")){$("edit_update").removeClassName("hidden")}if($("cancel_update")){$("cancel_update").addClassName("hidden")}}};this.email_signup=function(email,from_test){if(email){new Ajax.Request("/buzzfeed/_email/",{method:"get",parameters:{email:email,category:"buzzfeed"},onSuccess:function(resp){document.fire("do:reload",{what:"mailready"});if(from_test){signin.email_signup_complete_ui()}},onFailure:function(resp){document.fire("do:reload",{what:"mailready"})}})}else{document.fire("do:reload",{what:"mailready"})}};this.email_signup_complete_ui=function(){if($("email-request")){$("email-request").removeClassName("hidden")}setTimeout(function(){BF_Effect.FadeOut($("reg_email_check"))},2000)};this.set_input_events=function(){$$("input").each(function(el){if(el.hasClassName("bf_dom")){var obj={bucket:"event_handler",element:$(el),data:{}};universal_dom.add_element_to_bucket(obj)}})};this.check_box_updates=function(e){if(!signin.signup_test){if(!e.checked){$("email_msg").update(local.t("Get BuzzFeed in your inbox!"))}else{if(e.checked){$("email_msg").update(local.t("You'll get your first email tomorrow!"))}}}};this.register_errors=function(type,msg){if(signin.modal_type=="email_signup"){if(type.match("duplicate")){type=type.split(" ")[1]}if(msg.match("URL")){msg=msg.replace("URL","username")}if(type=="pw"){signin.wrap.select("#register-password")[0].addClassName("errors")}else{signin.wrap.select("#register-"+type)[0].addClassName("errors")}}else{if(signin.modal_type=="signin"){signin.wrap.select("#login-username")[0].addClassName("errors");signin.wrap.select("#login-password")[0].addClassName("errors")}else{if(signin.modal_type=="trouble_signin"){signin.wrap.select("#login-email")[0].addClassName("errors");if(msg.match("No user found with email")){msg=msg.replace("No user found with email",local.t("No user found with email"))}}}}var err_el=$("reg_error_"+type);if(err_el){err_el.removeClassName("hidden");err_el.addClassName("errors");err_el.update(msg)}if($("register-button")){$("register-button").disabled=false}if(signin.spin_el){signin.spin_el.hide()}};this.clear_errors=function(){$$(".errors, .fb_errors").each(function(el){if(el.tagName=="INPUT"){if(el.hasClassName("errors")){el.removeClassName("errors")}else{if(el.hasClassName("fb_errors")){el.removeClassName("fb_errors")}}}else{if(el){el.addClassName("hidden");el.removeClassName("errors")}}})};this.spinner=function(){if(signin.wrap.select(".signin_spinner").length>0){signin.wrap.select(".signin_spinner")[0].show();return}signin.spin_el=new Element("img",{"class":"signin_spinner"});signin.spin_el.src=BF_STATIC.static_root+"/images/public/spinners/big_on_eee.gif";signin.wrap.insert(signin.spin_el)};this.fb_dialog_cancel=function(){if(signin.spin_el){signin.spin_el.remove()}};this.tooltip=function(){if(local&&local.non_english){return false}if(!signin.social_register){if($("show_tooltip")){$("show_tooltip").observe("mouseenter",function(){if($("tooltip_text")){$("tooltip_text").removeClassName("hidden")}});$("msg_wrap").observe("mouseleave",function(){$("tooltip_text").addClassName("hidden")})}if($("default_image_wrap")){$("default_image_wrap").observe("mouseenter",function(){if($("user-image_tooltip")){$("user-image_tooltip").removeClassName("hidden")}});$("default_image_wrap").observe("mouseleave",function(){$("user-image_tooltip").addClassName("hidden")})}}else{if(signin.social_register){var tool_els=["user-image","reg_username","reg_url"];tool_els.each(function(el){if($(el)){$(el).observe("mouseenter",function(){if($(el+"_tooltip")){$(el+"_tooltip").removeClassName("hidden")}});$(el).observe("mouseleave",function(){if($(el+"_tooltip")){$(el+"_tooltip").addClassName("hidden")}})}})}}};this.append_gtrack=function(){signin.wrap.select("*").each(function(el){if(el.hasAttribute("rel:gt_act")){if(el.getAttribute("rel:gt_act").match("sign-in-close")&&signin.modal_type=="signin"){el.setAttribute("rel:gt_act","email-"+el.getAttribute("rel:gt_act")+"-"+signin.page_location)}else{if(el.getAttribute("rel:gt_act").match("sign-in-close")&&signin.modal_type=="email_signup"){el.setAttribute("rel:gt_act","sign-up-close-"+signin.page_location)}else{el.setAttribute("rel:gt_act",el.getAttribute("rel:gt_act")+"-"+signin.page_location)}}}})};this._gplus_render=function(){if(typeof(gapi)!=undefined&&typeof(gapi.auth)!=undefined){var additionalParams={clientid:BF_STATIC.google_plus_client_id,redirecturi:"postmessage",accesstype:"offline",cookiepolicy:"single_host_origin",callback:"gplusCallback",apppackagename:"com.buzzfeed.android"};gapi.auth.signIn(additionalParams)}}};var signin=new BF_SignIn();BuzzLoader.register(signin.init,1);var BFPinterestReferer=function(){this.COOKIE="bf_referer";this.PROMO_INDEX=5;this.pinit_ps={};this.init=function(){var b=readCookie(bf_pinterest_referer.COOKIE);if(b!=null||BF_STATIC.tt_page=="DIY"||BF_STATIC.tt_page=="Food"||BF_STATIC.tt_page=="Style"){bf_pinterest_referer._init()}else{if(BF_STATIC.tt_page=="Buzz"&&BF_STATIC.vertical&&(BF_STATIC.vertical.toLowerCase()=="diy"||BF_STATIC.vertical.toLowerCase()=="food")){bf_pinterest_referer._init()}else{if((document.referrer||"").match(/pinterest.com/)||(location.search||"").match(/\?referer=pinterest.com/)||(document.referrer||"").match(/blog.pinterest.com/)||(location.search||"").match(/\?referer=blog.pinterest.com/)){var a=1/24/2;createCookie(bf_pinterest_referer.COOKIE,"pinterest.com",a);bf_pinterest_referer._init()}}}};this._init=function(){if(typeof universal_dom=="undefined"){setTimeout(bf_pinterest_referer.init,250)}else{bf_pinterest_referer.setup_observers();bf_pinterest_referer.show_pinterest_embed();bf_pinterest_referer.show_more();universal_dom.get_bucket_elements("pinterest_plugin").each(function(c){c.removeClassName("hidden")});if(!bf_pinterest_referer.matchReferer&&$$(".pinterestunit").length){var a=$$(".pinterestunit").first();if(a.hasClassName("hotonpinterest")&&!this.matchReferer){var b=$("permalink_buzz_stats");b.parentNode.insertBefore(a,b)}else{a.addClassName("hidden")}}}};this.setup_observers=function(){universal_dom.assign_handler({bucket:"more-pinterest-promos",event:"click",handler:bf_pinterest_referer.show_more});universal_dom.assign_handler({bucket:"pinit_promo",event:"mouseover",handler:bf_pinterest_referer.show_pinit_link});universal_dom.assign_handler({bucket:"pinit_link",event:"mouseover",handler:bf_pinterest_referer.show_pinit_link});universal_dom.assign_handler({bucket:"pinit_promo",event:"mouseout",handler:bf_pinterest_referer.hide_pinit_link})};this.show_pinit_link=function(a){universal_dom.get_bucket_elements_with_data("pinit_link",{uri:a.uri}).each(function(b){b.removeClassName("hidden")})};this.hide_pinit_link=function(a){universal_dom.get_bucket_elements_with_data("pinit_link",{uri:a.uri}).each(function(b){b.addClassName("hidden")})};this.show_more=function(c){var b=typeof bf_pinterest_referer._revealed=="undefined"?0:bf_pinterest_referer._revealed;var a=(BF_STATIC.tt_page=="DIY"||BF_STATIC.tt_page=="Food")?4:3;if(b==3||b==4){a=12}if(b==12){a=21}bf_pinterest_referer.reveal_promos(a);if(a==21){universal_dom.get_bucket_elements("more-pinterest-promos").each(function(d){d.addClassName("hidden")})}};this.reveal_promos=function(b){bf_pinterest_referer._revealed=b;var d=[],a=bf_pinterest_referer._get_shuffled_promos(),c=function(g){for(var e in a){for(var f=0;f<b&&f<a[e].length;f++){g.call(null,a[e][f])}}};c(function(e){var f;if(e.tagName.toLowerCase()=="div"){e.removeClassName("hidden");return}f=e.select(".pin-button-link");if(f.length){e.removeClassName("hidden");f.first().setAttribute("data-pin-do","buttonPin")}else{e.select(".pin-button a").each(function(g){if(g.getAttribute("data-pin-log")=="button_pinit"){d.push(g)}g.remove()})}});bf_pinterest_referer._loadPinterestScript(function(){if(!d.length){return}c(function(f){var e=f.select(".pin-button");if(!e.length){return}e.first().insert(d.shift())})})};this._get_shuffled_promos=function(){if(typeof bf_pinterest_referer._shuffled_promos=="undefined"){bf_pinterest_referer._shuffled_promos={};var a=["pinterest_promo"];a.each(function(f){var e=universal_dom.get_bucket_elements(f);e=e.slice(0,e.length);for(var d=0;d<e.length;d++){var c=Math.floor(Math.random()*e.length);var b=e[c];e[c]=e[d];e[d]=b}universal_dom.get_bucket_elements_with_data(f,{widget:true}).each(function(g){e.splice(e.indexOf(g),1);e.splice(bf_pinterest_referer.PROMO_INDEX,0,g)});bf_pinterest_referer._shuffled_promos[f]=e;bf_pinterest_referer._reorder_promos_on_page(f)})}return bf_pinterest_referer._shuffled_promos};this._reorder_promos_on_page=function(b){var a=bf_pinterest_referer._get_shuffled_promos();var c=null;var d=function(e){c=e.parentNode;c.update("")};a[b].each(function(e){if(!c){d(e)}c.appendChild(e)});universal_dom.update(c)};this._loadPinterestScript=function(e){if(!BF_STATIC.bf_test_mode){var a,b,c=document;b=c.createElement("SCRIPT");b.type="text/javascript";b.async=true;if(e){$(b).on("load",e)}b.src="//assets.pinterest.com/js/pinit.js";a=c.getElementsByTagName("SCRIPT")[0];a.parentNode.insertBefore(b,a)}else{console.info("disable Dynamically load assets.pinterest.com/js/pinit.js for test mode")}},this.show_pinterest_embed=function(){(function(b){var a=function(f){if(f==16){console.warn("Nothing returned from pinterest")}else{var e=0;var c=bf_pinterest_referer._get_shuffled_promos();for(var d in c){universal_dom.get_bucket_elements_with_data(d,{widget:true}).each(function(g){if(g.getElementsByTagName("SPAN").length>0){e++;try{if(g.next().className.indexOf("hidden")!=-1){g.addClassName("hidden")}}catch(h){console.warn("Error in DOM")}g.removeClassName("hide-buzz_holder")}})}if(e<2){setTimeout(function(){a(++f)},250)}}};a(0)}(document))}};bf_pinterest_referer=new BFPinterestReferer();BF_DID_REGISTER=false;BF_Register=function(){this.highlight_field=new Array();this.ajax=new BF_Request();this.ERR_MISSING_PARAMS="Please complete all fields.";this.ERR_BAD_USERNAME="Your username may only contain letters and numbers.";this.ERR_USERNAME_LENGTH="Your username must be between 3 and 30 characters in length.";this.ERR_PW_LENGTH="Your password must be at least 6 characters in length.";this.ERR_MUST_AGGEE=local.t("You must agree to the Terms of Service in order to register.");this.ERR_PW_MUST_MATCH="Your passwords do not match.";this.ERR_DUP_USERNAME="Sorry, that username is not available. Please try another.";this.ERR_DUP_SITENAME="Sorry, that domain name is not available. Please try another.";this.ERR_BAD_INVITE="Sorry, the invite code you entered is not valid.";this.ERR_DUP_EMAIL="There is already an account with that email address.";this.ERR_FB_DUP_EMAIL="The email address that belongs to your Facebook account has already been used by another BuzzFeed account.";this.BANNED_FB_UID=local.t("You cannot register with that Facebook user.");this.ERR_BAD_EMAIL="You have entered an invalid email address.";this.ERR_NO_ALIASES="Sorry, you don't have enough site aliases left to create a tracked site.";this.ERR=local.t("Sorry, we are unable to process your request at this time.");this.ERR_ALREADY_REGISTERED="You have already registered for an account";this.highlight_field[this.ERR_BAD_USERNAME]="register-username";this.highlight_field[this.ERR_USERNAME_LENGTH]="register-username";this.highlight_field[this.ERR_PW_LENGTH]="register-pw1";this.highlight_field[this.ERR_PW_MUST_MATCH]="register-pw2";this.highlight_field[this.ERR_MUST_AGGEE]="register-agree";this.highlight_field[this.ERR_DUP_USERNAME]="register-username";this.highlight_field[this.ERR_DUP_EMAIL]="bfe";this.highlight_field[this.ERR_BAD_EMAIL]="bfe";this.SUCCESS1="Thanks for registering. We've created your account and saved your post, but before we post it we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.<br /><br />Your post will appear automatically once you validate.";this.SUCCESS1_VALIDATED=local.t("Thanks for registering. We've validated your email address with Facebook, created your account and saved your post. ");this.SUCCESS2="Thanks for registering. We've created your account, but before you can vote we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.";this.SUCCESS2_VALIDATED=local.t("Thanks for registering. We've validated your email address with Facebook and created your account. You now can vote.");this.SUCCESS3="<h3>Please Validate Your Email</h3><p>Thanks for registering. We've created your account, but before you can log in we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.</p>";this.SUCCESS3_VALIDATED="<h3>Your Email Has Been Validated</h3><p>"+local.t("Thanks for registering. We've created your account and validated your email address with Facebook. Some of your profile data has been prepopulated with information from your Facebook profile. You can log in now.")+"</p>";this.SUCCESS4="Thanks for registering. We've created your account, but before you can post we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.<br/><br/>Once you validate <a id='register_this_page_url' href=''>click here</a> to make a post.";this.SUCCESS4_VALIDATED="Thanks for registering. We've created your account and validated your email address with Facebook.";this.fb_link_handler=function(){var handler=function(event){event.stop();$("facebook-login").hide();$("facebook-registration-form").hide();bf_login.switch_to_link_accounts()}.bind(this);if($("fb-link-submit")){$("fb-link-submit").observe("click",handler)}if($("fb-link-submit2")){$("fb-link-submit2").observe("click",handler)}};this.fb_register_handler=function(reset_form,args){if(BF_Register.registered_fb_handler){return}BF_Register.registered_fb_handler=true;this.fb_link_handler();if(typeof reset_form=="undefined"){reset_form=true}if(args){this.args=args}var handler=function(event){event.stop();this.facebook_register()}.bind(this);if($("facebook-registration-form")){$("facebook-registration-form").stopObserving("submit",handler)}if($("facebook-registration-form")){$("facebook-registration-form").observe("submit",handler)}if($("fb-register-submig")){$("fb-register-submit").disabled=false}if(reset_form&&$("facebook-registration-form")){$("facebook-registration-form").reset()}};this.alias_register_handler=function(reset_form,args){if(BF_Register.alias_registered_handler){return}BF_Register.alias_registered_handler=true;if(typeof reset_form=="undefined"){reset_form=true}if(args){this.args=args}var handler=function(event){event.stop();this.alias_register()}.bind(this);BF_UserSwitcher.count_aliases(function(obj){var user_info=new BF_User().getUserInfo();var remaining=parseInt(user_info.max_aliases)-parseInt(obj.count);if($("self-serve-form")){if(remaining<=0&&user_info.max_aliases!=0){$("registration-form-tabs").hide();$("self-serve-form").hide();$("self-max-alias").show()}}if($("alias-sites-left")&&obj.success){$("alias-sites-left").update(remaining);if(remaining==1){$("alias-sites-left-plural").hide()}if(obj.unlimited==1){$("alias-count-message").hide()}else{$("alias-count-message").show()}if(remaining<=0&&user_info.max_aliases!=0){$("alias-registration-fieldset").hide();$("alias-registration-hit-limit").show()}}});if($("alias-registration-form")){$("alias-registration-form").stopObserving("submit",handler)}if($("alias-registration-form")){$("alias-registration-form").observe("submit",handler)}if($("alias-registration-form")){$("alias-register-submit").disabled=false}if(reset_form&&$("alias-registration-form")){$("alias-registration-form").reset()}};this.admin_register_handler=function(reset_form,args){var user=new BF_User();if(user.isLoggedIn()){var user_info=user.getUserInfo();if(!acl.user_can("partners_manage")){return}$("admin_options").show()}};this.register_handler=function(reset_form,args){if(BF_Register.registered_handler){return}BF_Register.registered_handler=true;if(typeof(reset_form)=="undefined"){reset_form=true}if(args){this.args=args}var handler=function(event){event.stop();this.register()}.bind(this);if($("regsitration-form")){$("regsitration-form").stopObserving("submit",handler)}if($("regsitration-form")){$("regsitration-form").observe("submit",handler)}if($("register-submit")){$("register-submit").disbaled=false}if(reset_form&&$("regsitration-form")){$("regsitration-form").reset()}this.self_serve_handler()};this.register_tab_handler=function(){return;var handler=function(e){if(e.element().id=="self-serve-tab"){$("registration-div").hide();$("self-serve-div").show()}if(e.element().id=="create-your-feed-tab"){$("self-serve-div").hide();$("registration-div").show()}if(e.element().id=="create-new-feed-tab"){$("self-serve-div").hide();$("registration-div").show()}};if($("create-your-feed-tab")){$("create-your-feed-tab").observe("click",handler)}if($("create-new-feed-tab")){$("create-new-feed-tab").observe("click",handler)}if($("self-serve-tab")){$("self-serve-tab").observe("click",handler)}};this.self_serve_handler=function(){var handler=function(e){var domain=$F("self-serve-your-domain").strip();if(domain=="yoursite.com"){domain=""}var code=$("self-serve-invite-code")?$F("self-serve-invite-code").strip():"";if(code=="invite code"){code=""}err_mess="";if(!domain||(!code&&SS_INVITE_NEEDED==true)){err_mess="Please complete all fields."}if(domain!=""&&!domain.match(/^[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+$/)){err_mess="Please enter a domain for your site (example.com)."}if($F("self-serve-standalone")&&!$F("self-serve-email")){err_mess="You must enter an email address for a seperate account!"}if(err_mess){if(Prototype.Browser.IE){$("self-serve-error-message").innerText=err_mess}else{$("self-serve-error-message").update(err_mess)}$("self-serve-error-message").addClassName("error").show();$("self-serve-error-message").show()}else{var user=new BF_User();if(user.isLoggedIn()){var user_info=user.getUserInfo();default_session=user_info.default_user.session_key;var userid=user_info.userid;$("self-serve-buttons").hide();$("submit-self-serve-spinner").show();$("self-serve-error-message").hide();var save_params={action:"create_site",mycode:code,default_session:default_session,mydomain:domain};if($F("self-serve-standalone")){save_params.standalone_user=1;if($F("self-serve-email")){save_params.email=$F("self-serve-email")}if($F("self-serve-send-email")){save_params.send_email=1}}(new BF_Request()).request("/buzzfeed/_self_serve_tracking",{method:"get",parameters:save_params,onSuccess:function(r){var obj=eval("("+r.responseText+")");if(obj&&obj.success==1){var redir=BF_STATIC.web_root+"/sites/"+obj.status.self_serve_user.username;document.location.href=redir}else{$("self-serve-buttons").show();$("submit-self-serve-spinner").hide();err_mess="Unable to process your request";if(obj.message){if(obj.message=="bad invite code"){err_mess=this.ERR_BAD_INVITE}else{if(obj.message=="duplicate site name"){err_mess=this.ERR_DUP_SITENAME}else{if(obj.message=="no user aliases left"){err_mess=this.ERR_NO_ALIASES}else{if(obj.message=="Cannot validate account with Facebook"){err_mess="Cannot validate your Facebook account; please grant extended permissions or register without your Facebook account"}else{err_mess=local.t("Unable to process your request")}}}}}if(Prototype.Browser.IE){$("self-serve-error-message").innerText=err_mess}else{$("self-serve-error-message").update(err_mess)}$("self-serve-error-message").addClassName("error");$("self-serve-error-message").show()}}.bind(this),onFailure:function(r){$("self-serve-buttons").show();$("submit-self-serve-spinner").hide();if(Prototype.Browser.IE){$("self-serve-error-message").innerText="Unable to process your request"}else{$("self-serve-error-message").update("Unable to process your request")}$("self-serve-error-message").addClassName("error");$("self-serve-error-message").show()}.bind(this)})}else{this.args={onRegister:function(obj){if($("registration-form-tabs")){$("self-serve-registration-div").hide()}if($("self-serve-registration-div")){$("self-serve-registration-div").hide()}if($("self-serve-form")){$("self-serve-form").hide()}if($("registration-success-message")){$("registration-success-message").show()}}};$("self-serve-buttons").hide();$("self-serve-registration-div").show();if($("register-submit")){$("register-submit").disbaled=false}}}}.bind(this);bf_register.self_serve_submit_handler=handler;if($("self-serve-form")){$("self-serve-form").observe("submit",handler)}};this.facebook_register=function(){var name=$F("fb-register-name").strip();var email="get_from_facebook@buzzfeed.com";try{email=facebook.user_data.email}catch(e){}var username=$F("fb-register-username").strip();var pw1=$F("fb-register-pw1").strip();var agreed=true;var emailme=0;var import_fb_profile=$("import_fb_profile_checkbox").checked?"true":"false";if(import_fb_profile=="false"){name=username}var facebook_uid=$("fb-facebook-uid")?$("fb-facebook-uid").value:"";this.username=username;this.password=pw1;if($("fb-email-me").checked){emailme=1}var rr=function(resp){this.response(resp)}.bindAsEventListener(this);var er=function(resp){this.err(resp)}.bindAsEventListener(this);var params={name:name,username:username,pw:pw1,email:email,contribute:1,allow_email_updates:emailme,facebook_uid:facebook_uid,import_fb_profile:import_fb_profile,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent};new Ajax.Request("/buzzfeed/_contribute_register",{method:"post",parameters:params,onSuccess:rr,onFailure:er})};this.alias_register=function(){var username=$("alias-register-username").value.strip();if(!username.match(/^[a-zA-Z0-9]+$/)){this._alias_register({success:0,message:"Site URL must consist of only alphanumeric characters"});return}var display_name=$("alias-register-display_name").value;if($("alias-registering-status")){$("alias-registering-status").show()}if(!username||!display_name){this._alias_register({success:0,message:"missing username"})}else{BF_UserSwitcher.create_alias({username:username,display_name:display_name},this._alias_register)}};this._alias_register=function(obj){if(obj.success==0||obj.status!=200){$("alias-message").show();if(obj.message.match(/missing username/i)){$("alias-message").update("please fill out all fields")}else{if(obj.message.match(/logged in/i)){$("alias-message").update("please log in and try again")}else{if(obj.message.match(/privileges/i)){$("alias-message").update("you don't have permission to create an alias")}else{if(obj.message.match(/limit/i)){$("alias-message").update("Sorry, but you are over your alias limit")}else{if(obj.message.match(/username/i)){$("alias-message").update("this site URL already is taken, please select another")}else{$("alias-message").update(obj.message)}}}}}}else{if($("alias-registration-fieldset")){$("alias-registration-fieldset").hide()}if($("alias-registration-creating-site")){$("alias-registration-creating-site").show()}BF_UserSwitcher.switchTo(obj.userid,function(){})}if($("alias-registering-status")){$("alias-registering-status").hide()}};this.register=function(){if($("registering-status")){$("registering-status").show()}var self_serve_domain="";var self_serve_invite_code="";if($("self-serve-div")&&$("self-serve-div").getStyle("display")!="none"){self_serve_domain=$F("self-serve-your-domain").strip();self_serve_invite_code=$("self-serve-invite-code")?$F("self-serve-invite-code").strip():""}if(typeof this.args=="undefined"){this.args={action:"vote"}}var name=$F("register-name").strip();var email=$F("bfe").strip();var username=$F("register-username").strip();var pw1=$F("register-pw1").strip();var pw2=$F("register-pw2").strip();var agreed=false;var emailme="";var facebook_location="";var facebook_uid="";var facebook_url="";var import_fb_profile=false;if(BF_STATIC.facebook_enabled){facebook_uid=$("facebook-uid")?$("facebook-uid").value:"";import_fb_profile=$("import_fb_profile_checkbox").checked}if($("register-agree").checked){agreed=true}if($("email-me").checked){emailme=1}var is_error=true;if(!name||!email||!username||!pw1||!pw2){this.update_registration_message(this.ERR_MISSING_PARAMS)}else{if(!username.match(/^[a-zA-Z0-9]+$/)){this.update_registration_message(this.ERR_BAD_USERNAME)}else{if(username.length<3||username.length>30){this.update_registration_message(this.ERR_USERNAME_LENGTH)}else{if(pw1!=pw2){this.update_registration_message(this.ERR_PW_MUST_MATCH)}else{if(!agreed){this.update_registration_message(this.ERR_MUST_AGGEE)}else{if(typeof pw1=="undefined"||pw1.length<6){this.update_registration_message(this.ERR_PW_LENGTH)}else{if(typeof email=="undefined"||!email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){this.update_registration_message(this.ERR_BAD_EMAIL)}else{if(self_serve_domain=="yoursite.com"||self_serve_invite_code=="invite code"){this.update_registration_message("Please enter your site's domain.")}else{if(self_serve_domain!=""&&!self_serve_domain.match(/\w\.\w/)){this.update_registration_message("Please enter a valid domain for site (example.com).")}else{is_error=false;this.username=username;this.password=pw1;var rr=function(resp){this.response(resp)}.bindAsEventListener(this);var er=function(resp){this.err(resp)}.bindAsEventListener(this);$("register-submit").disbaled=true;if($("self-serve-div")&&$("self-serve-div").getStyle("display")!="none"){var params={self_serve_username:self_serve_domain,self_serve_invite:self_serve_invite_code,name:name,username:username,pw:pw1,email:email,contribute:1,allow_email_updates:emailme,facebook_uid:facebook_uid,location:facebook_location,link:facebook_url,import_fb_profile:import_fb_profile,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent}}else{var params={name:name,username:username,pw:pw1,email:email,contribute:1,allow_email_updates:emailme,facebook_uid:facebook_uid,location:facebook_location,link:facebook_url,import_fb_profile:import_fb_profile,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent}}new Ajax.Request("/buzzfeed/_contribute_register",{method:"post",parameters:params,onSuccess:rr,onFailure:er})}}}}}}}}}if(is_error){if($("register-submit")){$("register-submit").disabled=false}$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").addClassName("error");$("registration-message").show();$("registering-status").hide()}};this.update_registration_message=function(msg){if(Prototype.Browser.IE){$("registration-message").innerText=msg;$("facebook-registration-message").innerText=msg}else{$("registration-message").update(msg);$("facebook-registration-message").update(msg)}if(this.__error_field){this.__error_field.style.border="1px solid gray";this.__error_field=null}if(this.highlight_field[msg]&&$(this.highlight_field[msg])){$(this.highlight_field[msg]).style.border="1px solid red";this.__error_field=$(this.highlight_field[msg])}};this.response=function(resp){var username=this.username;var password=this.password;$("registering-status").hide();try{$("register-submit").disbaled=false;obj=eval("("+resp.responseText+")");if(!obj||!obj.status){this.err()}else{if(obj.status=="success"){__reg_ok=true;BF_DID_REGISTER=true;$("regsitration-form").reset();if(this.args&&this.args.action=="vote"&&vote_manager.contribution_id){if($("contribute-success")){$("contribute-success").hide()}var reg_success_div=$("registered-success").remove();$("registration-div").hide();var div=document.createElement("div");div.appendChild(reg_success_div);$($("registration-div").parentNode).appendChild(div);$("registered-success").show();$("registered-success").style.marginTop="10px";var show_message=this.SUCCESS2;if(obj.user_validated){show_message=this.SUCCESS2_VALIDATED;if($("please-validate-your-email")){$("please-validate-your-email").update("We Have Validated Your Email")}}$("reg-success-message").update(show_message);if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_vote")}}else{if(this.args&&this.args.action=="signin"){if($("contribute-success")){$("contribute-success").hide()}if($("registered-success")){$("registered-success").show()}if($("registration-div")){$("registration-div").hide()}if($("reg-success-message")){var show_message=this.SUCCESS3;if(obj.user_validated){show_message=this.SUCCESS3_VALIDATED}$("reg-success-message").update(show_message);$("reg-success-message").show();if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_signin")}if(obj.user_validated){var params={username:username,password:password,contribute:1};new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:params,onSuccess:function(r){bf_login.loggedIn(r);if(window.location.href.indexOf("/signin")!=-1){window.location.href="/"+username}},onFailure:bf_login.err})}}}else{if(this.args&&this.args.action=="badge_vote"){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_badge_vote")}if(badge_vote_manager&&badge_vote_manager.onRegister){badge_vote_manager.onRegister()}else{if($("registered-vote-success")){$("registered-vote-success").show()}if($("registration-div")){$("registration-div").hide()}}}else{if(this.args&&this.args.action=="contest_entry"){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_contest_entry")}if(typeof contest_manager!="undefined"&&contest_manager.onLogin){contest_manager.onLogin()}}else{if(this.args&&this.args.action=="micosite_submission"){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register_microsite")}if(typeof picks_controller!="undefined"&&picks_controller.onLogin){picks_controller.onLogin()}}else{if(this.args&&this.args.onRegister){if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}this.args.onRegister(obj)}else{if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}if($("contribute-success")){$("contribute-success").hide()}if($("registered-success")){$("registered-success").show()}if($("registration-div")){$("registration-div").hide()}if(bf_contribute&&bf_contribute.type=="image"){var show_message=this.SUCCESS4;if(obj.user_validated){show_message=this.SUCCESS4_VALIDATED}if($("reg-success-message")){$("reg-success-message").update(show_message)}}else{var show_message=this.SUCCESS1;if(obj.user_validated){show_message=this.SUCCESS1_VALIDATED;if($("please-validate-your-email")){$("please-validate-your-email").update("We Have Validated Your Email")}var params={username:username,password:password,contribute:1};new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:params,onSuccess:function(r){bf_login.loggedIn(r,this.args);if(window.location.href.indexOf("/signin")!=-1){window.location.href="/"+username}},onFailure:bf_login.err})}if($("reg-success-message")){$("reg-success-message").update(show_message)}}bf_contribute.submit({session_key:obj.session_key})}}}}}}if($("register_this_page_url")){var rurl=document.location.href;rurl=rurl.replace(/#.*/,"");$("register_this_page_url").href=rurl}}else{var some_error=true;if(obj.message=="bad beta key"){this.update_registration_message(this.ERR_BETA_KEY)}else{if(obj.message=="duplicate username"){this.update_registration_message(this.ERR_DUP_USERNAME)}else{if(obj.message=="duplicate site name"){this.update_registration_message(this.ERR_DUP_SITENAME)}else{if(obj.message=="Your invite code is not valid."){this.update_registration_message(this.ERR_BAD_INVITE)}else{if(obj.message=="duplicate email"){if(facebook.is_logged_in()){this.update_registration_message(this.BANNED_FB_UID)}else{this.update_registration_message(this.ERR_DUP_EMAIL)}}else{this.err();some_error=false}}}}}if(some_error){if($("register-submit")){$("register-submit").disabled=false}$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").addClassName("error");$("registration-message").show()}}}}catch(e){console.dir({e:e});this.err()}};this.err=function(resp){$("register-submit").disabled=false;$("facebook-registration-message").update(this.ERR);$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").update(this.ERR);$("registration-message").addClassName("error");$("registration-message").show();$("registering-status").hide()};this.redirect_to=function(url){window.location.href=BF_STATIC.web_root+"/"+url};this.form_values=function(obj){if(typeof obj.pw=="undefined"){if($("register-password").value!=$("register-password").getAttribute("defaultvalue")){obj.pw=$("register-password").value}}if(typeof obj.username=="undefined"){if(bf_register.signup_page()){if($(signup_page.currentNameBox()).value!=$(signup_page.currentNameBox()).getAttribute("defaultvalue")){obj.name=obj.username=$(signup_page.currentNameBox()).value}}else{obj.name=obj.username=$("register-uri-text").value}}if(typeof obj.email=="undefined"){if($("register-email").value!=$("register-email").getAttribute("defaultvalue")){obj.email=$("register-email").value}}return obj};this.create_advertiser_account=function(data){if(!acl.user_can("partners_manage")){return}var errors=[];var obj={create_advertiser_account:1,pw:data.pw||"",pw2:data.pw||"",name:data.name||data.username||"",username:data.username||"",email:data.email||"",contribute:1};var missingEmail=false;var strip=new Array("email","username","pw");strip.each(function(el){if(typeof obj[el]!="undefined"&&typeof obj[el].strip!="undefined"){obj[el]=obj[el].strip()}if(typeof obj[el]=="undefined"||obj[el]==""){errors.push("Missing "+el);if(el=="email"){missingEmail=true}}});if(!missingEmail&&!data.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){errors.push("Please enter a valid email address");if($("register-email")){$("register-email").style.border="1px solid red";$("register-email").observe("blur",function(){$("register-email").style.border="1px solid #D9D9D9"})}}var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};if(errors.length){return error(errors.join(", "))}if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:obj,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(r){var json=eval("("+r.responseText+")");bf_register._new_register(obj,json)}})};this.create_contributor_account=function(data){if(!acl.user_can("editors_manage")){return}var errors=[];var obj={create_contributor_account:1,pw:data.pw||"",pw2:data.pw||"",name:data.name||data.username||"",username:data.username||"",email:data.email||"",contribute:1};var missingEmail=false;var strip=new Array("email","username","pw");strip.each(function(el){if(typeof obj[el]!="undefined"&&typeof obj[el].strip!="undefined"){obj[el]=obj[el].strip()}if(typeof obj[el]=="undefined"||obj[el]==""){errors.push("Missing "+el);if(el=="email"){missingEmail=true}}});if(!missingEmail&&!data.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){errors.push("Please enter a valid email address");if($("register-email")){$("register-email").style.border="1px solid red";$("register-email").observe("blur",function(){$("register-email").style.border="1px solid #D9D9D9"})}}var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};if(errors.length){return error(errors.join(", "))}if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:obj,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(r){var json=eval("("+r.responseText+")");bf_register._new_register(obj,json)}})};this.newRegisterCallbacks=[];this.new_register=function(obj){if(obj.create_advertiser_account){return bf_register.create_advertiser_account(obj)}if(obj.create_contributor_account){return bf_register.create_contributor_account(obj)}if(typeof obj.pw2=="undefined"){obj.pw2=obj.pw}if(typeof obj.name=="undefined"){obj.name=obj.username}var errors=false;var required={username:"Please enter a username.",email:"Please enter a valid email address.",pw:"Please enter a password."};var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};obj=this.form_values(obj);var strip=new Array("name","email","username","pw");strip.each(function(el){if(typeof obj[el]!="undefined"){obj[el]=obj[el].strip()}});if(obj.username=="username"){obj.username=""}for(var each in required){if(typeof obj[each]=="undefined"||obj[each]==""){error(required[each]);if(signin.signin_page){signin.register_errors(each,required[each])}break}}if(obj.username=="url"){obj.username=""}if(obj.pw=="password"){obj.pw=""}if(obj.email=="your@email.com"){obj.email=""}if(!errors&&!obj.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){error("Please enter a valid email address");if(signin.signin_page){signin.register_errors("email","Please enter a valid email address")}}if(!errors&&(obj.username.length<3||obj.username.length>30)){error("Please enter a URL between 3 and 30 characters");if(signin.signin_page){signin.register_errors("username","Please enter a URL between 3 and 30 characters")}}if(!errors&&obj.pw.length<6){error("Your password must have at least 6 characters");if(signin.signin_page){signin.register_errors("pw"," Your password must have at least 6 characters")}}if(!errors){if(document.location.search.indexOf("registered_from=")){var search=document.location.search.substring(1);var kvpairs=search.split("&");kvpairs.each(function(kvpair){var kv=kvpair.split("=");if(kv[0]=="registered_from"){obj.registered_from_url=kv[1]}})}if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:obj,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(r){var json=eval("("+r.responseText+")");bf_register._new_register(obj,json)}})}};this._new_register=function(obj,json){if(json.status=="failed"){bf_register._error(json)}else{bf_register._success(obj,json)}};this._error=function(json){var messages={"duplicate email":bf_register.ERR_DUP_EMAIL,"duplicate username":bf_register.ERR_DUP_USERNAME};if(signin.signin_page){signin.register_errors(json.message,messages[json.message])}if($("registration-success-message")){old_msg.hide()}var msg=bf_register.currentErrorBox();if(bf_register.signup_page()){signup_page.toggleSpinner(0)}if(msg){var match;if(match=json.message.match(/^(.*) at lib/)){json.message=match[1]}msg.update(messages[json.message]||json.message);msg.show()}};this._success=function(obj,json){if(bf_register.currentErrorBox()){bf_register.currentErrorBox().hide()}if(signin.signin_page){signin.register_settings(obj)}json.user_validated=json.user_validated==true||json.user_validated=="true";if(json.user_validated){var params={username:obj.username,password:obj.pw,contribute:1};bf_register.dont_switch=json.dont_switch||0;bf_register.ajax.request("/buzzfeed/_www_login",{method:"post",parameters:params,while_processing:{show:"logging-in",hide:"new-registration-form"},onSuccess:function(r){if(bf_register.dont_switch){var o=eval("("+r.responseText+")");bf_register.redirect_to("settings/"+o.username)}else{if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}if(signin.social_register){bf_login.loggedIn(r,{no_reload:true})}else{bf_login.loggedIn(r);bf_register.redirect_to("settings?firstTime=true")}}}})}else{if(bf_register.signup_page()){signup_page.toggleSpinner(0);signup_page.openDialog("old")}if(typeof(return_tracker)!="undefined"){return_tracker.track_goal("register")}var form=$("new-registration-form");var msg=$("registration-success-message");if(form){form.hide()}if(msg){msg.show()}}if(this.newRegisterCallbacks.length){this.newRegisterCallbacks.each(function(fn){fn(obj,json)})}};this.register_alias=function(obj){var errors=false;var error_msg_box=bf_register.currentErrorBox();var error=function(msg){errors=true;if(error_msg_box){error_msg_box.update(msg);error_msg_box.show()}};if(!obj.username||obj.username.length<3||obj.username.length>30){if(bf_register.signup_page()){error("Please enter a username between 3 and 30 characters")}else{error("Please enter a URL between 3 and 30 characters")}}if(!errors){if(bf_register.signup_page()){signup_page.toggleSpinner(1)}BF_UserSwitcher.create_alias({username:obj.username,display_name:typeof obj.name=="undefined"?obj.username:obj.name},bf_register._register_alias)}};this._register_alias=function(obj){if(obj.success==0||obj.status!=200){bf_register._error({message:obj.message||"Unable to create an alias at this time"})}else{BF_UserSwitcher.switchTo(obj.userid,function(){if(!signin.social_register){bf_register.redirect_to("settings?firstTime=true")}})}};this.signup_page=function(){return BF_STATIC.tt_page=="Signup"?true:false};this.currentErrorBox=function(){return bf_register.signup_page()?$(signup_page.currentErrorBox()):$("registration-error-message")}};var bf_audio=function(){this.player=function(a){if(typeof a=="undefined"){return false}if(!document.getElementById("turntable")){this.createPlayer()}if(isIE7()||isIE8()){AudioPlayer.setup(BF_STATIC.static_root+"/flash/player.swf",{width:1,height:1,initialvolume:100});this.flashPlayer(this.getAudioPath(a))}else{this.html5Player(this.getAudioPath(a))}};this.createPlayer=function(){var a=document.createElement("div");a.setAttribute("id","turntable");document.body.appendChild(a)};this.flashPlayer=function(a){if(BF_STATIC.bf_env!="live"){console.log("Playing w/Flash: "+a)}var b=document.getElementById("turntable");b.insert('<p id="player_1"></p>');AudioPlayer.embed("player_1",{soundFile:a,autostart:"yes"})};this.html5Player=function(a){if(BF_STATIC.bf_env!="live"){console.log("Playing w/HTML5: "+a)}var c=document.getElementById("turntable");var b=document.createElement("audio");b.setAttribute("id","needle");b.setAttribute("src",a);c.appendChild(b);b.play()};this.getAudioPath=function(a){var c="";var d=a.split(".");for(var b=0;b<(d.length-1);b++){c+=d[b]+"."}c=BF_STATIC.static_root+c;if(Prototype.Browser.Gecko){a=c+"ogg"}else{a=c+"mp3"}return a}};var BFAudio=new bf_audio();if(!window.AJAX_TEST_STATUS){window.AJAX_TEST_STATUS={}}var qq=qq||{};qq.extend=function(b,a){for(var c in a){b[c]=a[c]}};qq.indexOf=function(b,c,d){if(b.indexOf){return b.indexOf(c,d)}d=d||0;var a=b.length;if(d<0){d+=a}for(;d<a;d++){if(d in b&&b[d]===c){return d}}return -1};qq.getUniqueId=(function(){var a=0;return function(){return a++}})();qq.attach=function(a,c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}};qq.detach=function(a,c,b){if(a.removeEventListener){a.removeEventListener(c,b,false)}else{if(a.attachEvent){a.detachEvent("on"+c,b)}}};qq.preventDefault=function(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};qq.insertBefore=function(d,c){c.parentNode.insertBefore(d,c)};qq.remove=function(a){a.parentNode.removeChild(a)};qq.contains=function(b,a){if(b==a){return true}if(b.contains){return b.contains(a)}else{return !!(a.compareDocumentPosition(b)&8)}};qq.toElement=(function(){var a=document.createElement("div");return function(c){a.innerHTML=c;var b=a.firstChild;a.removeChild(b);return b}})();qq.css=function(a,b){if(b.opacity!=null){if(typeof a.style.opacity!="string"&&typeof(a.filters)!="undefined"){b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"}}qq.extend(a.style,b)};qq.hasClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");return c.test(b.className)};qq.addClass=function(b,a){if(!qq.hasClass(b,a)){b.className+=" "+a}};qq.removeClass=function(b,a){var c=new RegExp("(^| )"+a+"( |$)");b.className=b.className.replace(c," ").replace(/^\s+|\s+$/g,"")};qq.setText=function(a,b){a.innerText=b;a.textContent=b};qq.children=function(b){var a=[],c=b.firstChild;while(c){if(c.nodeType==1){a.push(c)}c=c.nextSibling}return a};qq.getByClass=function(d,e){if(d.querySelectorAll){return d.querySelectorAll("."+e)}var b=[];var f=d.getElementsByTagName("*");var a=f.length;for(var c=0;c<a;c++){if(qq.hasClass(f[c],e)){b.push(f[c])}}return b};qq.ie=function(){return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie10=function(){return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.obj2url=function(f,b,h){var g=[],d="&",e=function(k,j){var l=b?(/\[\]$/.test(b))?b:b+"["+j+"]":j;if((l!="undefined")&&(j!="undefined")){g.push((typeof k==="object")?qq.obj2url(k,l,true):(Object.prototype.toString.call(k)==="[object Function]")?encodeURIComponent(l)+"="+encodeURIComponent(k()):encodeURIComponent(l)+"="+encodeURIComponent(k))}};if(!h&&b){d=(/\?/.test(b))?(/\?$/.test(b))?"":"&":"?";g.push(b);g.push(qq.obj2url(f))}else{if((Object.prototype.toString.call(f)==="[object Array]")&&(typeof f!="undefined")){for(var c=0,a=f.length;c<a;++c){e(f[c],c)}}else{if((typeof f!="undefined")&&(f!==null)&&(typeof f==="object")){for(var c in f){e(f[c],c)}}else{g.push(encodeURIComponent(b)+"="+encodeURIComponent(f))}}}return g.join(d).replace(/^&/,"").replace(/%20/g,"+")};qq.isObject=function(a){return a!==null&&a&&typeof(a)==="object"&&a.constructor===Object};qq.isFunction=function(a){return typeof(a)==="function"};qq.each=function(c,d){var a,b;if(c){for(a in c){if(Object.prototype.hasOwnProperty.call(c,a)){b=d(a,c[a]);if(b===false){break}}}}};qq.obj2FormData=function(c,b,a){if(!b){b=new FormData()}qq.each(c,function(d,e){d=a?a+"["+d+"]":d;if(qq.isObject(e)){qq.obj2FormData(e,b,d)}else{if(qq.isFunction(e)){b.append(d,e())}else{b.append(d,e)}}});return b};qq.obj2Inputs=function(c,b){var a;if(!b){b=document.createElement("form")}qq.obj2FormData(c,{append:function(d,e){a=document.createElement("input");a.setAttribute("name",d);a.setAttribute("value",e);b.appendChild(a)}});return b};var qq=qq||{};qq.FileUploaderBasic=function(b){var a=this;this._options={debug:false,action:"/server/upload",params:{},button:null,multiple:true,maxConnections:3,autoUpload:true,sendAsForm:false,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(d,c){},onProgress:function(f,e,c,d){},onComplete:function(e,d,c){},onCancel:function(d,c){},onValidate:function(c,d){},onError:function(e,d,c){},urlHandler:false,messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled.",noFiles:"Only files on your computer can be uploaded."},showMessage:function(c){alert(c)}};qq.extend(this._options,b);this._filesInProgress=0;this._storedFiles=[];this._handler=this._createUploadHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}this._preventLeaveInProgress()};qq.FileUploaderBasic.prototype={setParams:function(a){this._options.params=a},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){for(var a=0;a<this._storedFiles.length;a++){var b=this._getItemByFileId(this._storedFiles[a]);this._find(b,"spinner").style.display="";this._filesInProgress++;this._handler.upload(this._storedFiles[a],this._options.params)}},clearStoredFiles:function(){this._storedFiles=[];this._options.listElement.innerHTML=""},_createUploadButton:function(b){var a=this;return new qq.UploadButton({element:b,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(c){a._onInputChange(c);a._createUploadButton(b)}})},_createUploadHandler:function(){var a=this,c;if(qq.UploadHandlerXhr.isSupported()){c="UploadHandlerXhr"}else{c="UploadHandlerForm"}var b=new qq[c]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(g,f,d,e){a._onProgress(g,f,d,e);a._options.onProgress(g,f,d,e)},onComplete:function(f,e,d){a._onComplete(f,e,d);a._options.onComplete(f,e,d)},onCancel:function(e,d){a._onCancel(e,d);a._options.onCancel(e,d)}});return b},_preventLeaveInProgress:function(){var a=this;qq.attach(window,"beforeunload",function(b){if(!a._filesInProgress){return}var b=b||window.event;b.returnValue=a._options.messages.onLeave;return a._options.messages.onLeave})},_onSubmit:function(b,a){this._filesInProgress++},_onProgress:function(d,c,a,b){},_onComplete:function(c,b,a){this._filesInProgress--;if(a.error){this._options.showMessage(a.error)}},_onCancel:function(b,a){this._filesInProgress--},_onInputChange:function(a){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(a.files)}else{if(this._validateFile(a)){this._uploadFile(a)}}this._button.reset()},_uploadFileList:function(d){var c,b;c=this._getValidationDescriptors(d);if(c.length>1){b=this._options.onValidate(c,true)===false}if(!b){if(typeof d=="undefined"||d.length<1){this._error("noFiles","empty");return false}for(var a=0;a<d.length;a++){if(!this._validateFile(d[a])){return}}for(var a=0;a<d.length;a++){this._uploadFile(d[a])}}},_uploadFile:function(a){var d=this._handler.add(a);var c=this._handler.getName(d);if(this._options.onSubmit(d,c,a)!==false){this._handler._options.action=this._options.action;this._handler._options.sendAsForm=this._options.sendAsForm;this._onSubmit(d,c);if(this._options.autoUpload){this._handler.upload(d,this._options.params)}else{this._filesInProgress--;var b=this._getItemByFileId(d);this._find(b,"spinner").style.display="none";this._storedFiles.push(d)}}},_validateFile:function(d){var a,b,c;a=this._getValidationDescriptor(d);if(this._options.onValidate(a,false)===false){return false}if(d.value){b=d.value.replace(/.*(\/|\\)/,"")}else{b=d.fileName!=null?d.fileName:d.name;c=d.fileSize!=null?d.fileSize:d.size}if(!this._isAllowedExtension(b)){this._error("typeError",b);return false}else{if(c===0){this._error("emptyError",b);return false}else{if(c&&this._options.sizeLimit&&c>this._options.sizeLimit){this._error("sizeError",b);return false}else{if(c&&c<this._options.minSizeLimit){this._error("minSizeError",b);return false}}}}return true},_error:function(c,d){var b=this._options.messages[c];function a(e,f){b=b.replace(e,f)}a("{file}",this._formatFileName(d));a("{extensions}",this._options.allowedExtensions.join(", "));a("{sizeLimit}",this._formatSize(this._options.sizeLimit));a("{minSizeLimit}",this._formatSize(this._options.minSizeLimit));this._options.onError(null,d,b);this._options.showMessage(b);if(this._options.onError(b,d)!==false){this._options.onError(b,d)}},_formatFileName:function(a){if(a.length>33){a=a.slice(0,19)+"..."+a.slice(-13)}return a},_isAllowedExtension:function(d){var b=(-1!==d.indexOf("."))?d.replace(/.*[.]/,"").toLowerCase():"";var c=this._options.allowedExtensions;if(!c.length){return true}for(var a=0;a<c.length;a++){if(c[a].toLowerCase()==b){return true}}return false},_formatSize:function(a){var b=-1;do{a=a/1024;b++}while(a>99);return Math.max(a,0.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][b]},_parseFileName:function(b){var a;if(b.value){a=b.value.replace(/.*(\/|\\)/,"")}else{a=(b.fileName!==null&&b.fileName!==undefined)?b.fileName:b.name}return a},_parseFileSize:function(b){var a;if(!b.value){a=(b.fileSize!==null&&b.fileSize!==undefined)?b.fileSize:b.size}return a},_getValidationDescriptor:function(d){var b,c,a;a={};b=this._parseFileName(d);c=this._parseFileSize(d);a.name=b;if(c){a.size=c}return a},_getValidationDescriptors:function(b){var a,c;c=[];for(a=0;a<b.length;a++){c.push(b[a])}return c}};qq.FileUploader=function(b){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,dropElement:null,listElement:null,skipDropElement:false,skipUploadElement:false,template:'<div class="qq-uploader"><div class="qq-upload-drop-area" style="display:none"><span>Drop files here to upload</span></div><div type="button" class="qq-upload-button button2 small">Upload Image</div><ul class="qq-upload-list" style="display:none;"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a><span class="qq-upload-failed-text">Failed</span></li>',classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"},additionalUploadIds:false});qq.extend(this._options,b);this._element=this._options.element;if(!this._options.skipDropTemplate){this._dropElement=this._options.dropElement?this._options.dropElement:this._options.element}if(!this._options.skipUploadTemplate){this._element.innerHTML=this._options.template;this._button=this._createUploadButton(this._find(this._element,"button"));if(this._options.additionalUploadIds){for(var a=0;a<this._options.additionalUploadIds.length;a++){this._createUploadButton($(this._options.additionalUploadIds[a]))}}}this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;this._bindCancelEvent();if(!this._options.skipDropTemplate){this._setupDragDrop()}};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);qq.extend(qq.FileUploader.prototype,{_find:function(c,b){var a=qq.getByClass(c,this._options.classes[b])[0];if(!a){throw new Error("element not found "+b)}return a},_setupDragDrop:function(){var b=this,c=this._find(this._dropElement,"drop");var a=new qq.UploadDropZone({element:c,onEnter:function(d){qq.addClass(c,b._classes.dropActive);d.stopPropagation()},onLeave:function(d){d.stopPropagation()},onLeaveNotDescendants:function(d){qq.removeClass(c,b._classes.dropActive)},onDrop:function(h){gtrack.track_events("[ttp]:sidebar/minisuper","drag-n-drop","");var g=qq.getByClass(document,b._options.classes.drop);for(var f=0;f<g.length;f++){if(g[f]){qq.removeClass(g[f],b._classes.dropActive);g[f].style.display="none";$$("body")[0].removeClassName("qq-dragging")}}if(b._options.urlHandler&&h.dataTransfer.files.length==0){if(h.dataTransfer.types.indexOf&&-1!=h.dataTransfer.types.indexOf("text/uri-list")||h.dataTransfer.types.contains&&-1!=h.dataTransfer.types.contains("text/uri-list")){var d=h.dataTransfer.getData("text/uri-list");return b._options.urlHandler(h,d)}}b._uploadFileList(h.dataTransfer.files);if($(h.target).descendantOf($("suplist_omnibox_modules"))){gtrack.track_events("[ttp]:edit-item","drag-drop-image")}}});c.style.display="none";c.hide_fn=function(){this.style.display="none";$$("body")[0].removeClassName("qq-dragging")}.bind(c);qq.attach(document,"dragenter",function(d){$$("body")[0].addClassName("qq-dragging");if(!a._isValidFileDrag(d)||c.className.match(/disabled/)){return}c.style.display="block"});qq.attach(document,"dragleave",function(f){var d=document.elementFromPoint(f.clientX,f.clientY);if(!d||d.nodeName=="HTML"||d.nodeName=="BODY"){c.hide_fn()}})},_onSubmit:function(b,a){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(b,a)},_onProgress:function(a,c,d,f){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var h=this._getItemByFileId(a);if(!h){var e=a;var b=0;while(!h){e++;b++;if(b>50){break}h=this._getItemByFileId(e)}}var i=this._find(h,"size");i.style.display="inline";var g;if(d!=f){g=Math.round(d/f*100)+"% from "+this._formatSize(f)}else{g=this._formatSize(f)}qq.setText(i,g)},_onComplete:function(f,e,a){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var c=this._getItemByFileId(f);if(!c){var b=f;var d=0;while(!c){b++;d++;if(d>50){break}c=this._getItemByFileId(b)}}qq.remove(this._find(c,"cancel"));qq.remove(this._find(c,"spinner"));if(a.success){qq.addClass(c,this._classes.success)}else{qq.addClass(c,this._classes.fail)}},_addToList:function(d,c){var a=qq.toElement(this._options.fileTemplate);a.qqFileId=d;var b=this._find(a,"file");qq.setText(b,this._formatFileName(c));this._find(a,"size").style.display="none";this._listElement.appendChild(a)},_getItemByFileId:function(b){var a=this._listElement.firstChild;while(a){if(a.qqFileId==b){return a}a=a.nextSibling}},_bindCancelEvent:function(){var a=this,b=this._listElement;if(b){qq.attach(b,"click",function(f){f=f||window.event;var d=f.target||f.srcElement;if(qq.hasClass(d,a._classes.cancel)){qq.preventDefault(f);var c=d.parentNode;a._handler.cancel(c.qqFileId);qq.remove(c)}})}}});qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(b){},onLeave:function(b){},onLeaveNotDescendants:function(b){},onDrop:function(b){}};qq.extend(this._options,a);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};qq.UploadDropZone.prototype={_disableDropOutside:function(a){if(!qq.UploadDropZone.dropOutsideDisabled){qq.attach(document,"dragover",function(b){if(b.dataTransfer){b.dataTransfer.dropEffect="none";b.preventDefault()}});qq.UploadDropZone.dropOutsideDisabled=true}},_attachEvents:function(){var a=this;qq.attach(a._element,"dragover",function(c){if(!a._isValidFileDrag(c)){return}var b=c.dataTransfer.effectAllowed;if(b=="move"||b=="linkMove"){c.dataTransfer.dropEffect="move"}else{c.dataTransfer.dropEffect="copy"}c.stopPropagation();c.preventDefault()});qq.attach(a._element,"dragenter",function(b){if(!a._isValidFileDrag(b)){return}a._options.onEnter(b)});qq.attach(a._element,"dragleave",function(c){if(!a._isValidFileDrag(c)){return}a._options.onLeave(c);var b=document.elementFromPoint(c.clientX,c.clientY);if(qq.contains(this,b)){return}a._options.onLeaveNotDescendants(c)});qq.attach(a._element,"drop",function(b){if(!a._isValidFileDrag(b)){return}b.preventDefault();a._options.onDrop(b)})},_isValidFileDrag:function(c){if(qq.ie()&&!qq.ie10()){return false}var b=c.dataTransfer,a=navigator.userAgent.indexOf("AppleWebKit")>-1;return b&&b.effectAllowed!="none"&&(b.files||(!a&&b.types&&b.types.contains&&b.types.contains("Files")))}};qq.UploadButton=function(a){this._options={element:null,multiple:false,name:"file",onChange:function(b){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);this._element=this._options.element;qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode){qq.remove(this._input)}qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function(){var c=$(this._element).down("input[type=file]");if(c){return c}var b=document.createElement("input");if(this._options.multiple){b.setAttribute("multiple","multiple")}b.setAttribute("type","file");b.setAttribute("name",this._options.name);b.setAttribute("rel:gt_act","ignore");qq.css(b,{position:"absolute",right:0,top:0,fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0,width:"100%",height:"100%"});b.addClassName("file_mask");this._element.appendChild(b);var a=this;qq.attach(b,"change",function(){a._options.onChange(b)});qq.attach(b,"mouseover",function(){qq.addClass(a._element,a._options.hoverClass)});qq.attach(b,"mouseout",function(){qq.removeClass(a._element,a._options.hoverClass)});qq.attach(b,"focus",function(){qq.addClass(a._element,a._options.focusClass)});qq.attach(b,"blur",function(){qq.removeClass(a._element,a._options.focusClass)});if(window.attachEvent){b.setAttribute("tabIndex","-1")}return b}};qq.UploadHandlerAbstract=function(a){this._options={debug:false,action:"/upload.php",maxConnections:999,onProgress:function(e,d,b,c){},onComplete:function(d,c,b){},onCancel:function(c,b){}};qq.extend(this._options,a);this._queue=[];this._params=[]};qq.UploadHandlerAbstract.prototype={log:function(a){if(this._options.debug&&window.console){console.log("[uploader] "+a)}},add:function(a){},upload:function(d,b){var a=this._queue.push(d);var c={};qq.extend(c,b);this._params[d]=c;if(a<=this._options.maxConnections){this._upload(d,this._params[d])}},cancel:function(a){this._cancel(a);this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++){this._cancel(this._queue[a])}this._queue=[]},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue},_upload:function(a){},_cancel:function(a){},_dequeue:function(d){var b=qq.indexOf(this._queue,d);this._queue.splice(b,1);var a=this._options.maxConnections;if(this._queue.length>=a&&b<a){var c=this._queue[a-1];this._upload(c,this._params[c])}}};qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name","image");var b="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[b]=a;if(a.parentNode){qq.remove(a)}return b},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},_cancel:function(b){this._options.onCancel(b,this.getName(b));delete this._inputs[b];var a=document.getElementById(b);if(a){a.setAttribute("src","javascript:false;");qq.remove(a)}},_upload:function(g,e){var b=this._inputs[g];if(!b){throw new Error("file with passed id was not added, or already uploaded or cancelled")}var f=this.getName(g);var c=this._createIframe(g);var d=this._createForm(c,e);d.appendChild(b);var a=this;this._attachLoadEvent(c,function(){a.log("iframe loaded");var h=a._getIframeContentJSON(c);a._options.onComplete(g,f,h);a._dequeue(g);delete a._inputs[g];setTimeout(function(){qq.remove(c)},1)});d.submit();qq.remove(d);return g},_attachLoadEvent:function(a,b){qq.attach(a,"load",function(){if(!a.parentNode){return}try{if(a.contentDocument&&a.contentDocument.body&&a.contentDocument.body.innerHTML=="false"){return}}catch(c){}b()})},_getIframeContentJSON:function(iframe){try{var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")")}catch(err){response={}}}catch(e){response={success:false}}return response},_createIframe:function(b){var a=qq.toElement('<iframe src="javascript:false;" name="'+b+'" />');a.setAttribute("id",b);a.style.display="none";document.body.appendChild(a);return a},_createForm:function(a,c){var b=qq.toElement('<form method="post" enctype="multipart/form-data"></form>');qq.obj2Inputs(c,b);b.setAttribute("action",this._options.action);b.setAttribute("target",a.name);b.style.display="none";document.body.appendChild(b);return b}});qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){try{var a=document.createElement("input");a.type="file";var c=false;var b=navigator.userAgent.toLowerCase();if(b.indexOf("safari")!=-1){c=true;if(b.indexOf("chrome")>-1){c=false}}var f=(typeof FileReader!="undefined"&&typeof(new FileReader()).readAsBinaryString=="undefined");return("multiple" in a&&typeof File!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined"&&typeof FileReader!="undefined"&&typeof window.WebKitBlobBuilder=="undefined"&&!c&&!f)}catch(d){console.error(d);return false}};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")}return this._files.push(a)-1},getName:function(b){var a=this._files[b];return a.fileName!=null?a.fileName:a.name},getSize:function(b){var a=this._files[b];return a.fileSize!=null?a.fileSize:a.size},getLoaded:function(a){return this._loaded[a]||0},_upload:function(c,g){var f=this._files[c],b=this.getName(c),l=this.getSize(c);this._loaded[c]=0;var j=this._xhrs[c]=new XMLHttpRequest();var k=this;j.upload.onprogress=function(m){if(m.lengthComputable){k._loaded[c]=m.loaded;k._options.onProgress(c,b,m.loaded,m.total)}};j.onreadystatechange=function(){if(j.readyState==4){k._onComplete(c,j)}};g=g||{};var a=qq.obj2url(g,this._options.action);j.open("POST",a,true);if(this._options.sendAsForm){try{if(typeof XMLHttpRequest.prototype.sendAsBinary=="undefined"){XMLHttpRequest.prototype.sendAsBinary=function(o){var n=new ArrayBuffer(o.length);var e=new Uint8Array(n,0);for(var m=0;m<o.length;m++){e[m]=(o.charCodeAt(m)&255)}this.send(e)}}}catch(i){console.error(i)}var d="---------------------------";d+=Math.floor(Math.random()*32768);d+=Math.floor(Math.random()*32768);d+=Math.floor(Math.random()*32768);var h=new FileReader();h.readAsBinaryString(f);h.onload=function(m){g.Filedata=h.result;g.Filename=encodeURIComponent(f.name);var e="";$H(g).each(function(n){if(e!=""){e+="\r\n"}e+="--"+d+'\r\nContent-Disposition: form-data; charset: utf-8; accept-charset: utf-8; name="'+n.key+'"';if(n.key=="Filedata"){e+='; filename="'+encodeURIComponent(f.name)+'"\r\nContent-Type: application/octet-stream'}e+="\r\n\r\n"+n.value});e+="\r\n";e+="--"+d+"--\r\n";j.setRequestHeader("Content-Type","multipart/form-data; charset: utf-8; accept-charset: utf-8; boundary="+d);j.sendAsBinary(e)}}else{j.setRequestHeader("X-Requested-With","XMLHttpRequest");j.setRequestHeader("X-File-Name",encodeURIComponent(b));j.setRequestHeader("Content-Type","application/octet-stream");j.send(f)}},_onComplete:function(id,xhr){if(!this._files[id]){return}var xhr_request=this._xhrs[id];if(BF_STATIC.bf_env==="dev"){if(!window.AJAX_TEST_STATUS[this._options.action]){window.AJAX_TEST_STATUS[this._options.action]=new RequestStack()}var req={xhr_request:xhr_request};req.status=xhr.status;window.AJAX_TEST_STATUS[this._options.action].push(req)}var name=this.getName(id);var size=this.getSize(id);this._options.onProgress(id,name,size,size);if(xhr.status==200){this.log("xhr - server response received");this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}this._options.onComplete(id,name,response)}else{this._options.onComplete(id,name,{})}this._files[id]=null;this._xhrs[id]=null;this._dequeue(id)},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;if(this._xhrs[a]){this._xhrs[a].abort();this._xhrs[a]=null}}});var CropDraggable=Class.create(Draggable,{initialize:function(b){try{this.options=Object.extend({drawMethod:function(){}},arguments[1]||{});this.element=$(b);this.handle=this.element;this.delta=this.currentDelta();this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)}catch(c){console.error(c)}},draw:function(f){var g=Element.cumulativeOffset(this.element),h=this.currentDelta();g[0]-=h[0];g[1]-=h[1];var d=[0,1].map(function(a){return(f[a]-g[a]-this.offset[a])}.bind(this));this.options.drawMethod(d)}});var Cropper={};Cropper.Img=Class.create({initialize:function(h,f){this.options=Object.extend({ratioDim:{x:0,y:0},minWidth:0,minHeight:0,displayOnInit:false,onEndCrop:Prototype.emptyFunction,captureKeys:true,onloadCoords:null,maxWidth:0,maxHeight:0,autoIncludeCSS:true},f||{});this.img=$(h);this.clickCoords={x:0,y:0};this.dragging=false;this.resizing=false;this.isWebKit=/Konqueror|Safari|KHTML/.test(navigator.userAgent);this.isIE=/MSIE/.test(navigator.userAgent);this.isOpera8=/Opera\s[1-8]/.test(navigator.userAgent);this.ratioX=0;this.ratioY=0;this.attached=false;this.fixedWidth=(this.options.maxWidth>0&&(this.options.minWidth>=this.options.maxWidth));this.fixedHeight=(this.options.maxHeight>0&&(this.options.minHeight>=this.options.maxHeight));if(typeof this.img=="undefined"){return}if(this.options.autoIncludeCSS){var g=document.createElement("link");g.rel="stylesheet";g.type="text/css";g.href=BF_STATIC.static_root+"/css/cropper.css";g.media="screen";document.getElementsByTagName("head")[0].appendChild(g)}if(this.options.ratioDim.x>0&&this.options.ratioDim.y>0){var e=this.getGCD(this.options.ratioDim.x,this.options.ratioDim.y);this.ratioX=this.options.ratioDim.x/e;this.ratioY=this.options.ratioDim.y/e}this.subInitialize();if(this.img.complete||this.isWebKit){this.onLoad()}else{Event.observe(this.img,"load",this.onLoad.bindAsEventListener(this))}},getGCD:function(a,b){if(b===0){return a}return this.getGCD(b,a%b)},onLoad:function(){var j="imgCrop_";var h=this.img.parentNode;var f="";if(this.isOpera8){f=" opera8"}this.imgWrap=new Element("div",{"class":j+"wrap"+f});this.north=new Element("div",{"class":j+"overlay "+j+"north"}).insert(new Element("span"));this.east=new Element("div",{"class":j+"overlay "+j+"east"}).insert(new Element("span"));this.south=new Element("div",{"class":j+"overlay "+j+"south"}).insert(new Element("span"));this.west=new Element("div",{"class":j+"overlay "+j+"west"}).insert(new Element("span"));var i=[this.north,this.east,this.south,this.west];this.dragArea=new Element("div",{"class":j+"dragArea"});i.each(function(a){this.dragArea.insert(a)},this);this.handleN=new Element("div",{"class":j+"handle "+j+"handleN"});this.handleNE=new Element("div",{"class":j+"handle "+j+"handleNE"});this.handleE=new Element("div",{"class":j+"handle "+j+"handleE"});this.handleSE=new Element("div",{"class":j+"handle "+j+"handleSE"});this.handleS=new Element("div",{"class":j+"handle "+j+"handleS"});this.handleSW=new Element("div",{"class":j+"handle "+j+"handleSW"});this.handleW=new Element("div",{"class":j+"handle "+j+"handleW"});this.handleNW=new Element("div",{"class":j+"handle "+j+"handleNW"});this.selArea=new Element("div",{"class":j+"selArea"});[new Element("div",{"class":j+"marqueeHoriz "+j+"marqueeNorth"}).insert(new Element("span")),new Element("div",{"class":j+"marqueeVert "+j+"marqueeEast"}).insert(new Element("span")),new Element("div",{"class":j+"marqueeHoriz "+j+"marqueeSouth"}).insert(new Element("span")),new Element("div",{"class":j+"marqueeVert "+j+"marqueeWest"}).insert(new Element("span")),this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW,new Element("div",{"class":j+"clickArea"})].each(function(a){this.selArea.insert(a)},this);this.imgWrap.appendChild(this.img);this.imgWrap.appendChild(this.dragArea);this.dragArea.appendChild(this.selArea);this.dragArea.appendChild(new Element("div",{"class":j+"clickArea"}));h.appendChild(this.imgWrap);this.startDragBind=this.startDrag.bindAsEventListener(this);Event.observe(this.dragArea,"mousedown",this.startDragBind);this.onDragBind=this.onDrag.bindAsEventListener(this);Event.observe(document,"mousemove",this.onDragBind);this.endCropBind=this.endCrop.bindAsEventListener(this);Event.observe(document,"mouseup",this.endCropBind);this.resizeBind=this.startResize.bindAsEventListener(this);this.handles=[this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW];this.registerHandles(true);if(this.options.captureKeys){this.keysBind=this.handleKeys.bindAsEventListener(this);Event.observe(document,"keypress",this.keysBind)}var g=new CropDraggable(this.selArea,{drawMethod:this.moveArea.bindAsEventListener(this)});this.setParams()},registerHandles:function(h){for(var m=0;m<this.handles.length;m++){var j=$(this.handles[m]);if(h){var i=false;if(this.fixedWidth&&this.fixedHeight){i=true}else{if(this.fixedWidth||this.fixedHeight){var n=j.className.match(/([S|N][E|W])$/),k=j.className.match(/(E|W)$/),l=j.className.match(/(N|S)$/);if(n||(this.fixedWidth&&k)||(this.fixedHeight&&l)){i=true}}}if(i){j.hide()}else{Event.observe(j,"mousedown",this.resizeBind)}}else{j.show();Event.stopObserving(j,"mousedown",this.resizeBind)}}},setParams:function(){this.imgW=this.img.width;this.imgH=this.img.height;$(this.north).setStyle({height:0});$(this.east).setStyle({width:0,height:0});$(this.south).setStyle({height:0});$(this.west).setStyle({width:0,height:0});$(this.imgWrap).setStyle({width:this.imgW+"px",height:this.imgH+"px"});$(this.selArea).hide();var c={x1:0,y1:0,x2:0,y2:0},d=false;if(this.options.onloadCoords!==null){c=this.cloneCoords(this.options.onloadCoords);d=true}else{if(this.options.ratioDim.x>0&&this.options.ratioDim.y>0){c.x1=Math.ceil((this.imgW-this.options.ratioDim.x)/2);c.y1=Math.ceil((this.imgH-this.options.ratioDim.y)/2);c.x2=c.x1+this.options.ratioDim.x;c.y2=c.y1+this.options.ratioDim.y;d=true}}this.setAreaCoords(c,false,false,1);if(this.options.displayOnInit&&d){this.selArea.show();this.drawArea();this.endCrop()}this.attached=true},remove:function(){if(this.attached){this.attached=false;this.imgWrap.parentNode.insertBefore(this.img,this.imgWrap);this.imgWrap.parentNode.removeChild(this.imgWrap);Event.stopObserving(this.dragArea,"mousedown",this.startDragBind);Event.stopObserving(document,"mousemove",this.onDragBind);Event.stopObserving(document,"mouseup",this.endCropBind);this.registerHandles(false);if(this.options.captureKeys){Event.stopObserving(document,"keypress",this.keysBind)}}},reset:function(){if(!this.attached){this.onLoad()}else{this.setParams()}this.endCrop()},handleKeys:function(c){var d={x:0,y:0};if(!this.dragging){switch(c.keyCode){case (37):d.x=-1;break;case (38):d.y=-1;break;case (39):d.x=1;break;case (40):d.y=1;break}if(d.x!==0||d.y!==0){if(c.shiftKey){d.x*=10;d.y*=10}this.moveArea([this.areaCoords.x1+d.x,this.areaCoords.y1+d.y]);this.endCrop();Event.stop(c)}}},calcW:function(){return(this.areaCoords.x2-this.areaCoords.x1)},calcH:function(){return(this.areaCoords.y2-this.areaCoords.y1)},moveArea:function(b){this.setAreaCoords({x1:b[0],y1:b[1],x2:b[0]+this.calcW(),y2:b[1]+this.calcH()},true,false);this.drawArea()},cloneCoords:function(b){return{x1:b.x1,y1:b.y1,x2:b.x2,y2:b.y2}},setAreaCoords:function(r,A,n,s,p){if(A){var q=r.x2-r.x1,v=r.y2-r.y1;if(r.x1<0){r.x1=0;r.x2=q}if(r.y1<0){r.y1=0;r.y2=v}if(r.x2>this.imgW){r.x2=this.imgW;r.x1=this.imgW-q}if(r.y2>this.imgH){r.y2=this.imgH;r.y1=this.imgH-v}}else{if(r.x1<0){r.x1=0}if(r.y1<0){r.y1=0}if(r.x2>this.imgW){r.x2=this.imgW}if(r.y2>this.imgH){r.y2=this.imgH}if(s!==null){if(this.ratioX>0){this.applyRatio(r,{x:this.ratioX,y:this.ratioY},s,p)}else{if(n){this.applyRatio(r,{x:1,y:1},s,p)}}var z=[this.options.minWidth,this.options.minHeight],o=[this.options.maxWidth,this.options.maxHeight];if(z[0]>0||z[1]>0||o[0]>0||o[1]>0){var t={a1:r.x1,a2:r.x2},w={a1:r.y1,a2:r.y2},x={min:0,max:this.imgW},y={min:0,max:this.imgH};if((z[0]!==0||z[1]!==0)&&n){if(z[0]>0){z[1]=z[0]}else{if(z[1]>0){z[0]=z[1]}}}if((o[0]!==0||o[0]!==0)&&n){if(o[0]>0&&o[0]<=o[1]){o[1]=o[0]}else{if(o[1]>0&&o[1]<=o[0]){o[0]=o[1]}}}if(z[0]>0){this.applyDimRestriction(t,z[0],s.x,x,"min")}if(z[1]>1){this.applyDimRestriction(w,z[1],s.y,y,"min")}if(o[0]>0){this.applyDimRestriction(t,o[0],s.x,x,"max")}if(o[1]>1){this.applyDimRestriction(w,o[1],s.y,y,"max")}r={x1:t.a1,y1:w.a1,x2:t.a2,y2:w.a2}}}}this.areaCoords=r},applyDimRestriction:function(k,i,j,l,g){var h;if(g=="min"){h=((k.a2-k.a1)<i)}else{h=((k.a2-k.a1)>i)}if(h){if(j==1){k.a2=k.a1+i}else{k.a1=k.a2-i}if(k.a1<l.min){k.a1=l.min;k.a2=i}else{if(k.a2>l.max){k.a1=l.max-i;k.a2=l.max}}}},applyRatio:function(j,g,h,f){var i;if(f=="N"||f=="S"){i=this.applyRatioToAxis({a1:j.y1,b1:j.x1,a2:j.y2,b2:j.x2},{a:g.y,b:g.x},{a:h.y,b:h.x},{min:0,max:this.imgW});j.x1=i.b1;j.y1=i.a1;j.x2=i.b2;j.y2=i.a2}else{i=this.applyRatioToAxis({a1:j.x1,b1:j.y1,a2:j.x2,b2:j.y2},{a:g.x,b:g.y},{a:h.x,b:h.y},{min:0,max:this.imgH});j.x1=i.a1;j.y1=i.b1;j.x2=i.a2;j.y2=i.b2}},applyRatioToAxis:function(l,o,m,s){var k=Object.extend(l,{}),p=k.a2-k.a1,t=Math.floor(p*o.b/o.a),n=null,r=null,q=null;if(m.b==1){n=k.b1+t;if(n>s.max){n=s.max;q=n-k.b1}k.b2=n}else{n=k.b2-t;if(n<s.min){n=s.min;q=n+k.b2}k.b1=n}if(q!==null){r=Math.floor(q*o.a/o.b);if(m.a==1){k.a2=k.a1+r}else{k.a1=k.a1=k.a2-r}}return k},drawArea:function(){var m=this.calcW(),p=this.calcH();var n="px",r=[this.areaCoords.x1+n,this.areaCoords.y1+n,m+n,p+n,this.areaCoords.x2+n,this.areaCoords.y2+n,(this.img.width-this.areaCoords.x2)+n,(this.img.height-this.areaCoords.y2)+n];var o=this.selArea.style;o.left=r[0];o.top=r[1];o.width=r[2];o.height=r[3];var l=Math.ceil((m-6)/2)+n,q=Math.ceil((p-6)/2)+n;this.handleN.style.left=l;this.handleE.style.top=q;this.handleS.style.left=l;this.handleW.style.top=q;this.north.style.height=r[1];var t=this.east.style;t.top=r[1];t.height=r[3];t.left=r[4];t.width=r[6];var k=this.south.style;k.top=r[5];k.height=r[7];var s=this.west.style;s.top=r[1];s.height=r[3];s.width=r[0];this.subDrawArea();this.forceReRender()},forceReRender:function(){if(this.isIE||this.isWebKit){var i=document.createTextNode(" ");var k,d,j,h;if(this.isIE){fixEl=this.selArea}else{if(this.isWebKit){fixEl=document.getElementsByClassName("imgCrop_marqueeSouth",this.imgWrap)[0];k=new Element("div");k.style.visibility="hidden";var l=["SE","S","SW"];for(h=0;h<l.length;h++){d=document.getElementsByClassName("imgCrop_handle"+l[h],this.selArea)[0];if(d.childNodes.length){d.removeChild(d.childNodes[0])}d.appendChild(k)}}}fixEl.appendChild(i);fixEl.removeChild(i)}},startResize:function(b){this.startCoords=this.cloneCoords(this.areaCoords);this.resizing=true;this.resizeHandle=Event.element(b).classNames().toString().replace(/([^N|NE|E|SE|S|SW|W|NW])+/,"");Event.stop(b)},startDrag:function(b){this.selArea.show();this.clickCoords=this.getCurPos(b);this.setAreaCoords({x1:this.clickCoords.x,y1:this.clickCoords.y,x2:this.clickCoords.x,y2:this.clickCoords.y},false,false,null);this.dragging=true;this.onDrag(b);Event.stop(b)},getCurPos:function(d){var e=this.imgWrap,f=Element.cumulativeOffset(e);while(e.nodeName!="BODY"){f[1]-=e.scrollTop||0;f[0]-=e.scrollLeft||0;e=e.parentNode}return{x:Event.pointerX(d)-f[0],y:Event.pointerY(d)-f[1]}},onDrag:function(h){if(this.dragging||this.resizing){var e=null,g=this.getCurPos(h),i=this.cloneCoords(this.areaCoords),j={x:1,y:1};if(this.dragging){if(g.x<this.clickCoords.x){j.x=-1}if(g.y<this.clickCoords.y){j.y=-1}this.transformCoords(g.x,this.clickCoords.x,i,"x");this.transformCoords(g.y,this.clickCoords.y,i,"y")}else{if(this.resizing){e=this.resizeHandle;if(e.match(/E/)){this.transformCoords(g.x,this.startCoords.x1,i,"x");if(g.x<this.startCoords.x1){j.x=-1}}else{if(e.match(/W/)){this.transformCoords(g.x,this.startCoords.x2,i,"x");if(g.x<this.startCoords.x2){j.x=-1}}}if(e.match(/N/)){this.transformCoords(g.y,this.startCoords.y2,i,"y");if(g.y<this.startCoords.y2){j.y=-1}}else{if(e.match(/S/)){this.transformCoords(g.y,this.startCoords.y1,i,"y");if(g.y<this.startCoords.y1){j.y=-1}}}}}this.setAreaCoords(i,false,h.shiftKey,j,e);this.drawArea();Event.stop(h)}},transformCoords:function(f,g,h,i){var j=[f,g];if(f>g){j.reverse()}h[i+"1"]=j[0];h[i+"2"]=j[1]},endCrop:function(){this.dragging=false;this.resizing=false;this.options.onEndCrop(this.areaCoords,{width:this.calcW(),height:this.calcH()})},subInitialize:function(){},subDrawArea:function(){}});Cropper.ImgWithPreview=Class.create(Cropper.Img,{subInitialize:function(){this.hasPreviewImg=false;if(typeof(this.options.previewWrap)!="undefined"&&this.options.minWidth>0&&this.options.minHeight>0){this.previewWrap=$(this.options.previewWrap);this.previewImg=this.img.cloneNode(false);this.previewImg.id="imgCrop_"+this.previewImg.id;this.options.displayOnInit=true;this.hasPreviewImg=true;this.previewWrap.addClassName("imgCrop_previewWrap");this.previewWrap.setStyle({width:this.options.minWidth+"px",height:this.options.minHeight+"px"});this.previewWrap.appendChild(this.previewImg)}},subDrawArea:function(){if(this.hasPreviewImg){var k=this.calcW(),j=this.calcH();var i={x:this.imgW/k,y:this.imgH/j};var l={x:k/this.options.minWidth,y:j/this.options.minHeight};var h={w:Math.ceil(this.options.minWidth*i.x)+"px",h:Math.ceil(this.options.minHeight*i.y)+"px",x:"-"+Math.ceil(this.areaCoords.x1/l.x)+"px",y:"-"+Math.ceil(this.areaCoords.y1/l.y)+"px"};var g=this.previewImg.style;g.width=h.w;g.height=h.h;g.left=h.x;g.top=h.y}}});
/*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var audioplayer_swfobject=function(){var E="undefined",r="object",T="Shockwave Flash",X="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",S="SWFObjectExprInst",y="onreadystatechange",P=window,j=document,t=navigator,U=false,V=[h],o=[],O=[],J=[],l,R,F,C,K=false,a=false,n,H,m=true,N=function(){var ab=typeof j.getElementById!=E&&typeof j.getElementsByTagName!=E&&typeof j.createElement!=E,ai=t.userAgent.toLowerCase(),Z=t.platform.toLowerCase(),af=Z?/win/.test(Z):/win/.test(ai),ad=Z?/mac/.test(Z):/mac/.test(ai),ag=/webkit/.test(ai)?parseFloat(ai.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,Y=!+"\v1",ah=[0,0,0],ac=null;if(typeof t.plugins!=E&&typeof t.plugins[T]==r){ac=t.plugins[T].description;if(ac&&!(typeof t.mimeTypes!=E&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){U=true;Y=false;ac=ac.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ah[0]=parseInt(ac.replace(/^(.*)\..*$/,"$1"),10);ah[1]=parseInt(ac.replace(/^.*\.(.*)\s.*$/,"$1"),10);ah[2]=/[a-zA-Z]/.test(ac)?parseInt(ac.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof P.ActiveXObject!=E){try{var ae=new ActiveXObject(X);if(ae){ac=ae.GetVariable("$version");if(ac){Y=true;ac=ac.split(" ")[1].split(",");ah=[parseInt(ac[0],10),parseInt(ac[1],10),parseInt(ac[2],10)]}}}catch(aa){}}}return{w3:ab,pv:ah,wk:ag,ie:Y,win:af,mac:ad}}(),k=function(){if(!N.w3){return}if((typeof j.readyState!=E&&j.readyState=="complete")||(typeof j.readyState==E&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!K){if(typeof j.addEventListener!=E){j.addEventListener("DOMContentLoaded",f,false)}if(N.ie&&N.win){j.attachEvent(y,function(){if(j.readyState=="complete"){j.detachEvent(y,arguments.callee);f()}});if(P==top){(function(){if(K){return}try{j.documentElement.doScroll("left")}catch(Y){setTimeout(arguments.callee,0);return}f()})()}}if(N.wk){(function(){if(K){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(K){return}try{var aa=j.getElementsByTagName("body")[0].appendChild(D("span"));aa.parentNode.removeChild(aa)}catch(ab){return}K=true;var Y=V.length;for(var Z=0;Z<Y;Z++){V[Z]()}}function L(Y){if(K){Y()}else{V[V.length]=Y}}function s(Z){if(typeof P.addEventListener!=E){P.addEventListener("load",Z,false)}else{if(typeof j.addEventListener!=E){j.addEventListener("load",Z,false)}else{if(typeof P.attachEvent!=E){i(P,"onload",Z)}else{if(typeof P.onload=="function"){var Y=P.onload;P.onload=function(){Y();Z()}}else{P.onload=Z}}}}}function h(){if(U){W()}else{I()}}function W(){var Y=j.getElementsByTagName("body")[0];var ab=D(r);ab.setAttribute("type",q);var aa=Y.appendChild(ab);if(aa){var Z=0;(function(){if(typeof aa.GetVariable!=E){var ac=aa.GetVariable("$version");if(ac){ac=ac.split(" ")[1].split(",");N.pv=[parseInt(ac[0],10),parseInt(ac[1],10),parseInt(ac[2],10)]}}else{if(Z<10){Z++;setTimeout(arguments.callee,10);return}}Y.removeChild(ab);aa=null;I()})()}else{I()}}function I(){var ah=o.length;if(ah>0){for(var ag=0;ag<ah;ag++){var Z=o[ag].id;var ac=o[ag].callbackFn;var ab={success:false,id:Z};if(N.pv[0]>0){var af=c(Z);if(af){if(G(o[ag].swfVersion)&&!(N.wk&&N.wk<312)){x(Z,true);if(ac){ab.success=true;ab.ref=A(Z);ac(ab)}}else{if(o[ag].expressInstall&&B()){var aj={};aj.data=o[ag].expressInstall;aj.width=af.getAttribute("width")||"0";aj.height=af.getAttribute("height")||"0";if(af.getAttribute("class")){aj.styleclass=af.getAttribute("class")}if(af.getAttribute("align")){aj.align=af.getAttribute("align")}var ai={};var Y=af.getElementsByTagName("param");var ad=Y.length;for(var ae=0;ae<ad;ae++){if(Y[ae].getAttribute("name").toLowerCase()!="movie"){ai[Y[ae].getAttribute("name")]=Y[ae].getAttribute("value")}}Q(aj,ai,Z,ac)}else{p(af);if(ac){ac(ab)}}}}}else{x(Z,true);if(ac){var aa=A(Z);if(aa&&typeof aa.SetVariable!=E){ab.success=true;ab.ref=aa}ac(ab)}}}}}function A(ab){var Y=null;var Z=c(ab);if(Z&&Z.nodeName=="OBJECT"){if(typeof Z.SetVariable!=E){Y=Z}else{var aa=Z.getElementsByTagName(r)[0];if(aa){Y=aa}}}return Y}function B(){return !a&&G("6.0.65")&&(N.win||N.mac)&&!(N.wk&&N.wk<312)}function Q(ab,ac,Y,aa){a=true;F=aa||null;C={success:false,id:Y};var af=c(Y);if(af){if(af.nodeName=="OBJECT"){l=g(af);R=null}else{l=af;R=Y}ab.id=S;if(typeof ab.width==E||(!/%$/.test(ab.width)&&parseInt(ab.width,10)<310)){ab.width="310"}if(typeof ab.height==E||(!/%$/.test(ab.height)&&parseInt(ab.height,10)<137)){ab.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ae=N.ie&&N.win?"ActiveX":"PlugIn",ad="MMredirectURL="+P.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ae+"&MMdoctitle="+j.title;if(typeof ac.flashvars!=E){ac.flashvars+="&"+ad}else{ac.flashvars=ad}if(N.ie&&N.win&&af.readyState!=4){var Z=D("div");Y+="SWFObjectNew";Z.setAttribute("id",Y);af.parentNode.insertBefore(Z,af);af.style.display="none";(function(){if(af.readyState==4){af.parentNode.removeChild(af)}else{setTimeout(arguments.callee,10)}})()}v(ab,ac,Y)}}function p(Z){if(N.ie&&N.win&&Z.readyState!=4){var Y=D("div");Z.parentNode.insertBefore(Y,Z);Y.parentNode.replaceChild(g(Z),Y);Z.style.display="none";(function(){if(Z.readyState==4){Z.parentNode.removeChild(Z)}else{setTimeout(arguments.callee,10)}})()}else{Z.parentNode.replaceChild(g(Z),Z)}}function g(ad){var ab=D("div");if(N.win&&N.ie){ab.innerHTML=ad.innerHTML}else{var Z=ad.getElementsByTagName(r)[0];if(Z){var ae=Z.childNodes;if(ae){var Y=ae.length;for(var aa=0;aa<Y;aa++){if(!(ae[aa].nodeType==1&&ae[aa].nodeName=="PARAM")&&!(ae[aa].nodeType==8)){ab.appendChild(ae[aa].cloneNode(true))}}}}}return ab}function v(aj,ah,Z){var Y,ab=c(Z);if(N.wk&&N.wk<312){return Y}if(ab){if(typeof aj.id==E){aj.id=Z}if(N.ie&&N.win){var ai="";for(var af in aj){if(aj[af]!=Object.prototype[af]){if(af.toLowerCase()=="data"){ah.movie=aj[af]}else{if(af.toLowerCase()=="styleclass"){ai+=' class="'+aj[af]+'"'}else{if(af.toLowerCase()!="classid"){ai+=" "+af+'="'+aj[af]+'"'}}}}}var ag="";for(var ae in ah){if(ah[ae]!=Object.prototype[ae]){ag+='<param name="'+ae+'" value="'+ah[ae]+'" />'}}ab.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ai+">"+ag+"</object>";O[O.length]=aj.id;Y=c(aj.id)}else{var aa=D(r);aa.setAttribute("type",q);for(var ad in aj){if(aj[ad]!=Object.prototype[ad]){if(ad.toLowerCase()=="styleclass"){aa.setAttribute("class",aj[ad])}else{if(ad.toLowerCase()!="classid"){aa.setAttribute(ad,aj[ad])}}}}for(var ac in ah){if(ah[ac]!=Object.prototype[ac]&&ac.toLowerCase()!="movie"){e(aa,ac,ah[ac])}}ab.parentNode.replaceChild(aa,ab);Y=aa}}return Y}function e(aa,Y,Z){var ab=D("param");ab.setAttribute("name",Y);ab.setAttribute("value",Z);aa.appendChild(ab)}function z(Z){var Y=c(Z);if(Y&&Y.nodeName=="OBJECT"){if(N.ie&&N.win){Y.style.display="none";(function(){if(Y.readyState==4){b(Z)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.removeChild(Y)}}}function b(aa){var Z=c(aa);if(Z){for(var Y in Z){if(typeof Z[Y]=="function"){Z[Y]=null}}Z.parentNode.removeChild(Z)}}function c(aa){var Y=null;try{Y=j.getElementById(aa)}catch(Z){}return Y}function D(Y){return j.createElement(Y)}function i(aa,Y,Z){aa.attachEvent(Y,Z);J[J.length]=[aa,Y,Z]}function G(aa){var Z=N.pv,Y=aa.split(".");Y[0]=parseInt(Y[0],10);Y[1]=parseInt(Y[1],10)||0;Y[2]=parseInt(Y[2],10)||0;return(Z[0]>Y[0]||(Z[0]==Y[0]&&Z[1]>Y[1])||(Z[0]==Y[0]&&Z[1]==Y[1]&&Z[2]>=Y[2]))?true:false}function w(ad,Z,ae,ac){if(N.ie&&N.mac){return}var ab=j.getElementsByTagName("head")[0];if(!ab){return}var Y=(ae&&typeof ae=="string")?ae:"screen";if(ac){n=null;H=null}if(!n||H!=Y){var aa=D("style");aa.setAttribute("type","text/css");aa.setAttribute("media",Y);n=ab.appendChild(aa);if(N.ie&&N.win&&typeof j.styleSheets!=E&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}H=Y}if(N.ie&&N.win){if(n&&typeof n.addRule==r){n.addRule(ad,Z)}}else{if(n&&typeof j.createTextNode!=E){n.appendChild(j.createTextNode(ad+" {"+Z+"}"))}}}function x(aa,Y){if(!m){return}var Z=Y?"visible":"hidden";if(K&&c(aa)){c(aa).style.visibility=Z}else{w("#"+aa,"visibility:"+Z)}}function M(Z){var aa=/[\\\"<>\.;]/;var Y=aa.exec(Z)!=null;return Y&&typeof encodeURIComponent!=E?encodeURIComponent(Z):Z}var d=function(){if(N.ie&&N.win){window.attachEvent("onunload",function(){var ad=J.length;for(var ac=0;ac<ad;ac++){J[ac][0].detachEvent(J[ac][1],J[ac][2])}var aa=O.length;for(var ab=0;ab<aa;ab++){z(O[ab])}for(var Z in N){N[Z]=null}N=null;for(var Y in audioplayer_swfobject){audioplayer_swfobject[Y]=null}audioplayer_swfobject=null})}}();return{registerObject:function(ac,Y,ab,aa){if(N.w3&&ac&&Y){var Z={};Z.id=ac;Z.swfVersion=Y;Z.expressInstall=ab;Z.callbackFn=aa;o[o.length]=Z;x(ac,false)}else{if(aa){aa({success:false,id:ac})}}},getObjectById:function(Y){if(N.w3){return A(Y)}},embedSWF:function(ac,ai,af,ah,Z,ab,aa,ae,ag,ad){var Y={success:false,id:ai};if(N.w3&&!(N.wk&&N.wk<312)&&ac&&ai&&af&&ah&&Z){x(ai,false);L(function(){af+="";ah+="";var ak={};if(ag&&typeof ag===r){for(var am in ag){ak[am]=ag[am]}}ak.data=ac;ak.width=af;ak.height=ah;var an={};if(ae&&typeof ae===r){for(var al in ae){an[al]=ae[al]}}if(aa&&typeof aa===r){for(var aj in aa){if(typeof an.flashvars!=E){an.flashvars+="&"+aj+"="+aa[aj]}else{an.flashvars=aj+"="+aa[aj]}}}if(G(Z)){var ao=v(ak,an,ai);if(ak.id==ai){x(ai,true)}Y.success=true;Y.ref=ao}else{if(ab&&B()){ak.data=ab;Q(ak,an,ai,ad);return}else{x(ai,true)}}if(ad){ad(Y)}})}else{if(ad){ad(Y)}}},switchOffAutoHideShow:function(){m=false},ua:N,getFlashPlayerVersion:function(){return{major:N.pv[0],minor:N.pv[1],release:N.pv[2]}},hasFlashPlayerVersion:G,createSWF:function(aa,Z,Y){if(N.w3){return v(aa,Z,Y)}else{return undefined}},showExpressInstall:function(aa,ab,Y,Z){if(N.w3&&B()){Q(aa,ab,Y,Z)}},removeSWF:function(Y){if(N.w3){z(Y)}},createCSS:function(ab,aa,Z,Y){if(N.w3){w(ab,aa,Z,Y)}},addDomLoadEvent:L,addLoadEvent:s,getQueryParamValue:function(ab){var aa=j.location.search||j.location.hash;if(aa){if(/\?/.test(aa)){aa=aa.split("?")[1]}if(ab==null){return M(aa)}var Z=aa.split("&");for(var Y=0;Y<Z.length;Y++){if(Z[Y].substring(0,Z[Y].indexOf("="))==ab){return M(Z[Y].substring((Z[Y].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var Y=c(S);if(Y&&l){Y.parentNode.replaceChild(l,Y);if(R){x(R,true);if(N.ie&&N.win){l.style.display="block"}}if(F){F(C)}}a=false}}}}();var AudioPlayer=function(){var b=[];var f={};var e={};var c="";var g={};var d=-1;var i="9";function h(j){if(document.all&&!window[j]){for(var k=0;k<document.forms.length;k++){if(document.forms[k][j]){return document.forms[k][j];break}}}return document.all?window[j]:document[j]}function a(j,k,l){h(j).addListener(k,l)}return{setup:function(k,j){c=k;g=j;if(audioplayer_swfobject.hasFlashPlayerVersion(i)){audioplayer_swfobject.switchOffAutoHideShow();audioplayer_swfobject.createCSS("p.audioplayer_container span","visibility:hidden;height:24px;overflow:hidden;padding:0;border:none;")}},getPlayer:function(j){return h(j)},addListener:function(j,k,l){a(j,k,l)},embed:function(j,l){var o={};var m;var k={};var p={};var n={};for(m in g){o[m]=g[m]}for(m in l){o[m]=l[m]}if(o.transparentpagebg=="yes"){k.bgcolor="#FFFFFF";k.wmode="transparent"}else{if(o.pagebg){k.bgcolor="#"+o.pagebg}k.wmode="opaque"}k.menu="false";for(m in o){if(m=="pagebg"||m=="width"||m=="transparentpagebg"){continue}p[m]=o[m]}n.name=j;n.style="outline: none";p.playerID=j;audioplayer_swfobject.embedSWF(c,j,o.width.toString(),"24",i,false,p,k,n);b.push(j);if(l.group){f[j]=l.group}},syncVolumes:function(j,l){if(f[j]){return}d=l;for(var k=0;k<b.length;k++){if(!f[b[k]]&&b[k]!=j){h(b[k]).setVolume(d)}}},activate:function(j,l){for(var k in e){if(k==j){continue}if(f[j]!=f[k]){this.close(k);continue}if(!(f[j]||f[k])){this.close(k)}}e[j]=1},load:function(l,j,m,k){h(l).load(j,m,k)},close:function(j){h(j).close();if(j in e){delete e[j]}},open:function(j,k){if(k==undefined){k=1}h(j).open(k==undefined?0:k-1)},getVolume:function(j){return d}}}();var BF_GplusSignin=function(){this.callback=function(authResult){signin.spinner();if(!authResult.status["signed_in"]){if(signin.spin_el){signin.spin_el.hide()}return}else{if(authResult.status["signed_in"]){new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:{googleplus:"1",otc:authResult.code},onSuccess:function(result){gplus._result(result)},onFailure:function(result){if(signin.spin_el){signin.spin_el.hide()}return}})}}};this._result=function(result){signin.is_gplus=true;var res=eval("("+result.responseText+")"),user=new BF_User,default_lang=BF_STATIC.language||"en",username,params;if(res.username.match("[^A-Za-z0-9]")){res.username=res.username.replace(res.username.match("[^A-Za-z0-9]")[0],"")}if(!user.isLoggedIn()&&res.login=="false"&&res.username&&res.password){params={name:res.username,username:res.username.replace(/\W/g,""),pw:res.password,email:res.email,contribute:"1",allow_email_updates:"1",googleplus_uid:res.googleplus_uid,import_fb_profile:"false",language:res.language||default_lang,googleplus_image:res.googleplus_image,display_name:res.display_name,};signin.social_register=true;bf_register.new_register(params)}else{if(res.login=="true"){gplus.login(res)}}};this.login=function(obj){if(obj&&obj.session_key){BFW_Util.setCookie({name:BFW_COOKIE,value:obj.session_key});BFW_Util.setInfoCookie({value:obj});bf_login.cookieLogin()}}};var BF_UserSwitcher={controller:"/buzzfeed/_switch",template:'<li><a href="" onclick="return false" class="switch-to-user" rel:id="#{id}"><img src="#{root}#{image}"/>#{display_name}</a></li>',template_bottom_div:'<li class="#{hl}"><a href="" onclick="return false" rel:username="#{username}"><span class="list-username" rel:username="#{username}">#{username}</span> #{display_name}</a><span class="hl chosen"></span></li>',latest_switch_list:[],latest_switch_list_loaded:false,switcher:null,bottom_warning_div:null,bottom_warning_select:null,is_user_switcher:false,selected_user:null,init:function(b){try{if(!acl.user_can("general_admin")){return false}if(b!=null){BF_UserSwitcher.selected_user=b}if(BF_UserSwitcher.is_user_switcher){BF_UserSwitcher.apply_visibility();return false}BF_UserSwitcher.switcher=$("quickpost-user-switcher");if(BF_UserSwitcher.switcher){BF_UserSwitcher.is_user_switcher=true}BF_UserSwitcher.apply_visibility();if(acl.user_can("general_admin")){BF_UserSwitcher._switch_list_ui([""],"bottom");universal_dom.get_bucket_elements("switch_users").each(function(d){var c=BF_UserSwitcher.switcher.select(".switch_user_list")[0];d.observe("click",function(){if(c.style.display=="block"){return false}c.style.display="block";universal_dom.get_bucket_elements("switch_user_dialog").each(function(e){e.update("Loading...")});BF_UserSwitcher.getSwitchList(BF_UserSwitcher._switch_list_ui,"bottom",true)});Event.observe(window,"click",function(f){if(!$(f.target).childOf||!$(f.target).childOf(BF_UserSwitcher.switcher)){c.style.display="none"}})})}}catch(a){console.error(a)}},apply_visibility:function(){try{if(!BF_UserSwitcher.is_user_switcher){return false}var a=(new BF_User()).getUserInfo();if(BF_UserSwitcher.selected_user==null){if(typeof edit_post!="undefined"){BF_UserSwitcher.selected_user=edit_post.buzz.username}else{BF_UserSwitcher.selected_user=a.username;$$(".switched-display_name").each(function(d){if(d.hasClassName("bottom_display_name")){d.update(a.display_name)}})}}if(acl.user_can("general_admin")){var b;if(typeof edit_post!="undefined"){b=edit_post.buzz.username}else{b=a.default_user.username}}else{BF_UserSwitcher.switcher.style.display="none"}}catch(c){console.error(c)}},sw_bottom_div:function(b){try{b.stop();var a=BF_UserSwitcher.switcher.select(".switch_user_list")[0];a.select("li a").each(function(c){if(b.target==c||b.target.parentNode==c){BF_UserSwitcher.selected_user=c.getAttribute("rel:username");c.parentNode.addClassName("hl");superlist_bylines.set_add_bylines(BF_UserSwitcher.selected_user,true);universal_dom.get_bucket_elements("switch_user_dialog")[0].hide()}else{c.parentNode.removeClassName("hl")}});BF_UserSwitcher.apply_visibility()}catch(b){console.error(b)}},fill_switch_div:function(d){try{if(!BF_UserSwitcher.is_user_switcher){return false}var c=new Template(BF_UserSwitcher.template_bottom_div);var b="<ul>";var a=(new BF_User()).getUserInfo();u=a.default_user;d.unshift({display_name:decodeURIComponent(u.display_name.unescapeHTML()),username:u.username,image:u.image,userid:u.userid});if(typeof edit_post!="undefined"){d.unshift({display_name:decodeURIComponent(edit_post.buzz.user_displayname.unescapeHTML()),not_user:true,username:edit_post.buzz.username,image:edit_post.buzz.user_image,userid:edit_post.buzz.userid})}d.each(function(g){if(g.p_disable_quickpost=="1"){return false}if(typeof edit_post!="undefined"&&g.username==edit_post.buzz.username&&!g.not_user){return false}var e=(BF_UserSwitcher.selected_user==g.username)?true:false;b+=c.evaluate({display_name:g.display_name,username:g.username,hl:(e?"hl":"")})});var d=BF_UserSwitcher.switcher.select(".switch_user_list")[0];d.update(b+"</ul>");d.select("ul a").each(function(e){e.observe("click",BF_UserSwitcher.sw_bottom_div)})}catch(f){console.error(f)}},switch_callback:function(){try{var a=(new BF_User()).getUserInfo();if(typeof edit_post=="undefined"){if(BF_UserSwitcher.is_user_switcher){BF_UserSwitcher.selected_user=a.username}$$(".switched-display_name").each(function(d){d.update(a.display_name)})}else{$$(".switched-display_name").each(function(d){if(!d.hasClassName("bottom_display_name")){d.update(a.display_name)}})}if(a.p_disable_quickpost=="true"){BF_Request.location({reload_track:true});return false}if(BF_UserSwitcher.is_user_switcher){var b=BF_UserSwitcher.switcher.select(".switch_user_list")[0];b.style.display="none";BF_UserSwitcher.apply_visibility()}}catch(c){console.error(c)}},swfunction:function(a){try{a.stop();var b=a.target.getAttribute("rel:id");BF_UserSwitcher.switchTo(b,BF_UserSwitcher.switch_callback)}catch(a){console.error(a)}},switch_list_ui:function(a){try{a.stop();if($("switch-list-spinner")){$("switch-list-spinner").show()}this.getSwitchList(BF_UserSwitcher._switch_list_ui,"top")}catch(a){console.error(a)}},_switch_list_ui:function(d,a,j){if(!$("usernav-switch-list")){return}try{if(j&&BF_UserSwitcher.is_user_switcher){var h=d.slice(0);BF_UserSwitcher.fill_switch_div(h)}var g=(new BF_User()).getUserInfo();var i=new Template(BF_UserSwitcher.template);var b='<a class="close_switch_list_ui" href="javascript:;" onclick="BF_UserSwitcher.hide_switch_list_ui();return false;"><img src="'+BF_STATIC.static_root+'/images/public/video-lightbox/closebox.png" alt="Close"/></a><ul>';var f=(typeof g.default_user.image=="undefined"||g.default_user_image==null)?"":g.default_user.image;if(f==null||f==""){f="/static/images/public/defaults/user.jpg"}d.unshift({image:decodeURIComponent(f.unescapeHTML()),display_name:decodeURIComponent(g.default_user.display_name.unescapeHTML()),userid:g.default_user.userid});d.each(function(e){if(typeof e.image=="undefined"||e.image==""||e.image==null){e.image="/static/images/public/defaults/user.jpg"}b+=i.evaluate({image:e.image,display_name:e.display_name,id:e.userid,root:BF_STATIC.image_root})});if(g.p_alias=="true"||(typeof g.default_user!="undefined"&&g.default_user.p_alias=="true")){b+='<li><a href="'+BF_STATIC.web_root+'/signup"><img src="'+BF_STATIC.static_root+'/images/public/icons/new-microsite.png" alt="" width="25" height="25" /><i>Create Another BuzzFeed</i></a></li>'}$("usernav-switch-list").update(b+"</ul>");if(a=="top"){$("usernav-switch-list").show();if($("switch-list-spinner")){$("switch-list-spinner").hide()}}$$(".switch-to-user").each(function(e){e.observe("click",BF_UserSwitcher.swfunction)});$$(".switched-display_name").each(function(e){if(!e.hasClassName("bottom_display_name")){e.update(g.display_name)}});BF_UserSwitcher.apply_visibility()}catch(c){console.error(c)}},hide_switch_list_ui:function(){$("usernav-switch-list").hide()},switchTo:function(g,f){try{var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"){if(a.userid==g){$("usernav-switch-list").hide();if($("switch-list-spinner")){$("switch-list-spinner").hide()}}else{$("usernav-switch-list").hide();if($("switch-list-spinner")){$("switch-list-spinner").show()}var c=new BF_Request();c.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch",default_username:a.default_user.username,default_session_key:a.default_user.session_key,switch_id:g},onSuccess:function(e){BF_UserSwitcher._switchTo(e,f)}})}}}}catch(d){console.error(d)}},_switchTo:function(b,d){try{var a={};if(window.location.href.match("/signup")){a={no_reload:true}}bf_login.loggedIn(b,a);d();if($("switch-list-spinner")){$("switch-list-spinner").hide()}}catch(c){console.error(c)}},getSwitchListFor:function(d,c){try{if(!acl.user_can("edit_user_accounts")){return}var a=new BF_Request();a.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch_list_for",username:d},onSuccess:function(e){BF_UserSwitcher._getSwitchList(e.responseText,c)}})}catch(b){console.error(b)}},getSwitchList:function(h,d,a){try{if(typeof a=="undefined"){a=false}var c=new BF_User();if(c.isLoggedIn()){var b=c.getUserInfo();if(typeof b.default_user!="undefined"){var f=new BF_Request();f.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch_list",default_username:b.default_user.username,default_session_key:b.default_user.session_key},onSuccess:function(e){BF_UserSwitcher._getSwitchList(e.responseText,h,d,a)},on401:function(){console.warn("Insufficient Permissions")}})}}}catch(g){console.error(g)}},_getSwitchList:function(responseText,callback,cbparam,withSelect){try{if(callback==undefined){return false}var obj=eval("("+responseText+")");if(obj.success=="1"){BF_UserSwitcher.latest_switch_list=obj.switch_list.slice(0);var user_info=(new BF_User()).getUserInfo();u=user_info.default_user;BF_UserSwitcher.latest_switch_list.unshift({display_name:decodeURIComponent(u.display_name.unescapeHTML()),username:u.username,image:decodeURIComponent(u.image.unescapeHTML()),userid:u.userid});BF_UserSwitcher.latest_switch_list_loaded=true;callback(obj.switch_list,cbparam,withSelect)}}catch(e){console.error(e)}},show_warning:function(){try{var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(!window.location.pathname.match("/dashboard$")&&typeof a.default_user!="undefined"&&a.default_user.username!=a.username){$$(".switched-display_name").each(function(d){d.update(a.display_name)});$$(".switch-warning").each(function(d){d.show()})}else{$$(".switch-warning").each(function(d){d.hide()})}}}catch(c){console.error(c)}},_getSwitchList:function(responseText,callback,cbparam,withSelect){if(callback==undefined){return false}var obj=eval("("+responseText+")");if(obj.success=="1"){if(typeof obj.switch_list.users!=="undefined"){BF_UserSwitcher.latest_switch_list=obj.switch_list.users.slice(0)}else{BF_UserSwitcher.latest_switch_list=obj.switch_list.slice(0)}var user_info=(new BF_User()).getUserInfo();u=user_info.default_user;BF_UserSwitcher.latest_switch_list.unshift({display_name:unescape(u.display_name),username:unescape(u.username),userid:unescape(u.userid)});BF_UserSwitcher.latest_switch_list_loaded=true;callback(obj.switch_list,cbparam,withSelect)}},disable_private_fields:function(){try{var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"&&a.default_user.username!=a.username){var d=["user-settings-button"];d.each(function(e){if($(e)){$(e).style.display="none"}})}}}catch(c){console.error(c)}},create_alias_for:function(a,b){if(typeof a.username=="undefined"||typeof a.alias_username=="undefined"){BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Oops! You need to tell us your desired URL"})},b);return}if(!acl.user_can("edit_user_accounts")){return}(new BF_Request()).request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias_for",username:a.username,alias_username:a.alias_username},onSuccess:function(c){BF_UserSwitcher._create_alias(c,b)},onFailure:function(c){BF_UserSwitcher._create_alias(c,b)}})},create_alias:function(c,e){if(typeof c.username=="undefined"||typeof c.display_name=="undefined"){BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Oops! You need to tell us your desired URL"})},e);return}var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"){var d=new BF_Request();if(c.self_serve==1){d.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias",username:c.username,display_name:c.display_name,default_username:a.default_user.username,default_session_key:a.default_user.session_key,self_serve:1},onSuccess:function(f){BF_UserSwitcher._create_alias(f,c.username,e)},onFailure:function(f){BF_UserSwitcher._create_alias(f,c.username,e)}})}else{d.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias",username:c.username,display_name:c.display_name,default_username:a.default_user.username,default_session_key:a.default_user.session_key},onSuccess:function(f){BF_UserSwitcher._create_alias(f,e)},onFailure:function(f){BF_UserSwitcher._create_alias(f,e)}})}}else{BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Insufficient privileges"})},e)}}else{BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"User not logged in"})},e)}},_create_alias:function(r,callback){var obj=eval("("+r.responseText+")");obj.status=r.status;callback(obj)},count_aliases:function(d){var b=new BF_User();if(b.isLoggedIn()){var a=b.getUserInfo();if(typeof a.default_user!="undefined"){var c=new BF_Request();c.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"count_aliases",default_username:a.default_user.username,default_session_key:a.default_user.session_key},onComplete:function(e){BF_UserSwitcher._count_aliases(e,d)}})}}},_count_aliases:function(r,callback){var obj=eval("("+r.responseText+")");obj.status=r.status;callback(obj)}};if(typeof edit_post=="undefined"){BuzzLoader.register(BF_UserSwitcher.init,1)}bf_badge_vote_manager=function(){this.VOTE_CONTROLLER="/buzzfeed/_badge_vote";this.VOTE_DEFINITIONS={badge:{onSuccess:function(r){badge_vote_manager.badgeResponse(r)},parameters:{badge_id:function(t){if(t.className.match(/bf_dom/)){var json=eval("("+t.getAttribute("rel:data")+")");return json.vote.badge_id}else{return t.getAttribute("rel:badge_id")}}},success_template:'<a href="/#{username}"><strong>#{display_name}</strong></a> '+local.t('thinks #{title} is <a class="badgeword">#{badge}</a>')+'. <span class="ago">'+local.t("just now")+"</span>"},love_or_hate:{onSuccess:function(r){badge_vote_manager.loveHateResponse(r)},parameters:{value:function(t){if(t.className.match(/bf_dom/)){var json=eval("("+t.getAttribute("rel:data")+")");return json.vote.value=="loves"?1:0}else{return t.getAttribute("rel:value")=="loves"?1:0}}},success_template:'<a href="/#{username}"><strong>#{display_name}</strong></a> <span class="feed-#{loves}">&nbsp;</span> #{title}. <span class="ago">'+local.t("just now")+"</span>"}};this.initialized=false;this.initialization=false;this.badgeResponse=function(r){var json=eval("("+r.responseText+")");if($("spinner-badge")){$("spinner-badge").hide()}if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(json.success){BFW_Util.updateInfoCookie({last_active:json.last_active});if(!!window.fb_app){fb_app.badge_vote_success(json)}else{var target=$(json.element_id);var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}Event.stopObserving(target,"click",badge_vote_manager.vote);target.removeAttribute("href");$(target).up("li").addClassName("voted");if($("social-actions")){$("social-actions").fire("set:reaction")}if(json.already_voted){if(BF_STATIC.tt_page!="Video"){return badge_vote_manager._already_voted(json)}}if(BF_STATIC.tt_page!="Video"){badge_vote_manager.show_reaction_share_box(target.getAttribute("rel:badge_name"),target.getAttribute("rel:message"))}var vote_category=target.getAttribute("rel:category");var user=new BF_User();var vote_definition=badge_vote_manager.VOTE_DEFINITIONS[vote_category];var template=vote_definition.success_template;var data={username:user.getUserInfo().username,display_name:user.getUserInfo().display_name,title:unescape(parent.getAttribute("rel:buzz_title")),uri:parent.getAttribute("rel:buzz_uri"),badge:target.getAttribute("rel:badge_name")};if(BF_STATIC.tt_page!="Video"){badge_vote_manager._add_response(template,data,{parent_class:["feed-action","feed-badge"]});badge_vote_manager._hide_social_messages();if(target.getAttribute("rel:message")){$("badge-message").update(unescape(target.getAttribute("rel:message")))}if($("social_message")){$("social_message").show();var stuffs=$("social_message").select("a")[0];if(stuffs){stuffs.setAttribute("target","_none")}}if($("number_of_contribs_header")){$("number_of_contribs_header").show()}this._update_reaction_count(target.getAttribute("rel:badge_id"));if(typeof json.earned_reactions!="undefined"){BFW_Util.updateInfoCookie({earned_reactions:json.earned_reactions})}}gtrack.trackShares(23,("numReactions_"+data.badge.toLowerCase()));gtrack.track_events("[ttp]","react/"+data.badge.toLowerCase(),"");EventManager.fire("badge_vote:success",data.badge)}}else{}};this.loveHateResponse=function(r){var json=eval("("+r.responseText+")");if($("spinner-love_or_hate")){$("spinner-love_or_hate").hide()}if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(json.success&&json.element_id){BFW_Util.updateInfoCookie({last_active:json.last_active});var target=$(json.element_id);if(target.parentNode.id.match(/(love|hate)_button-\d+/)){$(target.parentNode).show()}var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}Event.stopObserving(target,"click",badge_vote_manager.vote);if($("social-actions")){$("social-actions").fire("set:reaction")}target.removeAttribute("href");if(target.parentNode.nodeName=="LI"){$(target.parentNode).addClassName("voted")}else{if(target.parentNode.nodeName=="A"){$(target.parentNode).up().addClassName("voted")}}if(json.already_voted){return badge_vote_manager._already_voted(json)}var user=new BF_User();var vote_category=target.getAttribute("rel:category");var vote_definition=badge_vote_manager.VOTE_DEFINITIONS[vote_category];var template=vote_definition.success_template;var data={display_name:user.getUserInfo().display_name,title:unescape(parent.getAttribute("rel:buzz_title")),uri:parent.getAttribute("rel:buzz_uri"),loves:target.getAttribute("rel:value")};var className=data.loves=="loves"?"feed-love":"feed-hate";badge_vote_manager._hide_social_messages();if(!badge_vote_manager.is_contribution(target)){var reaction=data.loves.match(/love/)?"love":"hate";badge_vote_manager.show_reaction_share_box(reaction);badge_vote_manager._add_response(template,data,{parent_class:["feed-action",className]});if($("number_of_contribs_header")){$("number_of_contribs_header").show()}this._update_reaction_count(reaction)}else{var contribution_message=$("social_message-"+parent.getAttribute("rel:buzz_id"));var vote_feedback=data.loves=="loves"?local.t("Yeah!"):local.t("Awww");contribution_message.update(vote_feedback);contribution_message.show()}}else{}};this._already_voted=function(json){badge_vote_manager._hide_social_messages();if($("share-reaction-box")){$("share-reaction-box").hide()}var target=$(json.element_id);if(badge_vote_manager.is_contribution(target)){var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var social_message=$("social_message-"+parent.getAttribute("rel:buzz_id"));if(social_message){social_message.update(local.t("Okay!"));social_message.style.width="100%";social_message.show()}}else{$("social_message-already-voted").show()}};this._add_response=function(template_str,data,args){var items={};for(var each in data){items[each]=data[each].replace(/</g,"&lt;").replace(/>/g,"&gt;")}var template=new Template(template_str);var message=template.evaluate(items);var li=new Element("li",{"class":"feed-action"});if($("contribution-list")){$("contribution-list").insert({top:li})}if(args&&args.parent_class){var classes=args.parent_class;for(var i=0;i<classes.length;i++){li.addClassName(classes[i])}}li.update(message)};this._exceeded_maximum_badge_votes=function(){if(typeof fb_app=="undefined"){var buttons=$$(".vote-badge");for(var i=0;i<buttons.length;i++){Event.stopObserving(buttons[i],"click",badge_vote_manager.vote);buttons[i].observe("click",badge_vote_manager._show_vote_exceeded)}badge_vote_manager._show_vote_exceeded()}else{if($("badge_vote_msg")){$("badge_vote_msg").update("<h4>"+local.t("Sorry")+"</h4>, <p>"+local.t("you can only react up to three times")+'.<p> <a href="javascript:;" onclick="javascript:$(\'badge_vote_msg\').hide()" class="close">&times;</a>')}if(typeof fb_app.error_msg_timeout!="undefined"){clearTimeout(fb_app.error_msg_timeout)}fb_app.error_msg_timeout=setTimeout("Effect.Fade('badge_vote_msg',{'duration':2.0})",3000)}};this._show_vote_exceeded=function(e){if(typeof e!="undefined"){e.stop()}badge_vote_manager._hide_social_messages();if($("social_message-badge-votecount-exceeded")){$("social_message-badge-votecount-exceeded").show()}};this._hide_social_messages=function(){if($("social_message-badge-votecount-exceeded")){$("social_message-badge-votecount-exceeded").hide()}if($("social_message-already-voted")){$("social_message-already-voted").hide()}if($("social_message")){$("social_message").hide()}if($("social_message-loves")){$("social_message-loves").hide()}if($("social_message-hates")){$("social_message-hates").hide()}};this.init=function(){if(badge_vote_manager.initialized){return false}if(badge_vote_manager.initialization){setTimeout(this.init.bind(this,args),300)}badge_vote_manager.initialization=true;try{bf_login.init();this.ajax=new BF_Request();if($("badge_voting")&&BF_STATIC.tt_page!="Video"){var els=$("badge_voting").getElementsByTagName("UL")[0];badge_vote_manager.earned_reactions_buttons(els)}var user=new BF_User();$$(".add-pick").each(function(el){if(user.isLoggedIn()){el.removeClassName("hidden");el.up().removeClassName("hidden")}else{el.addClassName("hidden");el.up().addClassName("hidden")}});var user_info=user.getUserInfo();if(user_info&&typeof user_info.p_disable_reaction!="undefined"&&user_info.p_disable_reaction=="true"){$$("#lovehate_buttons, #badge_voting, .lovehate-buttons").each(function(el){el.style.visibility="hidden"})}else{for(var category in badge_vote_manager.VOTE_DEFINITIONS){var divs=$$(".vote-"+category);for(var i=0;i<divs.length;i++){var div=divs[i];if(div.className.match(/bf_dom/)){continue}div.setAttribute("rel:category",category);if(!div.id){div.id="vote-"+category+"-"+parseInt(Math.random()*10000000)}div.observe("click",badge_vote_manager.vote)}}}if(0){var reaction_camera=bf_react_cam.create();var reaction_camera_post_observer={_params:null,_on_previewFromServerOk:function(evt){console.log("_on_previewFromServerOk");bf_contribute.postit(reaction_camera_post_observer._params)},_on_previewFromServerError:function(evt){console.log("_on_previewFromServerError");reaction_camera_post_observer.stop()},_on_postitComplete:function(evt){console.log("_on_postitComplete");bf_badge_popup.force_close(reaction_camera);bf_badge_popup.set_active(true);reaction_camera_post_observer.stop()},start:function(params){reaction_camera_post_observer._params=params;reaction_camera_post_observer.stop();document.observe("contribute:previewFromServerOk",this._on_previewFromServerOk);document.observe("contribute:previewFromServerError",this._on_previewFromServerError);document.observe("contribute:postitOk",this._on_postitComplete);document.observe("contribute:postitError",this._on_postitComplete)},stop:function(){document.stopObserving("contribute:previewFromServerOk",this._on_previewFromServerOk);document.stopObserving("contribute:previewFromServerError",this._on_previewFromServerError);document.stopObserving("contribute:postitOk",this._on_postitComplete);document.stopObserving("contribute:postitError",this._on_postitComplete)}};reaction_camera.add_listener("enterframe",function(frame){if(frame!=2){return}bf_badge_popup.set_master(reaction_camera)});reaction_camera.add_listener("cnt_down",function(){bf_badge_popup.set_active(false)});reaction_camera.add_listener("record_complete",function(){bf_badge_popup.set_active(true)});reaction_camera.add_listener("save",function(){bf_badge_popup.set_active(false)});reaction_camera.add_listener("save_error",function(){bf_badge_popup.set_active(true)});reaction_camera.add_listener("save_success",function(gif){var params={form:"mixedpic",reactcam:"yes",delete_images:"no",buzz_id:BF_STATIC.campaignid,url:gif.image,width:gif.width,height:gif.height};reaction_camera_post_observer.start(params);$("contribute-submit").value="Preview";$("submit-mode").value="save";var preview_params=Object.clone(params);bf_contribute.previewFromServer(preview_params)});bf_badge_popup.register(reaction_camera,$$("body")[0],"click",function(evt){if(evt&&(evt.findElement("#"+reaction_camera.id)||evt.findElement("#react_cam_button"))){return false}reaction_camera.close()});bf_badge_popup.assign(reaction_camera,$("react_cam_button"),"mouseover",function(evt){bf_react_cam.reaction_camera_open(reaction_camera)});document.observe("contribute:goforit_reactcam",function(){bf_badge_popup.force_open(reaction_camera);bf_react_cam.reaction_camera_open(reaction_camera);reaction_camera.jumpto_record()})}var target=$("filter-show_everything");if(target){target.observe("click",function(e){e.stop();if($("contribution-list")){$("contribution-list").show()}$(e.target.parentNode).addClassName("current")})}var contribs=$$(".contrib");for(var i=0;i<contribs.length;i++){var buzz_id=contribs[i].getAttribute("rel:buzz_id");if(buzz_id){contribs[i].observe("mouseout",function(e){var parent=e.target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var id="tools-"+buzz_id;if($(id)){$(id).removeClassName("selected_tools")}});contribs[i].observe("mouseover",function(e){var parent=e.target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var id="tools-"+buzz_id;if($(id)){$(id).addClassName("selected_tools")}})}}badge_vote_manager.initialized=true}catch(e){console.error(e);badge_vote_manager.initialization=false}};this.reset_sharing_box=function(){if($("social-sharing-box")){$("sharing-message").value="";$("sharing-box-caption").update("");$("sharing-box-submit").value=local.t("Post to Facebook");$("sharing-box-submit").stopObserving("click",fbtl_session.add_message);$("sharing-box-submit").stopObserving("click",badge_vote_manager.sharing_box_handler)}if($("share-reaction-box")){$("reaction-sharing-message").value="";$("reaction-share-submit").value=local.t("Share Link");$("reaction-share-submit").stopObserving("click",badge_vote_manager.sharing_box_handler)}};this.show_reaction_share_box=function(reaction,message){if($("share-reaction-box")){$("share-reaction-box").show();$("reaction-sharing-message").value="";if($("share-reaction-success-wrapper").visible()){$("share-reaction-success-wrapper").hide()}if(!$("share-reaction-content-wrapper").visible()){BF_Effect.SlideDown("share-reaction-content-wrapper")}$("reaction-share-submit").observe("click",badge_vote_manager.sharing_box_handler);if(typeof bf_rdio=="object"){var play_list=bf_rdio.fetch_rdio_buzz(reaction.toLowerCase());if(play_list&&$("share-reaction-box_title")){var rdio_message="I know, right? Now check out the Rdio <span class='react_box'>"+reaction+"</span> playlist <a onClick=\"trackPixel('http://ad.doubleclick.net/clk;267621454;93691579;z');\" href='http://buzzfeed.com"+play_list+"'>"+local.t("HERE")+"</a>";$("share-reaction-box_title").innerHTML=rdio_message}}["Nom Nom"].each(function(r){if(r==reaction&&message){$("share-reaction-box_title").innerHTML=unescape(message)}})}};this.show_sharing_box=function(target,caller){if($("social-sharing-box")){var shareBox=$("social-sharing-box");var pos=badge_vote_manager.find_position(target);if(typeof pos=="undefined"){return}var btnLeft=parseInt(pos[0]);var vote_category=target.getAttribute("rel:category");var btnTop=(vote_category&&vote_category=="badge")?parseInt(pos[1])+7:parseInt(pos[1])-1;var btn=$(target.getAttribute("id"));var btnWidth=parseInt(btn.getWidth());var shareBoxWidth=parseInt(shareBox.getWidth());var split=300;var boxLeft=btnLeft<(shareBoxWidth/2-btnWidth/2)?10:(btnLeft-(shareBoxWidth/2-btnWidth/2));shareBox.setStyle({top:(btnTop+35)+"px",left:boxLeft+"px"});var pointerHeight=10;var pointerLeft=btnLeft<(shareBoxWidth/2-btnWidth/2)?btnLeft-10+btnWidth/2:shareBoxWidth/2;pointerLeft=pointerLeft-10;$("arrowBorder").setStyle({top:-(pointerHeight)+"px",left:pointerLeft+"px",borderBottom:pointerHeight+"px solid #444"});$("arrowFill").setStyle({top:(-(pointerHeight)+2)+"px",left:pointerLeft+"px",borderBottom:pointerHeight+"px solid #F2F2F2"});if(typeof caller!="undefined"&&caller=="fbtl"){$("sharing-box-caption").update(local.t("Add a message?"));$("sharing-box-submit").value=local.t("Add A Message");$("sharing-box-submit").observe("click",fbtl_session.add_message)}else{$("sharing-box-caption").update(local.t("I know, right? Will your friends agree?"));var prefill_msg=target.getAttribute("rel:badge_name")?target.getAttribute("rel:badge_name")+"!":"";$("sharing-message").value=prefill_msg;$("sharing-box-submit").observe("click",badge_vote_manager.sharing_box_handler)}shareBox.show()}};this.find_position=function(el){var curleft=curtop=0;if(el.offsetParent){do{curleft+=el.offsetLeft;curtop+=el.offsetTop}while(el=el.offsetParent);return[curleft,curtop]}};this.sharing_box_handler=function(e){var message="";var meta_tags=document.getElementsByTagName("meta");var fields=["image","title","description","url"];var info={};if(objExists(e.target.id)){if(e.target.id="reaction-share-submit"){message=$("reaction-sharing-message").value}else{if(e.target.id="sharing-box-submit"){message=$("sharing-message").value}}}for(var i=0;i<meta_tags.length;i++){for(var j=0;j<fields.length;j++){var property="og:"+fields[j];if(meta_tags[i].getAttribute("property")==property){info[fields[j]+""]=meta_tags[i].getAttribute("content")}}}if(typeof pound!="undefined"&&!BF_STATIC.mobile_app){info.url=pound.urls.unescaped.hashAndQueryString()}var fb_args={};fb_args.description=info.description;fb_args.name=info.title;fb_args.link=info.url;fb_args.picture=info.image;fb_args.message=message;facebook.publish_to_stream(fb_args,function(){if($("social-sharing-box").visible()){$("social-sharing-box").hide()}if($("share-reaction-box")){if($("share-reaction-content-wrapper").visible()){BF_Effect.SlideUp("share-reaction-content-wrapper")}if($("share-reaction-content-wrapper").visible()){BF_Effect.SlideDown("share-reaction-success-wrapper")}}})};this.show_social_icons=function(){if(typeof(ActiveHistory)=="undefined"){return}ActiveHistory.observe("visited:digg",function(){if($("share_digg_button")){$("share_digg_button").show()}});ActiveHistory.observe("visited:twitter",function(){if($("share_twitter_button")){$("share_twitter_button").show()}});ActiveHistory.observe("visited:reddit",function(){if($("share_reddit_button")){$("share_reddit_button").show()}});ActiveHistory.observe("visited:stumbleupon",function(){if($("share_stumbleupon_button")){$("share_stumbleupon_button").show()}});ActiveHistory.observe("visited:delicious",function(){if($("share_delicious_button")){$("share_delicious_button").show()}});ActiveHistory.observe("visited:fark",function(){if($("share_fark_button")){$("share_fark_button").show()}})};this.vote=function(e){e.stop();var user=new BF_User();var target;if(e.target.nodeName=="SPAN"){target=e.target.up()}else{target=e.target}if(typeof fb_app!="undefined"){var badge_name=target.getAttribute("rel:badge_name");fb_app.show_bubble(badge_name);if(!fb_app.session||!fb_app.bf_user_info){fb_app.log_into_buzzfeed()}else{badge_vote_manager._vote(target)}}else{if(user.isLoggedIn()){var fb_vote_prompt=readCookie("fb-vote-prompt");(target.up(".contrib"))?badge_vote_manager._comment_vote(target):badge_vote_manager._vote(target)}else{var ev=target.fire("click");ev.signin_type="initial";ev.mode="badges";ev.location="reaction";ev.reg_params="";var category=target.getAttribute("rel:category");if(category=="love_or_hate"){ev.reg_params="c1&v"+(target.getAttribute("rel:value")=="loves"?1:0)+"&i"+target.id.substr(18)}else{gtrack.track_events("[ttp]","react/"+target.getAttribute("rel:badge_name").toLowerCase()+"/not-signed-in","");ev.reg_params="c&v"+target.getAttribute("rel:badge_id")+"&i"+target.id.substr(11)}var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}ev.reg_params+="&b"+parent.getAttribute("rel:buzz_id")+"&l"+parent.getAttribute("rel:buzz_uri");if(typeof BF_STATIC!="undefined"&&typeof BF_STATIC.country!="undefined"){ev.reg_params+="&u"+BF_STATIC.country}badge_vote_manager.onRegister=function(obj,json){badge_vote_manager.onRegister=null};signin.callbacks.onRegister.push(function(obj,json){if(badge_vote_manager.onRegister){badge_vote_manager.onRegister(obj,json)}});bf_login.loggedInCallbacks=[];bf_login.loggedInCallbacks.push(function(){badge_vote_manager.initialized=true;badge_vote_manager.vote_by_id(target.up("li").id)});signin.open(ev)}}EventManager.fire("badge_vote:vote_init",target.getAttribute("rel:badge_name"))};this.vote_by_id=function(elem){var are_we_ready=(typeof universal_dom!="undefined"&&badge_vote_manager.initialized&&$$("#"+elem+" a").length);if(are_we_ready){var ev=$$("#"+elem+" a")[0].fire("click");badge_vote_manager.vote(ev)}else{setTimeout(badge_vote_manager.vote_by_id.bind(this,elem),500)}};this._comment_vote=function(target){var vote_category=target.getAttribute("rel:category");if(!vote_category){if(target.up("a")){target=target.up("a");vote_category=target.getAttribute("rel:category");if(!vote_category){return}}}Event.stopObserving(target,"click",badge_vote_manager.vote);var id=target.up(".contrib").getAttribute("rel:comment_id");var vote=target.getAttribute("rel:value");var params={action:"comment_vote",comment_id:id,badge_name:vote};var ajax=new BF_Request();ajax.request(this.VOTE_CONTROLLER,{method:"get",parameters:params});var vote_number=parseInt(target.down(".count").innerHTML);if(vote_number>=0){target.down(".count").innerHTML=vote_number+1}};this._vote=function(target){var vote_category=target.getAttribute("rel:category");if(!vote_category){return}var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(vote_category=="badge"){if(typeof _badge_votes_so_far=="undefined"){_badge_votes_so_far={};_badge_votes_so_far[buzz_id]={}}else{if(typeof _badge_votes_so_far[buzz_id]=="undefined"){_badge_votes_so_far[buzz_id]={}}}var user=new BF_User();var user_info=user.getUserInfo();if(typeof _badge_votes_so_far!="undefined"){if(typeof _badge_votes_so_far[""+buzz_id][user_info.username]=="undefined"){_badge_votes_so_far[""+buzz_id][user_info.username]=1}else{_badge_votes_so_far[""+buzz_id][user_info.username]+=1}if(_badge_votes_so_far[""+buzz_id][user_info.username]>=4){return badge_vote_manager._exceeded_maximum_badge_votes()}}}if(badge_vote_manager.is_contribution(target)){$("love_button-"+parent.getAttribute("rel:buzz_id")).hide();$("hate_button-"+parent.getAttribute("rel:buzz_id")).hide();$("social_message-"+parent.getAttribute("rel:buzz_id")).hide();badge_vote_manager._spinner=$("spinner-"+parent.getAttribute("rel:buzz_id"));$(badge_vote_manager._spinner).style.width="100%";$(badge_vote_manager._spinner).show()}else{if($("spinner-"+vote_category)){$("spinner-"+vote_category).show()}}var vote_definition=this.VOTE_DEFINITIONS[vote_category];if(!vote_definition){return}var params={action:"vote",element_id:target.id,category:vote_category,uri:"/"+parent.getAttribute("rel:buzz_uri"),buzz_id:parent.getAttribute("rel:buzz_id")};for(var each in vote_definition.parameters){params[each]=vote_definition.parameters[each](target)}var ajax=new BF_Request();ajax.request(this.VOTE_CONTROLLER,{method:"get",parameters:params,onSuccess:vote_definition.onSuccess});if(vote_category=="badge"&&target.getAttribute("rel:badge_type")!="earned"){if(typeof _badge_votes_so_far=="undefined"||_badge_votes_so_far[""+buzz_id][user_info.username]<2){var action="react";var article_url=window.location.toString().replace(/\?.*/i,"");if(BF_STATIC.bf_env!="live"){article_url=article_url.replace(/\/\/(stage(\d+)?|dev)\./i,"//www.").replace("/bf2/","/")}var badge_uri=target.getAttribute("rel:badge_uri");var objs={article:article_url,badge:"http://www.buzzfeed.com/badge/"+badge_uri};try{if(typeof(FB)!="undefined"){fbtl_session.trigger(action,objs)}}catch(e){console.error(e)}}}(new BF_Targetting_Pixel()).add("badge_reaction")};this.simple_love_vote=function(uri,buzz_id){var vote_definition=this.VOTE_DEFINITIONS.love_or_hate;var params={action:"vote",buzz_id:buzz_id,category:"love_or_hate",uri:uri,value:1};var ajax=new BF_Request();ajax.request(this.VOTE_CONTROLLER,{method:"get",parameters:params,onSuccess:vote_definition.onSuccess})};this.is_contribution=function(target){var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}return parent.parentNode.className.match(/contribution-lovehate-buttons/)};this._update_reaction_count=function(id_prefix){var id=id_prefix+"-reaction-count";var count=$(id).innerHTML.replace(/\s+/g,"");var count=parseInt(count);if(!isNaN(count)){count++;$(id).update(count)}};this.find_parent=function(tag,el){if(el.tagName.toLowerCase()==tag.toLowerCase()){return el}else{if(el.parentNode!=null){return badge_vote_manager.find_parent(tag,el.parentNode)}else{return console.warn("no "+tag+" found in DOM")}}};this.earned_reactions_buttons=function(target){if(local.non_english){return false}try{var btn_template=new Template('<li id="#{name}_button" class="#{name}"> <a id="vote-badge-#{rand}" class="vote-badge" rel:badge_type="earned" rel:badge_name="#{title}" rel:badge_id="#{badge_id}" rel:message="<b>'+local.t("I know, right?")+"</b> <span class=#{infinite}>"+local.t("You have #{remaining_less_one} of these babies left, use #{itslashthem} wisely")+"...</span><span class=#{none_left}>"+local.t("That was your last #{title} reaction. Go earn some more!")+'</span>"> #{title} <span class="earned-remaining">#{remaining}</span></a> <span id="#{badge_id}-reaction-count" class="badge-vote-count zero"></span> </li>');var str=(new BF_User()).getUserInfo().earned_reactions;var show_reactions=false;if(str&&target){var earned_reactions=eval("("+str+")");for(var reaction in earned_reactions){if(!earned_reactions.hasOwnProperty(reaction)||earned_reactions[reaction].remaining==0){continue}var name=reaction.toLowerCase().replace("[^a-zA-Z]","");if(typeof name==="undefined"||name==""){continue}var params={name:name,rand:parseInt(Math.random()*1000)+(new Date()).getTime(),title:reaction,remaining:earned_reactions[reaction].remaining==-1?"":" "+earned_reactions[reaction].remaining+"",badge_id:earned_reactions[reaction].badge_id};params.remaining_less_one=earned_reactions[reaction].remaining-1;params.infinite=params.remaining_less_one<1?"hidden":"";params.none_left=params.remaining_less_one==0?"":"hidden";params.itslashthem=params.remaining_less_one==1?"it":"them";var html=btn_template.evaluate(params);target.insert(html);show_reactions=true}if(show_reactions){$("special_header").show();$$(".special-reactions").each(function(el){el.show()})}}}catch(e){console.error(e)}}};badge_vote_manager=new bf_badge_vote_manager();badge_vote_manager.show_social_icons();BuzzLoader.register(function(){badge_vote_manager.init()},2);bf_user_reaction=function(){var reaction_url="/buzzfeed/_badge_vote";var reaction_message={success_voted:local.t("Thanks for your vote!"),already_voted:"<span>"+local.t("Oops")+".</span> "+local.t("It looks like you've already voted")+".",reaction_count_exceeded:"<span>"+local.t("Sorry")+"</span>, "+local.t("you can only react up to three times")+"."};var _this=this;this.init=function(){var user=new BF_User();$$(".user-reaction").each(function(cont,index){if(user.isLoggedIn()){cont.removeClassName("hide-user-reaction")}cont.select(".reaction-btn").each(function(element,index2){element.observe("click",_this.add_reaction)})});universal_dom.assign_handler({bucket:"fb-share",handler:bf_user_reaction.buzz_share,event:"click"});universal_dom.assign_handler({bucket:"tw-share",handler:bf_user_reaction.buzz_share,event:"click"});universal_dom.assign_handler({bucket:"pin-share",handler:bf_user_reaction.buzz_share,event:"click"})};this.buzz_share=function(obj){var parent=$("user-reaction-social-"+obj.id);if(!parent){return}var title=encodeURIComponent(parent.getAttribute("rel:title"));var host=BF_STATIC.bf_env!="live"?"http://stage.buzzfeed.com/":"http://www.buzzfeed.com/";var url=encodeURIComponent(host+parent.getAttribute("rel:link"));var thumb=encodeURIComponent(BF_STATIC.image_root+parent.getAttribute("rel:thumb"));var twitter_url="https://twitter.com/intent/tweet?text="+title+"&url="+url;if(BF_STATIC.tt_page="Community"){twitter_url=twitter_url+"&via=buzzfeeders"}if(obj.element.hasClassName("buzz-facebook-share")){window.open("http://facebook.com/sharer/sharer.php?s=100&p[url]="+url+"&p[title]="+title+"&p[images][0]="+thumb,"_blank","width=600, height=260")}else{if(obj.element.hasClassName("buzz-twitter-share")){window.open(twitter_url,"_blank","width=600,height=400")}else{if(obj.element.hasClassName("buzz-pinterest-share")){window.open("http://pinterest.com/pin/create/button/?media="+thumb+"&url="+url+"&description="+title,"_blank","width=600,height=400")}}}};this.add_reaction=function(el){var target=el.target;if(target.hasClassName("icon")){target=target.parentNode}var reaction_wrap=_this.get_reaction_wrap(target);_this.hide_all_reaction_messages(target);var reaction_params={action:"vote",element_id:target.id,category:target.getAttribute("rel:category"),buzz_id:reaction_wrap.getAttribute("rel:buzz_id"),uri:"/"+reaction_wrap.getAttribute("rel:buzz_uri")};if(target.getAttribute("rel:category")=="badge"&&!_this.is_reaction_available(reaction_wrap.getAttribute("rel:buzz_id"))){_this.show_reaction_message(target,"reaction_count_exceeded");return false}if(target.getAttribute("rel:badge_id")){reaction_params.badge_id=target.getAttribute("rel:badge_id")}if(target.getAttribute("rel:value")){reaction_params.value=target.getAttribute("rel:value")=="loves"?"1":(target.getAttribute("rel:value")=="hates"?"0":target.getAttribute("rel:value"))}var user=new BF_User();if(!user.isLoggedIn()){var t={signin_type:"initial",mode:"badges",location:"reactions"};t.reg_params="";if(reaction_params.category=="love_or_hate"){t.reg_params="c1&v"+reaction_params.value+"&i"+reaction_params.element_id.substr(18)}else{t.reg_params="c&v"+reaction_params.badge_id+"&i"+reaction_params.element_id.substr(11)}t.reg_params+="&b"+reaction_params.buzz_id+"&l"+reaction_params.uri;if(typeof BF_STATIC!="undefined"&&typeof BF_STATIC.country!="undefined"){t.reg_params+="&u"+BF_STATIC.country}bf_login.loggedInCallbacks.push(function(){_this.send_react_request(reaction_params);_this.show_reaction_loading(target)});signin.open(t);return false}_this.send_react_request(reaction_params);_this.show_reaction_loading(target);(new BF_Targetting_Pixel()).add("badge_reaction")};this.vote_by_id=function(elem){$$("#"+elem+" a")[0].scrollIntoView();var ev=$$("#"+elem+" a")[0].fire("click");bf_user_reaction.add_reaction(ev)};this.send_react_request=function(reaction_params){var ajax=new BF_Request();ajax.request(reaction_url,{method:"get",parameters:reaction_params,onSuccess:_this.add_reaction_success})};this.is_reaction_available=function(buzz_id){var user=new BF_User();var user_info=user.getUserInfo();if(typeof _badge_votes_so_far=="undefined"){_badge_votes_so_far={}}if(typeof _badge_votes_so_far[buzz_id]=="undefined"){_badge_votes_so_far[buzz_id]={}}if(typeof _badge_votes_so_far[buzz_id][user_info.username]=="undefined"){_badge_votes_so_far[buzz_id][user_info.username]=1;return true}else{if(_badge_votes_so_far[buzz_id][user_info.username]>=3){return false}_badge_votes_so_far[buzz_id][user_info.username]+=1;return true}};this.add_reaction_success=function(response){var json=eval("("+response.responseText+")");if(json.success){$(json.element_id).stopObserving("click",_this.add_reaction);$(json.element_id).addClassName("already-reacted");_this.hide_reaction_loading($(json.element_id));if(json.already_voted){_this.show_reaction_message($(json.element_id),"already_voted")}else{_this.show_reaction_message($(json.element_id),"success_voted")}}else{}};this.get_reaction_wrap=function(el){var reaction_wrap=el;while(reaction_wrap.parentNode&&!reaction_wrap.hasClassName("user-reaction")){reaction_wrap=reaction_wrap.parentNode}return reaction_wrap};this.show_reaction_loading=function(el){var reaction_wrap=_this.get_reaction_wrap(el);if(!reaction_wrap.select(".reaction-loading").length){reaction_wrap.insert('<div class="reaction-loading" style="display:none;">'+local.t("Saving")+"...</div>")}reaction_wrap.select(".reaction-loading")[0].show()};this.hide_reaction_loading=function(el){var reaction_wrap=_this.get_reaction_wrap(el);if(reaction_wrap.select(".reaction-loading").length){reaction_wrap.select(".reaction-loading")[0].hide()}};this.show_reaction_message=function(el,message_key){var reaction_wrap=_this.get_reaction_wrap(el);if(!reaction_wrap.select(".reaction-message-"+message_key).length){reaction_wrap.insert('<div class="reaction-message reaction-message-'+message_key+'" style="display:none;">'+reaction_message[message_key]+"</div>")}reaction_wrap.select(".reaction-message-"+message_key)[0].show()};this.hide_all_reaction_messages=function(el){var reaction_wrap=_this.get_reaction_wrap(el);if(reaction_wrap.select(".reaction-message").length){reaction_wrap.select(".reaction-message").each(function(element,index){element.hide()})}}};bf_user_reaction=new bf_user_reaction();BuzzLoader.register(function(){bf_user_reaction.init()},2);var BF_MAX_UPLOAD=1024*1024*2;var BF_MAX_UPLOAD_TEXT="2 megabytes";var BF_MAX_UPLOAD_PROFILE=1024*1024*1;var BF_MAX_UPLOAD_PROFILE_TEXT="1 megabyte";BF_IMAGE_CROPPER=Class.create({template:'		<div class="cropperbody #{cropper_class}">			<div class="content">				#{uploader_template}				<div id="cropper_container">					<div class="container"><img id="image" src="#{static_root}/images/public/backgrounds/trans.gif" class="hidden" /></div>					#{preview_template}					#{thumbs_template}				</div>			</div>			<div class="bf_dialog_footer">				<ul>					<li id="save-button">						<button id="save-image" class="hidden bf_button bf_submit">Save</button>						<button id="preview-thumbs" class="hidden bf_button bf_submit">Save</button>						<button id="approve-thumbs" class="hidden bf_button bf_submit">Looks Good!</button>					</li>					<li><input id="image-cancel" type="button" class="bf_button grey" value="Cancel" /></li>				</ul>			</div>		</div>',preview_template:'<div id="preview" class="preview hidden"></div>',uploader_template:'		<div id="uploader_container">			<p class="upload-desc">Select an image to use for your post. After uploading you\'ll be able to crop and resize your thumbnail image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<img id="ul-spinner" src="#{static_root}/images/public/spinners/big_on_eee.gif" width="48" height="48" />			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<fieldset>				<div>Thumbnail</div>				<div id="result" class="results"><div class="scroller"><img id="result-image" rel:width="300" rel:height="45" />&nbsp;</div></div>				<button id="crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>		</div>',setDefaults:function(){},fitToScreen:function(){},initialize:function(b){try{var a=this;this.options={cropper_class:"",fitImageAndScreen:false,showThumbs:true,showPreview:true,showCropper:true,minHeight:null,minWidth:null,enforceMin:false,maxHeight:null,maxWidth:null,enforceMax:false,modalIsParent:false,controller:"/bfcgi/_edit_quickpost_image",session_key:BFW_Util.getCookie(BFW_COOKIE),action:"imageupload"};Object.extend(this.options,b);this.uploader_params={session_key:this.options.session_key,action:this.options.action};this.regions={"default":false};this.setDefaults();this.container=$(b.container);this.container.update((new Template(this.template)).evaluate({cropper_class:this.options.cropper_class,static_root:BF_STATIC.static_root,uploader_template:(new Template(this.uploader_template)).evaluate({static_root:BF_STATIC.static_root}),preview_template:(new Template(this.preview_template)).evaluate({static_root:BF_STATIC.static_root}),thumbs_template:(new Template(this.thumbs_template)).evaluate({static_root:BF_STATIC.static_root})}));if(this.options.modalIsParent){this.container=$(this.container.parentNode)}this.uploader_container=$$("#"+this.container.id+" #uploader_container")[0];this.cropper_container=$$("#"+this.container.id+" #cropper_container")[0];this.cropper_instance=null;this.preview_button=$$("#"+this.container.id+" #preview-thumbs")[0];this.approve_button=$$("#"+this.container.id+" #approve-thumbs")[0];this.save_button=$$("#"+this.container.id+" #save-image")[0];this.cancel_button=$$("#"+this.container.id+" #image-cancel")[0];this.uploader_element=$$("#"+this.container.id+" #uploader")[0];this.image_element=$$("#"+this.container.id+" #image")[0];this.preview_button.observe("click",this.preview_image.bind(this));this.approve_button.stopObserving("click");this.approve_button.observe("click",this.approve_image.bind(this));this.save_button.observe("click",this.save_image.bind(this));this.cancel_button.observe("click",this.cancel_image.bind(this));this.error_title="";this.error_message="";this.init_uploader();this.cropper_container.addClassName("hidden");this.uploader_container.select(".upload-error, upload-status").each(function(d){d.addClassName("hidden")});$("uploader").removeClassName("hidden");if(this.options.image_data){this.onComplete(0,b.image_data.image,b.image_data)}}catch(c){this.close();alert("Unknown error occured. Please try again later.");console.dir(c);console.trace()}},preview_image:function(){try{this.container.scrollTo();this.container.removeClassName("upload").removeClassName("crop").addClassName("thumbs");this.cropper_container.select(".container")[0].addClassName("hidden");$("thumbs").removeClassName("hidden");if(this.options.showThumbs){this.approve_button.removeClassName("hidden")}else{this.save_button.removeClassName("hidden")}this.preview_button.addClassName("hidden");this.show_thumbs()}catch(a){console.error(a)}},show_thumbs:function(){var a=this;var b=this.image_element;$("result-image").each(function(g){var h=a.regions["default"];g.up(".scroller").style.width=g.getAttribute("rel:width")+"px";g.up(".scroller").style.height=g.getAttribute("rel:height")+"px";var d=g.getAttribute("rel:width")*1;var i=g.getAttribute("rel:height")*1;var e=Math.round(a.image_data.width*d/h.width);var c=Math.round(h.left*d/h.width);var j=Math.round(i*h.top/h.height);g.src=b.src;g.style.margin="-"+j+"px 0 0 -"+c+"px";g.style.width=e+"px";var f=g.up("fieldset").select("button")[0];f.stopObserving("click");f.observe("click",function(){$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(a))})},approve_image:function(a){},save_image:function(a){},cancel_image:function(a){a.stop()},init_uploader:function(){try{this.uploader=new qq.FileUploader({sendAsForm:true,element:this.uploader_element,action:this.options.controller,allowedExtensions:["jpg","jpeg","png","gif"],sizeLimit:BF_MAX_UPLOAD,params:this.uploader_params,onValidate:this.onValidate.bind(this),onProgress:this.onProgress.bind(this),onError:this.onError.bind(this),onComplete:this.onComplete.bind(this)})}catch(a){console.error(a)}},check_image:function(a){try{if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="Small image";b.select(".cerror-message")[0].innerHTML=this.error_message="This image is too small, we need at least "+this.options.minWidth+"x"+this.options.minHeight;return false}return true}catch(c){console.error(c)}},init_cropper:function(){try{this.container.scrollTo();this.cropper_container.select(".container")[0].removeClassName("hidden");if(this.options.showThumbs){this.preview_button.removeClassName("hidden")}else{this.save_button.removeClassName("hidden")}if(this.cropper_instance){this.cropper_instance.remove();delete this.cropper_instance}var c={x1:0,y1:0,x2:this.options.minWidth,y2:this.options.minHeight};var b={autoIncludeCSS:true,displayOnInit:true,onloadCoords:c,ratioDim:{x:this.options.minWidth,y:this.options.minHeight},minWidth:this.options.minWidth,minHeight:this.options.minHeight,maxWidth:this.options.maxWidth,maxHeight:this.options.maxHeight,onEndCrop:this.crop_done.bind(this),captureKeys:false};this.customize_cropper(b);this.cropper_instance=new Cropper.Img(this.image_element,b);if(this.options.fitImageAndScreen){this.fitToScreen()}if($(this.container).down("#image")!==this.cropper_instance.img){this.close();(new BF_Request()).alert("Error: Unknown error occurred.<br>Please save your work, reload page and try upload image again.")}}catch(a){console.dir(a);console.trace()}},customize_cropper:function(b){try{var c=b.onloadCoords;if(this.regions["default"]){c.x1=this.regions["default"].left;c.y1=this.regions["default"].top;c.x2=this.regions["default"].left+this.regions["default"].width;c.y2=this.regions["default"].top+this.regions["default"].height}b.onloadCoords=c}catch(a){console.error(a)}},crop_default_size:function(){},crop_done:function(b,a){try{this.regions["default"]={top:b.y1,left:b.x1,height:b.y2-b.y1,width:b.x2-b.x1,image:this.image_element.src}}catch(c){console.error(c)}},onValidate:function(a){try{var d=this.uploader_container.select(".upload-error")[0];if(a.size>BF_MAX_UPLOAD){d.removeClassName("hidden");d.select(".error-title")[0].innerHTML="Too big file";d.select(".cerror-message")[0].innerHTML="Max image upload size is "+BF_MAX_UPLOAD_TEXT}else{$("uploader").addClassName("hidden");d.addClassName("hidden");var c=this.container.select(".upload-status")[0];c.removeClassName("hidden");var c=this.uploader_container.select(".upload-status div.red")[0];c.style.width="0px"}}catch(b){console.error(b)}},onProgress:function(a,d,f,c){try{var g=f;var j=c;var i=Math.round((g/j)*100);var b=this.uploader_container.select(".upload-status div.red")[0];b.style.width=(this.uploader_container.select(".upload-status div.text")[0].getWidth()/100*i)+"px"}catch(h){}},onError:function(e,d,a){$("uploader").removeClassName("hidden");var c="A critical error occurred while trying to upload the picture. Please try again in a few minutes.";if(a){c=a}var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML="Error occured";b.select(".cerror-message")[0].innerHTML=c},onComplete:function(h,g,f){try{this.container.removeClassName("thumbs").removeClassName("upload").addClassName("crop");this.uploader_container.select(".upload-status")[0].addClassName("hidden");this.uploader_element.removeClassName("hidden");this.image_data=f;if(!this.check_image(this.image_data)){if(this.options.callbacks&&this.options.callbacks.image_error){this.options.callbacks.image_error(this.error_title,this.error_message)}return false}else{this.uploader_container.addClassName("hidden");this.cropper_container.removeClassName("hidden");var d=this.image_element;if(Prototype.Browser.IE){var a=this;d.onload=function(){setTimeout(function(){a.image_element.onload=null;a.image_element.src=a.image_element.src},500)}}d.src=bf_ir+this.image_data.image+"?"+(new Date).getTime();d.width=this.image_data.width;d.height=this.image_data.height;d.removeClassName("hidden");if(!this.options.showCropper){this.crop_default_size()}else{if(f.crop_data){for(var c in f.crop_data){this.regions[c]=f.crop_data[c];this["manual_"+c]=true}this.preview_image()}else{if(Prototype.Browser.IE){setTimeout(function(){this.init_cropper()}.bind(this),1000)}else{this.init_cropper()}}}}}catch(b){console.error(b)}},close:function(){BF_UI.closeDialog("user-image-edit");BF_UI.closeDialog("super-image-edit");BF_UI.closeDialog("modal-super-image-edit");if(this.preview_button){this.preview_button.addClassName("hidden")}if(this.save_button){this.save_button.addClassName("hidden")}if(this.approve_button){this.approve_button.addClassName("hidden")}}});BF_SETTINGS_CROPPER=Class.create(BF_IMAGE_CROPPER,{uploader_template:'		<div id="uploader_container">			<div class="upload-title">Upload an Image</div>			<p class="upload-desc">Select an image to use for your profile. After uploading you\'ll be able to crop and resize your image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<img id="ul-spinner" src="#{static_root}/images/public/spinners/big_on_eee.gif" width="48" height="48" />			</div>		</div>',preview_template:'		<div id="preview" class="preview">			<div class="scroller"><img id="result-image" rel:width="83" rel:height="83" />&nbsp;</div>		</div>',setDefaults:function(){var a={cropper_class:"settings",showThumbs:false,showPreview:true,showCropper:true,minWidth:83,minHeight:83};if(this.options.origin=="custom_user_header"||this.options.origin=="custom_user_channel_header"||this.options.origin=="bgimage"){a.showCropper=false}Object.extend(this.options,a);this.uploader_params={session_key:this.options.session_key,action:this.options.action,origin:this.options.origin};BF_MAX_UPLOAD=BF_MAX_UPLOAD_PROFILE;BF_MAX_UPLOAD_TEXT=BF_MAX_UPLOAD_PROFILE_TEXT},cancel_image:function(a){this.close()},save_image:function(){var a=this.regions["default"];this.options.callbacks.save_image_callback(this.image_data.image,this.image_data.name,a,null,this.options.origin);this.close()},crop_done:function(h,a){try{this.regions["default"]={top:h.y1,left:h.x1,height:h.y2-h.y1,width:h.x2-h.x1,image:this.image_element.src};var g=this.regions["default"];var b=$("result-image");b.up(".scroller").style.width=b.getAttribute("rel:width")+"px";b.up(".scroller").style.height=b.getAttribute("rel:height")+"px";var k=b.getAttribute("rel:width")*1;var c=b.getAttribute("rel:height")*1;var j=Math.round(this.image_data.width*k/g.width);var i=Math.round(g.left*k/g.width);var f=Math.round(c*g.top/g.height);b.src=this.image_element.src;b.style.margin="-"+f+"px 0 0 -"+i+"px";b.style.width=j+"px"}catch(d){console.error("If in IE - deal with it. "+d)}},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(!a.uploaded||this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="Small image";var c="This image is too small, we need at least "+this.options.minWidth+"x"+this.options.minHeight;if(!a.uploaded){c=a.message}b.select(".cerror-message")[0].innerHTML=this.error_message=c;return false}return true},crop_default_size:function(){this.regions["default"]={top:0,left:0,width:this.image_data.width,height:this.image_data.height};this.save_image()}});BF_SUPERPOST_CROPPER=Class.create(BF_IMAGE_CROPPER,{template:'		#{uploader_template}		<div id="cropper_container">			<div class="container"><img id="image" src="#{static_root}/images/public/backgrounds/trans.gif" class="hidden" /></div>			#{preview_template}			#{thumbs_template}		</div>',uploader_template:'		<div id="uploader_container">			<div class="upload-title hidden">Upload an Image</div>			<p class="upload-desc hidden">Select an image to use for your post. After uploading you&rsquo;ll be able to crop and resize your thumbnail image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<img id="ul-spinner" src="#{static_root}/images/public/spinners/big_on_eee.gif" width="48" height="48" />			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<div class="thumbs-left">				<fieldset class="normal-result">					<div class="result-header">Normal Thumbnails</div>					<div id="normal-result" class="results"><div class="scroller"><img id="normal-result-image" rel:width="125" rel:height="83" />&nbsp;</div></div>					<div id="small-result" class="results"><div class="scroller"><img id="small-result-image" rel:width="90" rel:height="60" />&nbsp;</div></div>					<button id="crop-thumb" class="bf_button">Re-crop</button>				</fieldset>				<fieldset class="wide-result">					<div class="result-header">Wide Thumbnail</div>					<div id="wide-result" class="results"><div class="scroller"><img id="wide-result-image" rel:width="355" rel:height="125" />&nbsp;</div></div>					<button id="wide-crop-thumb" class="bf_button">Re-crop</button>				</fieldset>			</div>			<div class="thumbs-right">				<fieldset class="big-result">					<div class="result-header">Big Thumbnail</div>					<div id="big-result" class="results"><div class="scroller"><img id="big-result-image" rel:width="355" rel:height="236" />&nbsp;</div></div>					<button id="big-crop-thumb" class="bf_button">Re-crop</button>				</fieldset>			</div>		</div>',setDefaults:function(){var a={cropper_class:"",fitImageAndScreen:true,modalIsParent:true,minWidth:625,minHeight:415};this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=355;this.wide_height=125;this.big_width=355;this.big_height=236;this.thumb_width=125;this.thumb_height=83;this.fitToScreenOuter=this.fitToScreen.bind(this);Event.stopObserving(window,"resize",this.fitToScreenOuter);Event.observe(window,"resize",this.fitToScreenOuter);Object.extend(this.options,a)},fitToScreen:function(){var k=$("modal-super-image-edit-container");if($$("#cropper_container .container")[0].hasClassName("hidden")){k.setStyle({width:""});k.setStyle({height:""});this.container.setStyle({width:""});this.container.setStyle({height:""})}else{var f=document.documentElement.clientWidth,a=document.documentElement.clientHeight,d=this.image_data.width,l=this.image_data.height,m=parseInt(this.container.getStyle("width")),g=parseInt(this.container.getStyle("height")),c=20,i=20,h=50,e=150;if(typeof this.ctw=="undefined"){this.ctw=m;this.cth=g}else{m=this.ctw;g=this.cth}var j=(a-i);if(j<500){j=500}if(j-e-i>l){j=l+e+i}var b=(f-c);if(b<400){b=400}if(g<j&&m<b){return}if(g>j){k.setStyle({height:(j-e)+"px"});this.container.setStyle({height:j+"px"})}if(m>b){k.setStyle({width:(b-h)>1064-h?1064-h:(b-h)+"px"});this.container.setStyle({width:b>1064?1064:b+"px"})}}},cancel_image:function(a){if(typeof superlist!="undefined"){superlist.redisplayPreviewIfNecessary()}$$("#parent-buzz-uploader .qq-upload-list > li").each(function(b){b.remove()});this.close();Event.stopObserving(window,"resize",this.fitToScreenOuter);if(typeof superlist!="undefined"){top.superlist.redisplayPreviewIfNecessary()}},approve_image:function(f){var g=this.regions.thumb;if(this.regions.wide){var a=this.regions.wide;g.wide_height=a.height;g.wide_width=a.width;g.wide_top=a.top;g.wide_left=a.left}if(this.regions.big){var d=this.regions.big;g.big_height=d.height;g.big_width=d.width;g.big_top=d.top;g.big_left=d.left}bf_boost_manager.save_image(this.image_data.image,this.image_data.name,g,"/buzzfeed/_edit_quickpost_image");var c=$("buzz-type");var b=(c)?c.value:"text";if(typeof this.options.callbacks!="undefined"&&typeof this.options.callbacks.finish_save_image!="undefined"){this.options.callbacks.finish_save_image(b,this)}else{user_post.save_quickpost_image(b,this)}if(top.$("original_image_crop_data")){top.$("original_image_crop_data").value=Object.toJSON(this.regions)}$$("#parent-buzz-uploader .qq-upload-list > li").each(function(e){e.remove()});Event.stopObserving(window,"resize",this.fitToScreenOuter)},customize_cropper:function(e){var f=e.onloadCoords;if(this.regions[this.current_cropping_region]){f.x1=this.regions[this.current_cropping_region].left;f.y1=this.regions[this.current_cropping_region].top;f.x2=this.regions[this.current_cropping_region].left+this.regions[this.current_cropping_region].width;f.y2=this.regions[this.current_cropping_region].top+this.regions[this.current_cropping_region].height;e.minWidth=this[this.current_cropping_region+"_width"];e.minHeight=this[this.current_cropping_region+"_height"];e.ratioDim={x:this[this.current_cropping_region+"_width"],y:this[this.current_cropping_region+"_height"]}}else{var a=this.image_data;var b=a.width/this.options.minWidth;var d=a.height/this.options.minHeight;var c=Math.min(b,d);f.x2=this.options.minWidth*c;f.y2=this.options.minHeight*c}e.onloadCoords=f},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";b.select(".cerror-message")[0].innerHTML=this.error_message="We need an image at least 625 x 415 pixels. That's as big as the box this message is in! Choose another one below, or hit cancel to try again.";return false}if(this.options.minHeight==a.height&&this.options.minWidth==a.width){this.options.showCropper=false}return true},crop_default_size:function(){this.regions.thumb={top:0,left:0,height:this.options.minHeight,width:this.options.minWidth};this.auto_big();this.auto_wide();this.approve_image()},crop_done:function(b,a){this.regions[this.current_cropping_region]={top:b.y1,left:b.x1,height:parseInt(b.y2-b.y1),width:parseInt(b.x2-b.x1),image:this.image_element.src}},auto_big:function(){var b=this.regions.thumb;var a={top:b.top,left:b.left,height:b.height,width:b.width};if(b.width<this.big_width){a.width=this.big_width;a.height=this.big_height;a.top=(b.top-parseInt((a.height-b.height)/2));a.left=(b.left-parseInt((a.width-b.width)/2));if(a.top<0){a.top=0}if(a.left<0){a.left=0}if((a.top+a.height)>this.image_data.height){a.top=this.image_data.height-a.height}if((a.left+a.width)>this.image_data.width){a.left=this.image_data.width-a.width}}this.regions.big=a},auto_wide:function(){var a=this.regions.big;var b={top:a.top,left:a.left,height:a.height,width:a.width};b.top=a.top+parseInt(a.height/3);b.height=parseInt((this.wide_height*a.width)/this.wide_width);this.regions.wide=b},show_thumbs:function(){var b=this;var c=this.image_element;if(!this.manual_big){this.auto_big()}if(!this.manual_wide){this.auto_wide()}this.cropper_container.select("#big-result-image, #wide-result-image").each(function(h){var i;if(h.id=="wide-result-image"){i=b.regions.wide}else{if(h.id=="big-result-image"){i=b.regions.big}}h.up(".scroller").style.width=h.getAttribute("rel:width")+"px";h.up(".scroller").style.height=h.getAttribute("rel:height")+"px";var e=h.getAttribute("rel:width")*1;var j=h.getAttribute("rel:height")*1;var f=Math.round(b.image_data.width*e/i.width);var d=Math.round(i.left*e/i.width);var k=Math.round(j*i.top/i.height);h.src=c.src;h.style.margin="-"+k+"px 0 0 -"+d+"px";h.style.width=f+"px";var g=h.up("fieldset").select("button")[0];g.stopObserving("click");g.observe("click",function(l){if(l.target.id=="big-crop-thumb"){this.manual_big=true;this.current_cropping_region="big"}else{this.manual_wide=true;this.current_cropping_region="wide"}$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(b))});this.cropper_container.select("#normal-result-image, #small-result-image").each(function(g){var h=b.regions.thumb;g.up(".scroller").style.width=g.getAttribute("rel:width")+"px";g.up(".scroller").style.height=g.getAttribute("rel:height")+"px";var e=g.getAttribute("rel:width")*1;var i=g.getAttribute("rel:height")*1;var f=Math.round(b.image_data.width*e/h.width);var d=Math.round(h.left*e/h.width);var j=Math.round(i*h.top/h.height);g.src=c.src;g.style.margin="-"+j+"px 0 0 -"+d+"px";g.style.width=f+"px"});var a=$("crop-thumb");a.stopObserving("click");a.observe("click",function(){this.current_cropping_region="thumb";$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(b));if(this.options.fitImageAndScreen){this.fitToScreen()}}});BF_SUPERPOST_QUIZ_CROPPER=Class.create(BF_IMAGE_CROPPER,{setDefaults:function(){var a={cropper_class:"superpost_quiz",fitImageAndScreen:true,showThumbs:false,showPreview:false,showCropper:true,minWidth:this.options.image_data.crop_width,minHeight:this.options.image_data.crop_height};Object.extend(this.options,a)},fitToScreen:function(){var e=document.documentElement.clientWidth,k=document.documentElement.clientHeight,h=this.image_data.width,m=this.image_data.height,o=parseInt(this.container.getStyle("width")),a=parseInt(this.container.getStyle("height")),f=30+0,j=30+0,v=0,i=35;if(this.container.select("#cropper_container .container")[0].hasClassName("hidden")){var c=this.container.select("#cropper_container #thumbs")[0];h=parseInt(c.getStyle("width"));m=parseInt(c.getStyle("height"))}this.container.setStyle({width:h+"px"});this.container.setAttribute("width",h);this.container.setStyle({height:m+"px"});this.container.setAttribute("height",m);o=parseInt(this.container.getStyle("width"));a=parseInt(this.container.getStyle("height"));this.container.select(".cropperbody")[0].setStyle({width:o+"px"});this.container.select(".cropperbody")[0].setStyle({height:a+"px"});var s=this.container.up(".bf_dialog_content");s.setStyle({width:(o+v)+"px"});s.setStyle({height:(a+i)+"px"});var p=this.container.up(".bf_dialog");p.setStyle({width:(o+v)+"px"});p.setStyle({height:(a+i)+"px"});var g=document.documentElement.scrollLeft,b=document.body.scrollLeft,w=document.documentElement.scrollTop,t=document.body.scrollTop;p.setStyle({left:(((e-o)/2)>0?((e-o)/2):0)+(g>b?g:b)+"px"});p.setStyle({top:(((k-a)/2)>0?((k-a)/2):0)+(w>t?w:t)+"px"});p.setStyle({marginLeft:"0px"});var l=document.documentElement.clientWidth,r=document.documentElement.clientHeight,q=document.body.clientWidth,d=document.body.clientHeight;var n=this.container.up("#super-image-edit").select(".bf_overlay_mask")[0];n.setStyle({width:(l>q?l:q)+"px"});n.setStyle({height:(r>d?r:d)+"px"})},cancel_image:function(a){a.stop();this.close()},save_image:function(a){var b=this.regions["default"];quiz_admin.image_cropper_callback(this.image_data.image,this.image_data.name,this.image_data.format,b);this.close()},customize_cropper:function(e){var f=e.onloadCoords;var a=this.image_data;var b=a.width/this.options.minWidth;var d=a.height/this.options.minHeight;var c=Math.min(b,d);f.x2=this.options.minWidth*c;f.y2=this.options.minHeight*c;e.onloadCoords=f;$("save-image").focus()},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";b.select(".cerror-message")[0].innerHTML=this.error_message="We need an image at least 170 x 170 pixels. Choose another one below, or hit cancel to try again.";return false}if(this.options.minHeight==a.height&&this.options.minWidth==a.width){this.options.showCropper=false}return true},crop_default_size:function(){this.regions["default"]={top:0,left:0,height:this.options.minHeight,width:this.options.minWidth};this.save_image()},crop_done:function(b,a){this.regions["default"]={top:b.y1,left:b.x1,height:b.y2-b.y1,width:b.x2-b.x1,image:this.image_element.src}}});BF_FLEXPRO_CROPPER=Class.create(BF_SUPERPOST_CROPPER,{template:'		<div class="cropperbody #{cropper_class}">			<div class="content">				#{uploader_template}				<div id="cropper_container">					<div class="container"><img id="image" src="#{static_root}/images/public/backgrounds/trans.gif" class="hidden" /></div>					#{preview_template}					#{thumbs_template}				</div>			</div>			<div class="bf_dialog_footer">				<ul>					<li id="save-button">						<button id="save-image" class="hidden bf_button bf_submit">Save</button>						<button id="preview-thumbs" class="hidden bf_button bf_submit">Save</button>						<button id="approve-thumbs" class="hidden bf_button bf_submit">Looks Good!</button>					</li>					<li><input id="image-cancel" type="button" class="bf_button" value="Cancel" /></li>				</ul>			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<div>Are These Thumbnails OK? <span class="help">Thumbnail images may be be used to promote your post so make sure they look good!</span></div>			<fieldset class="big-result">				<div>Big Thumbnail</div>				<div id="big-result" class="results"><div class="scroller"><img id="big-result-image" rel:width="355" rel:height="236" />&nbsp;</div></div>				<button id="big-crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>			<fieldset class="normal-result">				<div>Normal Thumbnails</div>				<div id="normal-result" class="results"><div class="scroller"><img id="normal-result-image" rel:width="125" rel:height="83" />&nbsp;</div></div>				<div id="small-result" class="results"><div class="scroller"><img id="small-result-image" rel:width="90" rel:height="60" />&nbsp;</div></div>				<button id="crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>			<fieldset class="wide-result">				<div>Wide Thumbnail</div>				<div id="wide-result" class="results"><div class="scroller"><img id="wide-result-image" rel:width="355" rel:height="125" />&nbsp;</div></div>				<button id="wide-crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>		</div>',setDefaults:function(){this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=355;this.wide_height=125;this.big_width=355;this.big_height=236;this.thumb_width=125;this.thumb_height=83;var a={cropper_class:"flexpro",fitImageAndScreen:false,minWidth:355,minHeight:236};if(this.options.minWidth){a.minWidth=this.options.minWidth}if(this.options.minHeight){a.minHeight=this.options.minHeight}if(this.options.image_data.crop_height!=this.thumb_height||this.options.image_data.crop_width!=this.thumb_width){a={cropper_class:"flexpro",fitImageAndScreen:false,showThumbs:false,showPreview:false,showCropper:true,minHeight:parseInt(this.options.image_data.crop_height),minWidth:parseInt(this.options.image_data.crop_width)}}Object.extend(this.options,a)},check_image:function(a){if(a.uploaded=="false"){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title=a.err||a.message||"Some error happened";b.select(".cerror-message")[0].innerHTML=this.error_message=a.err||a.message;return false}if(this.options.minHeight>a.height||this.options.minWidth>a.width){var b=this.uploader_container.select(".upload-error")[0];b.removeClassName("hidden");b.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";var c;if(this.options.showThumbs){c="We need an image at least 355 x 236 pixels. That's as big as the box this message is in! Choose another one below, or hit cancel to try again."}else{c="We need an image at least "+this.options.image_data.crop_width+" x "+this.options.image_data.crop_height+" pixels. Choose another one below, or hit cancel to try again."}b.select(".cerror-message")[0].innerHTML=this.error_message=c;return false}if(this.options.minHeight==a.height&&this.options.minWidth==a.width){this.options.showCropper=false}return true},save_image:function(){var a=this.regions.thumb;this.options.callbacks.save_image(this.image_data.image,this.image_data.name,a,this.options.controller);this.close()},approve_image:function(){var e=this.regions.thumb;if(this.regions.wide){var a=this.regions.wide;e.wide_height=a.height;e.wide_width=a.width;e.wide_top=a.top;e.wide_left=a.left}if(this.regions.big){var d=this.regions.big;e.big_height=d.height;e.big_width=d.width;e.big_top=d.top;e.big_left=d.left}if(this.image_data&&this.image_data.original){e.original={image:this.image_data.original.image,image_width:this.image_data.original.width,height:this.image_data.original.height}}this.options.callbacks.save_image(this.image_data.image,this.image_data.name,e,parent.image_handling.controller);var c=$("buzz-type");var b=(c)?c.value:"text";this.options.callbacks.finish_save_image(b,this)},cancel_image:function(a){a.stop();$$("#parent-buzz-uploader .qq-upload-list > li").each(function(b){b.remove()});this.close();Event.stopObserving(window,"resize",this.fitToScreenOuter)},fitToScreen:function(){}});BF_OPTIMIZE_CROPPER=Class.create(BF_SUPERPOST_CROPPER,{fitToScreen:function(){},approve_image:function(c){var d=this.regions.thumb;if(this.regions.wide){var a=this.regions.wide;d.wide_height=a.height;d.wide_width=a.width;d.wide_top=a.top;d.wide_left=a.left}if(this.regions.big){var b=this.regions.big;d.big_height=b.height;d.big_width=b.width;d.big_top=b.top;d.big_left=b.left}if(this.options.image_data.image){d.image=this.options.image_data.image;if(this.options.subid){d.subid=this.options.subid}if(this.options.promoid){d.promoid=this.options.promoid}}if(d.subid){optimize.update_cropping(d)}else{if(d.promoid){optimize.update_cropping_in_progress(d)}}this.cancel_image()}});BF_PicksController=function(){this.controller="/buzzfeed/_picks";this.switchuser_list=new Template('<option class="pick_switch_user" rel:data="#{user.id}">#{user.display_name}</option>');this.init=function(){if(BF_STATIC&&BF_STATIC.page&&BF_STATIC.page.match(/Home/)){return true}if(window.location.pathname.match(/\/submit\/\w+/)){this.init_submissions()}else{var user_info=(new BF_User()).getUserInfo();$$(".make_pick").each(function(el){el.show();el.observe("click",picks_controller.launch_pick)});if($("pick-buzz-button")){$("pick-buzz-button").observe("click",picks_controller.pick)}if($("pick-buzz-cancel-button")){$("pick-buzz-cancel-button").observe("click",function(e){var buzz_id=$("pick-buzz-button").getAttribute("rel:buzz_id");if(buzz_id){if($(buzz_id+"-accept_pick-spinner")){$(buzz_id+"-accept_pick-spinner").hide()}if($(buzz_id+"-make_pick-add")){$(buzz_id+"-make_pick-add").show()}if($(buzz_id+"-make_pick-success")){$(buzz_id+"-make_pick-success").hide()}if($(buzz_id+"-make_pick-spinner")){$(buzz_id+"-make_pick-spinner").hide()}}})}$$(".microsite-name").each(function(el){el.update(user_info.display_name)});var page=(document.location.pathname.split("/")).pop();if(page==user_info.username){if($("pending-submissions-notice")){$("pending-submissions-notice").show()}$$(".delete_pick").each(function(el){$(el.parentNode).show();el.show();el.observe("click",picks_controller.delete_pick)});if(document.location.pathname.match(/\/submissions\//)){$$(".accept_pick").each(function(el){el.show();el.observe("click",picks_controller.launch_pick_accept)});$$(".delete-pick").each(function(el){el.removeClassName("delete-pick");el.addClassName("accept-pick")})}else{$$(".edit_pick").each(function(el){el.show();el.observe("click",picks_controller.launch_pick_edit)});$$(".add-pick").each(function(el){var data=eval("("+el.getAttribute("data")+")");if(data!=null&&data.username==user_info.username){$(el.parentNode).hide();el.hide()}else{el.addClassName("edit-pick")}})}}else{$$(".add-pick").each(function(el){var data=eval("("+el.getAttribute("rel:data")+")");if(data&&data.username==user_info.username){$(el.parentNode).hide();el.hide()}})}}};this.init_submissions=function(){picks_controller.add_microsite_id=function(obj){obj.submit_to_microsite=($("contest-entry-form")&&$("contest-entry-form").getAttribute("rel:submit_to_microsite"))};picks_controller.save_image=function(path,image,region,sendTo){var params=region;if(typeof sendTo=="undefined"){sendTo="/buzzfeed/_edit_user_image"}else{params.type=$("buzz-type").value+"buzz"}if($("user-loading")){$("user-loading").show()}$("user-image-edit").hide();params.image=path.replace(/\.(jpg|gif)$/,"");params.action="imagecrop";var sr=function(resp){picks_controller.image_saved(resp)};var er=function(){contest_manager.error()};var ajax=new BF_Request();ajax.request(sendTo,{method:"post",parameters:params,onSuccess:sr,onFailure:er})};picks_controller.image_saved=function(resp){if($("user-loading")){$("user-loading").hide()}var obj=eval("("+resp.responseText+")");if(obj.saved){if($("quickpost-enhanced-image-file")){$("quickpost-enhanced-image-file").value=obj.thumb_image}if($("quickpost-embed-image-file")){$("quickpost-embed-image-file").value=obj.thumb_image}if($("quickpost-link-image-file")){$("quickpost-link-image-file").value=obj.thumb_image}if($("quickpost-quiz-image-file")){$("quickpost-quiz-image-file").value=obj.thumb_image}if($("quickpost-video-image-file")){$("quickpost-video-image-file").value=obj.thumb_image}if($("quickpost-image-image-thumb")){$("quickpost-image-image-thumb").value=obj.thumb_image}if($("quickpost-image-image-file")){$("quickpost-image-image-file").value=obj.large_image}if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+obj.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+obj.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+obj.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+obj.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+obj.thumb_image;$("image-preview").show();$("image-preview-div").show()}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+obj.thumb_image;$("quiz-thumbnail").show()}this.settings.image=obj.image}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};picks_controller.save_ok=function(data){if($("successful-entry")){$("successful-entry").show()}if($("select-quickpost-box")){$("select-quickpost-box").hide()}};user_post.init();EventManager.observe("user_post:save:success",picks_controller.save_ok);EventManager.observe("user_post:save:preparing",picks_controller.add_microsite_id);var user=new BF_User();if(user.isLoggedIn()){if(user.getUserInfo().terminal_user&&user.getUserInfo().terminal_user=="true"){if($("quickpost-enhanced-settings")){$("quickpost-enhanced-settings").show()}}else{if($("quickpost-enhanced-settings")){$("quickpost-enhanced-settings").hide()}}var regex=new RegExp("/submit/"+(user.getUserInfo()).username+"$");if(window.location.href.match(regex)){if($("error-div")){$("error-div").show()}}else{if($("contest-entry-form")){$("contest-entry-form").show()}}}else{if($("contest-entry-form")){$("contest-entry-form").show()}var ev=$("header-signin").fire("click");ev.signin_type="initial";ev.location="header";ev.keydown_disabled=true;ev.mousedown_disabled=true;ev.close_disabled=true;signin.open(ev)}};this.make_request=function(action,buzz_id,note,success){var params={action:action,buzz_id:buzz_id,note:note};var user_id=$("pick-buzz-button").getAttribute("rel:switch_user_id");if(typeof user_id!="undefined"&&user_id){params.user_id=user_id}if(action=="delete"&&"acl" in window&&acl.user_can("picks_delete_from_anywhere")&&BF_STATIC.tt_page=="User"&&"bf_username" in window){params.username=bf_username}var user_info=(new BF_User()).getUserInfo();if((action=="hide"||action=="show")&&(("acl" in window&&acl.user_can("partners_manage"))||bf_username==user_info.username)&&"bf_username" in window){params.username=bf_username}var ajax=new BF_Request();ajax.request(picks_controller.controller,{method:"post",parameters:params,onSuccess:success})};this._accept=function(r){var obj=eval("("+r.responseText+")");if(obj.success){var buzz_id=obj.buzz_id;if($(buzz_id+"-accept_pick-spinner")){$(buzz_id+"-accept_pick-spinner").hide()}if($("post-"+buzz_id)){$("post-"+buzz_id).appendChild(new Element("span",{"class":"this-post-was-picked"}))}if($$("#post-2111731 .accept-pick")&&$$("#post-2111731 .accept-pick")[0]){$$("#post-2111731 .accept-pick")[0].hide()}}};this.hide_pick=function(e,success){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(buzz_id){picks_controller.make_request("hide",buzz_id,"",function(r){picks_controller._delete(r);success(r)})}};this.show_pick=function(e,success){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(buzz_id){picks_controller.make_request("show",buzz_id,"",function(r){picks_controller._delete(r);success(r)})}};this.delete_pick=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if(buzz_id){if($(buzz_id+"-delete_pick-spinner")){$(buzz_id+"-delete_pick-spinner").show()}picks_controller.make_request("delete",buzz_id,"",picks_controller._delete)}};this._delete=function(r){var obj=eval("("+r.responseText+")");if(obj.success){var buzz_id=obj.buzz_id;if($(buzz_id+"-delete_pick-spinner")){$(buzz_id+"-delete_pick-spinner").hide()}if($("post-"+buzz_id)){$("post-"+buzz_id).hide()}}};this.launch_pick=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");if($("easy_rebuzz")){$("easy_rebuzz").hide()}picks_controller.start_spinner(parent);(new BF_Request()).request(picks_controller.controller,{method:"get",parameters:{buzz_id:buzz_id,action:"get_pick"},onSuccess:function(o){picks_controller.easy_rebuzz(e,o)},onFailure:function(o){$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value=""},evalJSON:true});return};this.easy_rebuzz=function(e,o){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var obj=o.responseText.evalJSON();if(typeof obj.success!="undefined"&&obj.success==1){if(typeof obj.pick!="undefined"&&obj.pick!=0){picks_controller.launch_pick_edit(e,o)}else{$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value="";if(typeof obj.users!="undefined"){var list='<select id="switchuser_select">';var i=0;for(i=0;i<obj.users.length;i++){list+=this.switchuser_list.evaluate({user:obj.users[i]})}list+="</select>";if(i>0&&$("rebuzz_switchuser_list")){$("rebuzz_switchuser_list").update(list);if($("easy_rebuzz")){$("easy_rebuzz").show()}if($("switchuser_select")){$("switchuser_select").observe("change",function(e){e.stop();$$(".pick_switch_user").each(function(el){if(el.selected){var switch_user_id=el.getAttribute("rel:data");if(typeof switch_user_id!=undefined&&switch_user_id){picks_controller.choose_user(switch_user_id)}}})})}}}}}else{$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value=""}};this.launch_pick_edit=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");$("pick-buzz-button").value="Update Note";$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","update_note");$("pick_note").value="";$("pick_note").disabled=true;var pick_edit=function(o){$("pick_note").disabled=false;var obj=o.responseText.evalJSON();$("pick_note").value=BF_UI.renderEntities(obj.pick.note);if(obj.pick.is_pick==2&&obj.pick.pending_acceptance==1){$("pick-buzz-button").setAttribute("rel:action","accept_pick");$("pick-buzz-button").value="Accept Buzz"}};if(arguments[1]){pick_edit(arguments[1])}else{(new BF_Request()).request(picks_controller.controller,{method:"get",parameters:{buzz_id:buzz_id,action:"get_pick"},onSuccess:pick_edit,evalJSON:true})}BF_UI.showDialog("pick_dialog","Edit Your Note")};this.launch_pick_accept=function(e){e.stop();var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");$("pick-buzz-button").value="Accept Buzz";$("pick-buzz-button").setAttribute("rel:buzz_id",buzz_id);$("pick-buzz-button").setAttribute("rel:action","accept");BF_UI.showDialog("pick_dialog","Accept a Submission")};this.choose_user=function(user_id){$("pick-buzz-button").setAttribute("rel:switch_user_id",user_id)};this.pick=function(e){e.stop();BF_UI.closeDialog("pick_dialog");var target=e.target;var parent=target;while(parent.parentNode&&!parent.getAttribute("rel:buzz_id")){parent=parent.parentNode}var buzz_id=parent.getAttribute("rel:buzz_id");var action=$("pick-buzz-button").getAttribute("rel:action");var callback=picks_controller._pick;if(!action){action="pick"}if(action=="update_note"){var note=$$("#post-"+buzz_id+" .buzznote .what").first();if(note){note.update($F("pick_note").replace(/</g,"&lt;").replace(/>/g,"&gt;"));$$("#post-"+buzz_id+" .buzznote").first().show()}}else{if(action=="accept"){callback=picks_controller._accept}else{if(action=="accept_pick"){action="accept"}}}if(buzz_id){picks_controller.make_request(action,buzz_id,$F("pick_note"),callback);picks_controller.start_spinner(parent)}};this._pick=function(r){var obj=eval("("+r.responseText+")");if(obj.success){var buzz_id=obj.buzz_id;picks_controller.stop_spinner();var user=new BF_User();if(user.isLoggedIn()){var username=(user.getUserInfo()).username;var your_feed="your Feed";if(typeof obj.username!="undefined"&&obj.username&&username!=obj.username){your_feed+=" (/"+obj.username+")";username=obj.username}if($("social_message-rebuzz")){$("social_message-rebuzz").update('<h5><span class="highlight">Rebuzzed!</span> This post has been added to <a href="'+(BF_STATIC?BF_STATIC.web_root:"")+"/"+username+'/">'+your_feed+"</a></h5>");$("social_message-rebuzz").show()}}gtrack.track_events("","share/rebuzz","")}else{picks_controller.stop_spinner()}};this.stop_spinner=function(){$$(".rebuzz_icon.busy").each(function(e){$(e).removeClassName("busy")})};this.start_spinner=function(parent){var icon=parent.select(".rebuzz_icon");if(icon&&icon.length){icon.first().addClassName("busy")}}};var BoostManager=function(){this.BOOST_DIALOG_ID="bf_boost_dialog";this.BOOST_CALCULATE_CPM_PAGE="/buzzfeed/calculate_cpm";this.BOOST_SUBMIT_PAYMENT="/buzzfeed/buzzboost";this.REGISTER_AND_BOOST_SUBMIT_PAYMENT="/buzzfeed/_temp_wrapper";this.type="paypal";this.preview_data={blurb:"",campaignid:"",display_name:"",form:"",full_uri:"",image:"",name:"",position:"",uri:"",userid:"",username:"",user_image:""};this.pause=function(args){var params={action:"pause",ad_multiboost_id:args.ad_multiboost_id};var spinner=args.element.previous(".boost_spinner");spinner.show();args.element.hide();var sr=function(){args.element.siblings().each(function(el){el.show()});spinner.hide();var el=args.element.up("li");if(el&&el.hasClassName("running")){el.removeClassName("running");el.addClassName("paused")}};var ajax=new BF_Request();ajax.request("/buzzfeed/buzzboost",{method:"get",parameters:params,onSuccess:sr})};this.unpause=function(args){var params={action:"unpause",ad_multiboost_id:args.ad_multiboost_id};var spinner=args.element.previous(".boost_spinner");spinner.show();args.element.hide();var sr=function(){args.element.siblings().each(function(el){el.show()});spinner.hide();var el=args.element.up("li");if(el&&el.hasClassName("paused")){el.removeClassName("paused");el.addClassName("running")}};var ajax=new BF_Request();ajax.request("/buzzfeed/buzzboost",{method:"get",parameters:params,onSuccess:sr})};this.init=function(args){if(!acl.user_can("can_boost")){return}if(args.dialog){this.init_dialog(args)}else{if(args.create_post){this.init_create_post(args)}else{universal_dom.assign_handler({bucket:"boostable",event:"click",handler:bf_boost_manager.load_boost_dialog});universal_dom.assign_handler({bucket:"unpause",event:"click",handler:bf_boost_manager.unpause});universal_dom.assign_handler({bucket:"pause",event:"click",handler:bf_boost_manager.pause});universal_dom.get_bucket_elements("boostable").each(function(el){var data=el.getAttribute("rel:bf_data");if(data){try{var obj=eval("("+data+")");var user_id=parseInt(obj.user_id);el.removeClassName("hidden");el.parentNode.removeClassName("hidden")}catch(e){}}});if(acl.user_can("boost_admin")){$$(".admin-user-field").each(function(e){e.show()})}$$(".payment-type").each(function(e){e.observe("click",function(event){bf_boost_manager.toggle_payment()})})}}};this.init_dialog=function(args){};this.init_create_post=function(args){if(window.location.href.match(/\/boost(2)?/)){return}bf_login.init();user_post.init();user_post.CONTRIBUTE_URL="/buzzfeed/_temp_wrapper";user_post.ENHANCED_URL="/buzzfeed/_temp_wrapper";EventManager.observe("user_post:save:preparing",function(data){data.action="save_quickpost";data.anonymous=true});EventManager.observe("user_post:create:opening_form",bf_boost_manager.listen_for_enhanced);EventManager.observe("user_post:save:success",bf_boost_manager.save_ok);if($("facebook_post_to_fanpage_dialog")){$("facebook_post_to_fanpage_dialog").addClassName("hidden")}if($("quickpost-save-as-draft")){$("quickpost-save-as-draft").addClassName("hidden")}EventManager.observe("user_post:create:opening_form",bf_boost_manager.setup_preview);user_setting={save_image:bf_boost_manager.save_image}};this.setup_preview=function(args){var which_template=args.buzz_type=="link"?"preview-link-template":"preview-common-template";var template=$(which_template).innerHTML;template=template.replace(/%7B/g,"{");template=template.replace(/%7D/g,"}");bf_boost_manager.preview_template=new Template(template);var user=new BF_User();var data;if(user.isLoggedIn()){data=user.getUserInfo();if(!data.display_name){data.display_name=data.username}data.user_image=data.image||"/static/images/public/defaults/user.jpg";data.name="Your Title Here!";data.link_buzz="example.com";data.blurb="Your description here.";data.image=BF_STATIC.image_root+"/static/images/public/defaults/thumb.png"}else{data={display_name:"You!",username:"anonymous",userid:0,blurb:"Your description here.",user_image:"/static/images/public/defaults/user.jpg",image:BF_STATIC.image_root+"/static/images/public/defaults/thumb.png",name:"Your Title Here!",link_buzz:"example.com"}}data.form=args.buzz_type;bf_boost_manager.update_preview(data);$("quickpost-title").observe("keyup",function(e){bf_boost_manager.update_preview({name:TT_Filters.html(e.target.value.substr(0,65))})});$("quickpost-description").observe("keyup",function(e){bf_boost_manager.update_preview({blurb:TT_Filters.boost_preview(e.target.value.substr(0,135))})});$("quickpost-link-url").observe("keyup",function(e){bf_boost_manager.update_preview({link_buzz:TT_Filters.html(e.target.value)})});["video-link-thumbnail","image-preview","embed-thumbnail","link-thumbnail"].each(function(id){$(id).observe("load",function(e){var isrc=e.target.getAttribute("src");bf_boost_manager.update_preview({image:isrc})})})};this.update_preview=function(args){for(var each in args){bf_boost_manager.preview_data[each]=args[each]}var html=bf_boost_manager.preview_template.evaluate(bf_boost_manager.preview_data);$("preview").update(html);$$(".ad_boost_image").each(function(e){e.src=bf_boost_manager.preview_data.image});var links=$("preview").getElementsByTagName("A");for(var i=0;i<links.length;i++){links[i].setAttribute("onclick","return false")}};this.listen_for_enhanced=function(args){if(args.buzz_type=="enhanced"){var modify_url=function(c){if((typeof TopList!="undefined"&&typeof TopList.EDIT_ENHANCED_IMAGE!="undefined")||(typeof ClassifyQuiz!="undefined"&&typeof ClassifyQuiz.EDIT_ENHANCED_IMAGE!="undefined")){if(typeof TopList!="undefined"){TopList.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}if(typeof ClassifyQuiz!="undefined"){ClassifyQuiz.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}}else{if(c<40){setTimeout(function(){modify_url(c+1)},250)}else{alert("We are unable to process your request at this time")}}};modify_url(0)}};this.save_image=function(path,image,region,sendTo){var params=region;if(typeof sendTo=="undefined"){sendTo="/buzzfeed/_edit_user_image"}else{params.type=$("buzz-type").value+"buzz"}if($("user-loading")){$("user-loading").show()}$("user-image-edit").hide();params.image=path.replace(/\.(jpg|gif)$/,"");params.action="imagecrop";var sr=function(resp){bf_boost_manager.image_saved(resp)};var er=function(){bf_boost_manager.error()};var ajax=new BF_Request();ajax.request(sendTo,{method:"post",parameters:params,onSuccess:sr,onFailure:er})};this.image_saved=function(resp){if($("user-loading")){$("user-loading").hide()}var obj=eval("("+resp.responseText+")");if(obj.saved){if(typeof window.superlist!="undefined"){return superlist.set_parent_image(resp)}if($("quickpost-enhanced-image-file")){$("quickpost-enhanced-image-file").value=obj.thumb_image}if($("quickpost-embed-image-file")){$("quickpost-embed-image-file").value=obj.thumb_image}if($("quickpost-link-image-file")){$("quickpost-link-image-file").value=obj.thumb_image}if($("quickpost-quiz-image-file")){$("quickpost-quiz-image-file").value=obj.thumb_image}if($("quickpost-video-image-file")){$("quickpost-video-image-file").value=obj.thumb_image}if($("quickpost-image-image-thumb")){$("quickpost-image-image-thumb").value=obj.thumb_image}if($("quickpost-image-image-file")){$("quickpost-image-image-file").value=obj.large_image}if($("quickpost-super-image-file")){$("quickpost-super-image-file").value=obj.thumb_image}if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+obj.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+obj.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+obj.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+obj.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+obj.thumb_image;$("image-preview").show();if($("image-preview-div")){$("image-preview-div").show()}}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+obj.thumb_image;$("quiz-thumbnail").show()}if(!Object.isUndefined(this.settings)){this.settings.image=obj.image}}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};this.save_ok=function(args){if(args.json.updated){window.location.href=BOOST_PAYMENT_FORM+"?buzz_id="+args.json.id}};this.load_boost_dialog=function(data){if(!acl.user_can("can_boost")){return}var onload=function(){var bf_boost_manager=new top.BoostManager();bf_boost_manager.init({dialog:true})};if(!"multiboost" in window){return}multiboost.get_boosts_setup();var url="boost_modal/select_tier",w=800,h=525;if(multiboost.has_active_multiboost()){if(multiboost.has_added_buzz(data.buzz_id)){url="boost_modal/already_added";h=205}else{if(multiboost.has_room_for_more_boosts()){url="boost_modal/add_it";h=190;multiboost.add_buzz_to_boost_list({campaignid:data.buzz_id})}else{if(multiboost.tier_id<3){url="boost_modal/upgrade";h=250}else{url="boost_modal/no_more_room";h=260}}}}BF_UI.create_or_show_dialog({width:w,height:h,scrolling:"no",title:"Boost This!",id:bf_boost_manager.BOOST_DIALOG_ID,url:"/buzzfeed/"+url+"?buzz_id="+data.buzz_id+"&cb="+(new Date()).getTime(),onload:[onload]})};this.toggle_payment=function(){var payment_type=$$("input[name=type]:checked").first().value,rate=multiboost.tier.default_rate;var spend="25";this.type=payment_type;if(payment_type=="paypal"||payment_type=="paypal_account"){spend="95"}if(payment_type=="coupon"){$("submit").value="Boost It";$$(".cc-data-field").each(function(e){e.hide()});$$(".admin-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.show()});var minimum_impressions=multiboost.commify(parseInt(parseInt(spend)/rate,10));universal_dom.get_bucket_elements("minimum_impressions").each(function(el){el.update(minimum_impressions)})}else{if(payment_type=="admin"){$("submit").value="Boost It";$$(".cc-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".admin-data-field").each(function(e){e.show()});if($("spend-paypal").value){$("admin-spend").value=$("spend-paypal").value}}else{if(payment_type=="paypal"){$("submit").value="Charge My Card";$$(".admin-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".cc-data-field").each(function(e){e.show()})}else{$("submit").value="Pay with Paypal";$$(".admin-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".cc-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.show()})}}}};this.submit=function(args){try{for(var key in args){args[key]=args[key].toString().strip()}if(args.city=="City"){args.city=""}if(args.coupon_id=="Coupon Code"){args.coupon_id=""}if(args.first_name=="First Name"){args.first_name=""}if(args.last_name=="Last Name"){args.last_name=""}if(args.street=="Street Address"){args.street=""}if(args.zip=="Zip Code"){args.zip=""}if(args.cc_type=="unknown"){args.cc_type=""}if(this.type=="coupon"&&args.coupon_id==""){$("error-dialog").update("Please enter a Coupon Code");$("error-dialog").removeClassName("hidden");$("error-dialog").addClassName("error");return}if(this.type=="admin"){args.amount=$F("admin-spend");args.admin_boost=1}if($("spinner")&&$("payment_form")){$("spinner").removeClassName("hidden");$("submit").addClassName("hidden")}if($("error-dialog")){$("error-dialog").addClassName("hidden")}if($("registration-error-dialog")){$("registration-error-dialog").addClassName("hidden")}if($("login-error-dialog")){$("login-error-dialog").addClassName("hidden")}if(bf_boost_manager.errors){bf_boost_manager.errors.each(function(detail){if(document.forms.payment.elements[detail]){document.forms.payment.elements[detail].removeClassName("error")}})}args.action="multiboost";args.type=this.type;args.amount=Math.floor(args.amount*100)/100;args.amount=args.amount.toString();var check_decimals=args.amount.split(".");if(!check_decimals[1]){check_decimals[1]="00"}else{if(check_decimals[1].length==1){check_decimals[1]+="0"}}args.amount=check_decimals.join(".");var url=bf_boost_manager.BOOST_SUBMIT_PAYMENT;if(args.register_user=="true"){url=bf_boost_manager.REGISTER_AND_BOOST_SUBMIT_PAYMENT;args.action="register_user_and_boost";var err=$("registration-error-dialog");if(args.pw.length<6){if(err){err.update("Password must be at least 6 characters");err.removeClassName("hidden");$("spinner").addClassName("hidden");$("submit").removeClassName("hidden");err.showOnScreen()}return}if(args.username.length<3||args.username.length>30){if(err){err.update("Username must be at least 3 characters and no more than 30 characters");err.removeClassName("hidden");$("spinner").addClassName("hidden");$("submit").removeClassName("hidden");err.showOnScreen()}return}}else{if(args.login_user=="true"){url=bf_boost_manager.REGISTER_AND_BOOST_SUBMIT_PAYMENT;args.action="login_user_and_boost"}}(new BF_Request).request(url,{method:"post",parameters:args,onComplete:function(r){bf_boost_manager._submit(eval("("+r.responseText+")"))}})}catch(e){console.error(e)}};this._submit=function(result){if(result.success==0){var error_dialog=$("error-dialog");if(typeof result.login!="undefined"&&!result.login){error_dialog=$("login-error-dialog");error_dialog.update("Invalid username or password");error_dialog.removeClassName("hidden");if($("spinner")&&$("payment_form")){$("spinner").addClassName("hidden");$("submit").removeClassName("hidden")}}else{if($("registration-error-dialog")&&result.error_section=="registration"){error_dialog=$("registration-error-dialog")}if($("login-error-dialog")&&result.error_section=="login"){error_dialog=$("login-error-dialog")}if($("spinner")&&$("payment_form")){$("spinner").addClassName("hidden");$("submit").removeClassName("hidden")}error_dialog.removeClassName("hidden");error_dialog.update("");var ul=document.createElement("ul");ul.appendChild(document.createTextNode(result.message));bf_boost_manager.errors=result.errors;var prepend_login=false;if("login"==result.error_section){prepend_login=true}if("registration"==result.error_section){prepend_register=true}result.errors.each(function(detail){if(detail=="username"&&prepend_login){detail="login_username"}if(detail=="email"&&prepend_register){detail="register_email"}if(detail=="cc_type"){var li=document.createElement("li");li.appendChild(document.createTextNode("Invalid Credit Card"));ul.appendChild(li)}if(document.forms.payment.elements[detail]){$(document.forms.payment.elements[detail]).addClassName("error")}else{var li=document.createElement("li");li.appendChild(document.createTextNode(detail));ul.appendChild(li)}});error_dialog.appendChild(ul)}error_dialog.showOnScreen()}else{if(result.redirect){if(!(new BF_User()).isLoggedIn()){bf_login.loggedIn(result)}window.location.href=result.redirect}else{if(result.error){var error_dialog=$("login-error-dialog");error_dialog.removeClassName("hidden");error_dialog.update("There is a problem with your account. Please contact us at support@buzzfeed.com");error_dialog.showOnScreen()}else{var extra_data=[];["first_name","last_name","street","city","state","zip"].each(function(p){extra_data.push(p+"="+result.params[p])});if(!(new BF_User()).isLoggedIn()){bf_login.loggedIn(result)}window.location.href="/buzzfeed/_boost_receipt?transaction_id="+result.transaction_id+"&buzz_id="+result.buzz_id+"&"+extra_data.join("&")}}}};this.update_expiration_date=function(f){var parts=[f.elements.month[f.elements.month.selectedIndex].value,f.elements.year[f.elements.year.selectedIndex].value];var ok=true;if(parts[0]<10){parts[0]="0"+parts[0]}else{parts[0]=""+parts[0]}parts.each(function(v){if(v==0){ok=false}});if(ok){f.elements.cc_expires.value=parts.join("")}};this.cc_checker=[{id:"AMEX",regex:new RegExp("^3")},{id:"VISA",regex:new RegExp("^4")},{id:"MASTERCARD",regex:new RegExp("^5")},{id:"DISCOVER",regex:new RegExp("^6")}];this.update_cc_type=function(cc_number,update_field,highlight_mapping){var type="unknown";bf_boost_manager.cc_checker.each(function(data){if($(highlight_mapping[data.id])){$(highlight_mapping[data.id]).removeClassName("selected")}});bf_boost_manager.cc_checker.each(function(data){if(cc_number.match(data.regex)){type=data.id;if(typeof highlight_mapping[type]!="undefined"&&$(highlight_mapping[type])){$(highlight_mapping[type]).addClassName("selected")}}});if($(update_field)){$(update_field).value=type}}};var bf_boost_manager=new BoostManager();BuzzLoader.register(function(){if(window.location.href.match(/boost_dialog/)){bf_boost_manager.init({dialog:true,url:window.location.href})}else{if(window.location.href.match(/\/boost$/)){bf_boost_manager.init({create_post:true})}else{bf_boost_manager.init({})}}},2);var BF_MultiBoost=function(){this.debug=function(msg,data){if(multiboost.debug){if(!data){data={}}data.msg=msg;console.dir(data)}};this.preview_data={blurb:"",campaignid:"",display_name:"",form:"",full_uri:"",image:"",name:"",position:"",uri:"",userid:"",username:"",user_image:""};this.boost_list=[];this.TIER_DEFINITIONS={"1":{name:"Boost",max_boosts:1,level:1,min_buy:95,max_buy:999,default_rate:0.003},"2":{name:"Optimized Boost",max_boosts:5,level:2,min_buy:1000,max_buy:4999,default_rate:0.002},"3":{name:"Big Seed",max_boosts:10,level:3,min_buy:5000,max_buy:100000,default_rate:0.002}};this.BOOST_COOKIE_NAME="bf_boost_list";this.FACEBOOK_BUZZ_AD=new Template(' 		<p class="error-message" id="error-message-#{unique_id}" style="display:none;"></p> 		<div class="fb_box c"> 		 <h3 class="bf_dom editable" rel:bf_bucket_data="{\'edit\':{\'id\':\'#{campaignid}\',\'field\':\'fb_name\'}}">#{fb_name}</h3><div id="#{campaignid}-fb_name-length" class="blurb_length headline"></div> 		 <div class="c"> 			 <div class="photo"><img src="#{image_root}#{image}" alt="" /></div> 			 <div class="info"> 				 <p class="bf_dom editable" rel:bf_bucket_data="{\'edit\':{\'id\':\'#{campaignid}\',\'field\':\'fb_blurb\'}}">#{fb_blurb}</p><div id="#{campaignid}-fb_blurb-length" class="blurb_length"></div> 				 <a rel:gtrack_id="preview/fb-ad/link" class="bf_dom" rel:bf_bucket_data="{\'edit\':{\'id\':\'#{campaignid}\',\'field\':\'fb_link_url\'}}" href="#{fb_link_url}" onclick="return false" contentEditable="true">#{fb_link_url}</a> 			 </div> 			</div>   		</div> 		<a rel:gtrack_id="preview/fb-ad/edit" class="edit button" href="javascript:;" onclick="multiboost.toggle_fb_contenteditable(this.parentNode); return false;">Edit</a> 		<a rel:gtrack_id="preview/fb-ad/preview" class="bf_dom save button" href="javascript:;" rel:bf_bucket_data="{\'fb-save\':{\'id\':\'#{campaignid}\'}}">Preview</a> 	');this.FACEBOOK_BUZZ_KEYWORDS=new Template(' 		<div class="c"> 			<div class="interests"> 			  <div class="interest_field"> 					<input rel:gtrack_id="preview/fb-ad/keywords/input" class="keyword" placeholder="Enter an interest" onkeyup="facebook.updateKeywords(\'#{unique_id}\',this.value,true)" type="text" id="kw-#{unique_id}" /> 					<input rel:gtrack_id="preview/fb-ad/keywords/search" id="search-#{unique_id}" onclick="var kw_val = $(\'kw-#{unique_id}\').value; if (kw_val && kw_val.strip() != \'\') {facebook.lookup_keywords(this.parentNode,$(\'kw-#{unique_id}\').value, \'#{unique_id}\');}" type="button" value="+" /> 					<img id="lookup-loading-#{unique_id}" style="display:none;" src="#{static_root}/images/public/spinners/small_on_white.gif" /> 			  	<p style="display:none;" id="users-reach-#{unique_id}">Keyword Reach: <span id="users-#{unique_id}">&hellip;</span></p> 				</div> 				<div style="display: none;" id="keywords-#{unique_id}" onmouseover="clearTimeout(this.hide_timeout);" onmouseout="facebook.keyword_suggest_mouseout(\'#{unique_id}\');" class="keywords_list"></div> 				<ul class="keywords" id="terms-#{unique_id}"></ul> 			</div> 		</div> 		<div class="reach" id="post-reach-#{unique_id}" style="display:none;"><strong>Estimated Reach:</strong> <span id="post-#{unique_id}">&hellip;</span></div> 	');this.COMMA_DELIMITER=/(\d)(\d\d\d)(,\d{3,})*$/;this.get_tier_from_cookie=function(){var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);var tier="1";if(obj_str){var obj=eval("("+unescape(obj_str)+")");tier=obj.tier;multiboost.select_tier({tier:tier})}return tier};this.init=function(){if(!acl.user_can("can_boost")){return}if(Prototype.Browser.IE6){$("step_crumbs").hide();$("boost_ie6_warning").removeClassName("hidden");return}try{multiboost.already_boosted=[];multiboost.buzz_cache={};multiboost.set_page({step:"select_tier"});multiboost.get_boosts_setup();multiboost.boost_search_element="search-buzz";multiboost.boost_search_spinner="search-buzz-spinner";multiboost.boost_list_preview_element="selected-buzz";multiboost.boost_list_preview_spinner="selected-buzz-spinner";multiboost.customization_table="customization-table";multiboost.update_cart_icon();if(window.location.href.match(/\/(buzz|_)?(old_)?boost(2)?(_modal)?/)){universal_dom.assign_handler({bucket:"update_field",handler:multiboost.update_field});universal_dom.assign_handler({bucket:"select-tier",event:"click",handler:multiboost.select_tier});universal_dom.assign_handler({bucket:"upgrade-tier",event:"click",handler:function(args){multiboost.select_tier({tier:multiboost.tier_id+1});if(args.choose_buzz){multiboost.choose_buzz()}if(args.customize_buzz){multiboost.customize_buzz()}}});universal_dom.assign_handler({bucket:"upgrade-tier-and-add",event:"click",handler:function(args){multiboost.select_tier({tier:multiboost.tier_id+1});multiboost.add_buzz_to_boost_list({campaignid:args.buzz_id});$("boost_modal_upgrade").hide();$("boost_modal_selected_upgrade").show();if(args.close){multiboost.start_timer(5)}}});universal_dom.assign_handler({bucket:"select-tier-and-add",event:"click",handler:function(args){multiboost.select_tier({tier:args.tier});multiboost.add_buzz_to_boost_list({campaignid:args.buzz_id});$("boost_modal_choose_tier").hide();$("boost_modal_selected_tier").show();if(args.close){multiboost.start_timer(8)}}});universal_dom.assign_handler({bucket:"confirm-removal-buzz-from-list",event:"click",handler:multiboost.confirm_removal_buzz_from_boost_list});universal_dom.assign_handler({bucket:"close-modal",event:"click",handler:function(){universal_dom.get_bucket_elements("boost-modal").each(function(el){el.hide()})}});universal_dom.assign_handler({bucket:"pull-buzz-from-list",event:"click",handler:multiboost.remove_buzz_from_boost_list});universal_dom.assign_handler({bucket:"add-buzz-to-list",event:"click",handler:multiboost.add_buzz_to_boost_list});universal_dom.assign_handler({bucket:"search-next-page",event:"click",handler:function(e){multiboost.search_page++}});universal_dom.assign_handler({bucket:"search-previous-page",event:"click",handler:function(e){multiboost.search_page--}});universal_dom.assign_handler({bucket:"user-search-input",event:"keypress",handler:function(e){if(e.keyCode==Event.KEY_RETURN){Event.stop(e);multiboost.search_page=0;multiboost.search_for_user_posts({username:$("username_search_input").value})}}});universal_dom.assign_handler({bucket:"user-search",event:"click",handler:function(e){multiboost.search_page=0;multiboost.search_for_user_posts({username:$("username_search_input").value})}});universal_dom.assign_handler({bucket:"open-search",event:"click",handler:multiboost.open_search});universal_dom.assign_handler({bucket:"change-tier",event:"click",handler:function(){multiboost.set_page({step:"select_tier"})}});universal_dom.assign_handler({bucket:"choose-buzz",event:"click",handler:multiboost.choose_buzz});universal_dom.assign_handler({bucket:"customize-buzz",event:"click",handler:multiboost.customize_buzz});universal_dom.assign_handler({bucket:"edit",event:"keyup",handler:multiboost.edit_buzz});universal_dom.assign_handler({bucket:"fb-save",event:"click",handler:function(data){multiboost.toggle_fb_contenteditable(data.element.parentNode);multiboost.edit_buzz(data)}});universal_dom.assign_handler({bucket:"set-page",event:"click",handler:multiboost.set_page});universal_dom.assign_handler({bucket:"save-buzz",event:"click",handler:function(data){data.target.form=$("edit-quickpost-form");user_post.save_quickpost(data)}});universal_dom.assign_handler({bucket:"boost_payment",event:"click",handler:multiboost.boost_payment});universal_dom.assign_handler({bucket:"update_amount",event:"blur",handler:multiboost.update_amount});universal_dom.assign_handler({bucket:"reboost",event:"click",handler:multiboost.reboost});universal_dom.assign_handler({bucket:"boost-help",event:"click",handler:multiboost.help_dialog});multiboost.refresh_boosted_buzz_preview();multiboost.search_page=1;if(window.location.href.match(/\/(buzz)?(old_)?boost(2)?/)){if(typeof(user_post)!="undefined"){user_post.init();user_post.CONTRIBUTE_URL="/buzzfeed/_temp_wrapper";user_post.ENHANCED_URL="/buzzfeed/_temp_wrapper";EventManager.observe("user_post:save:preparing",function(data){data.action="save_quickpost";data.anonymous=true;data.manual_moderation=1});EventManager.observe("user_post:create:opening_form",multiboost.listen_for_enhanced);EventManager.observe("user_post:save:success",multiboost.save_ok);EventManager.observe("user_post:create:opening_form",multiboost.setup_preview);user_setting={save_image:multiboost.save_image}}}if(typeof(facebook)!="undefined"){facebook.FB_KEYWORDS_CONTROLLER="/buzzfeed/_temp_wrapper"}if(multiboost.tier&&window.location.href.indexOf("#customize")!=-1){var timeout_incr=0,fn=function(){try{multiboost.customize_buzz()}catch(e){if(timeout_incr<=10){setTimeout(fn,250)}timeout_incr++}};fn()}}}catch(e){}};this.get_boosts_setup=function(){multiboost.boost_list=multiboost.load_boost_list();multiboost.tier_id=multiboost.get_tier_from_cookie();multiboost.tier=multiboost.TIER_DEFINITIONS[multiboost.tier_id]};this.contact_customer_service=function(){var user=new top.BF_User();return window.location.href.indexOf("/old_boost")!=-1&&user.isLoggedIn()&&user.getUserInfo().f_raw==0};this.commify=function(num){num=num+"";while(num.match(multiboost.COMMA_DELIMITER)){num=num.replace(multiboost.COMMA_DELIMITER,"$1,$2$3")}return num};this.reboost=function(args){if(!args.ad_multiboost_id){return}var ajax=new BF_Request();ajax.request("/buzzfeed/buzzboost",{method:"get",parameters:{action:"reboost",ad_multiboost_id:args.ad_multiboost_id}})};this.has_active_multiboost=function(){var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);return obj_str!=null};this.has_room_for_more_boosts=function(){if(!multiboost.has_active_multiboost){return false}return multiboost.tier.max_boosts-multiboost.boost_list.length};this.update_field=function(data,args){var value=eval(args.value),comma_delimiter=eval(args.comma_delimiter);if(comma_delimiter){value=multiboost.commify(value)}args.element.update(value)};this.update_amount=function(data){$("submit").removeClassName("hidden");var amount=parseInt(data.element.value,10),rate=multiboost.tier.default_rate,min_buy=multiboost.tier.min_buy,max_buy=multiboost.tier.max_buy;if(!amount||amount==NaN){amount=0}if(amount<min_buy||amount>max_buy){if($("amount-error-field")&&$("amount-error-field-text")){$("amount-error-field-text").update("Your amount must be between $"+multiboost.commify(min_buy)+" and $"+multiboost.commify(max_buy)+".");$("amount-error-field").show();$("submit").addClassName("hidden")}amount=""}else{if($("amount-error-field")){$("amount-error-field").hide()}}data.element.value=amount;var minimum_impressions=multiboost.commify(parseInt(amount/rate,10));universal_dom.get_bucket_elements("minimum_impressions").each(function(el){el.update(minimum_impressions)})};this.boost_payment=function(){var overrides={};var subsequent_punctuation=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");for(var each in multiboost.buzz_cache){var buzz=multiboost.buzz_cache[each];if(buzz.fb_blurb){buzz.fb_blurb=buzz.fb_blurb.unescapeHTML();buzz.fb_blurb=buzz.fb_blurb.replace(/<[^>]*>/g,"").substr(0,89);buzz.fb_blurb=buzz.fb_blurb.replace(/[^\w\d \.\,\!\'\"\?]/g,"");while(buzz.fb_blurb.match(subsequent_punctuation)){buzz.fb_blurb=buzz.fb_blurb.replace(subsequent_punctuation,"$1 $2")}}if(buzz.fb_name){buzz.fb_name=buzz.fb_name.unescapeHTML();buzz.fb_name=buzz.fb_name.replace(/<[^>]*>/g,"").substr(0,24);buzz.fb_name=buzz.fb_name.replace(/[^\w\d \.\,\!\'\"\?]/g,"");while(buzz.fb_name.match(subsequent_punctuation)){buzz.fb_name=buzz.fb_name.replace(subsequent_punctuation,"$1 $2")}}overrides[each]={name:multiboost.buzz_cache[each].fb_name,blurb:multiboost.buzz_cache[each].fb_blurb}}var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);obj=eval("("+unescape(obj_str)+")")||{};obj.overrides=overrides;createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON(obj)),null,".buzzfeed.com");window.location.href=BOOST_PAYMENT_FORM};this.set_page=function(args){universal_dom.get_bucket_elements("step").each(function(el){var info=el.getAttribute("rel:bf_bucket_data");var data=eval("("+info+")");el.removeClassName("selected");universal_dom.get_bucket_elements(data.step).each(function(id){id.addClassName("hidden")})});universal_dom.get_bucket_elements("step").each(function(el){var info=el.getAttribute("rel:bf_bucket_data");var data=eval("("+info+")");if(data.step==args.step){el.addClassName("selected");universal_dom.get_bucket_elements(data.step).each(function(id){id.removeClassName("hidden")})}});multiboost._retrigger_gtrack("1")};this.open_search=function(){$(multiboost.boost_search_element).update("");if(multiboost.exceeded_max_boosts()){return}else{multiboost.set_page({step:"search"})}var user=new BF_User();if(user.isLoggedIn()){universal_dom.get_bucket_elements("user-search-input").each(function(el){el.value=user.getUserInfo().username})}};this.choose_buzz=function(){multiboost.search_page=1;multiboost.set_page({step:"choose"});universal_dom.get_bucket_elements("selected-buzz-count").each(function(el){el.update(multiboost.boost_list.length)});if($("select-quickpost-box")){$("select-quickpost-box").show()}if(multiboost.boost_list&&multiboost.boost_list.length>0){universal_dom.get_bucket_elements("requires-selected-buzz").each(function(el){el.removeClassName("hidden")})}};this.setup_preview=function(args){var which_template=args.buzz_type=="link"?"preview-link-template":"preview-common-template";if(!which_template||!$(which_template)){return}var template=$(which_template).innerHTML;template=template.replace(/%7B/g,"{");template=template.replace(/%7D/g,"}");multiboost.preview_template=new Template(template);var user=new BF_User();var data;if(user.isLoggedIn()){data=user.getUserInfo();if(!data.display_name){data.display_name=data.username}data.user_image=data.user_image||"/static/images/public/defaults/user.jpg";data.name="Your Title Here!";data.link_buzz="example.com";data.blurb="Your description here.";data.image=BF_STATIC.image_root+"/static/images/public/defaults/thumb.png"}else{data={display_name:"You!",username:"anonymous",userid:0,blurb:"Your description here.",user_image:"/static/images/public/defaults/user.jpg",image:BF_STATIC.image_root+"/static/images/public/defaults/thumb.png",name:"Your Title Here!",link_buzz:"example.com"}}data.form=args.buzz_type;multiboost.update_preview(data);$("quickpost-title").observe("keyup",function(e){multiboost.update_preview({name:TT_Filters.html(e.target.value)})});$("quickpost-description").observe("keyup",function(e){multiboost.update_preview({blurb:TT_Filters.boost_preview(e.target.value)})});$("quickpost-link-url").observe("keyup",function(e){multiboost.update_preview({link_buzz:TT_Filters.html(e.target.value)})});["video-link-thumbnail","image-preview","embed-thumbnail","link-thumbnail"].each(function(id){$(id).observe("load",function(e){var isrc=e.target.getAttribute("src");multiboost.update_preview({image:isrc})})});multiboost.set_page({step:"create-buzz"})};this.update_preview=function(args){for(var each in args){multiboost.preview_data[each]=args[each]}var html=multiboost.preview_template.evaluate(multiboost.preview_data);$("preview").update(html);var links=$("preview").getElementsByTagName("A");for(var i=0;i<links.length;i++){links[i].setAttribute("onclick","return false")}};this.save_image=function(path,image,region,sendTo){var params=region;if(typeof sendTo=="undefined"){sendTo="/buzzfeed/_edit_user_image"}else{params.type=$("buzz-type").value+"buzz"}if($("user-loading")){$("user-loading").show()}$("user-image-edit").hide();params.image=path.replace(/\.(jpg|gif)$/,"");params.action="imagecrop";var sr=function(resp){multiboost.image_saved(resp)};var er=function(){multiboost.error()};var ajax=new BF_Request();ajax.request(sendTo,{method:"post",parameters:params,onSuccess:sr,onFailure:er})};this.image_saved=function(resp){if($("user-loading")){$("user-loading").hide()}var obj=eval("("+resp.responseText+")");if(obj.saved){if($("quickpost-enhanced-image-file")){$("quickpost-enhanced-image-file").value=obj.thumb_image}if($("quickpost-embed-image-file")){$("quickpost-embed-image-file").value=obj.thumb_image}if($("quickpost-link-image-file")){$("quickpost-link-image-file").value=obj.thumb_image}if($("quickpost-quiz-image-file")){$("quickpost-quiz-image-file").value=obj.thumb_image}if($("quickpost-video-image-file")){$("quickpost-video-image-file").value=obj.thumb_image}if($("quickpost-image-image-thumb")){$("quickpost-image-image-thumb").value=obj.thumb_image}if($("quickpost-image-image-file")){$("quickpost-image-image-file").value=obj.large_image}if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+obj.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+obj.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+obj.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+obj.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+obj.thumb_image;$("image-preview").show();$("image-preview-div").show()}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+obj.thumb_image;$("quiz-thumbnail").show()}this.settings.image=obj.image}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};this.save_ok=function(args){multiboost.add_buzz_to_boost_list({campaignid:args.json.id});multiboost.set_page({step:"choose"})};this.exceeded_max_boosts=function(){var exceeded=false;if(multiboost.tier&&multiboost.boost_list.length>=multiboost.tier.max_boosts){var msg="You cannot create more boosts. ";if(multiboost.tier.max_boosts<10){var next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);msg+="You can upgrade to "+(next_tier?next_tier.name:"a higher plan")+" if you want more boosts."}alert(msg);exceeded=true;window.setTimeout(multiboost.choose_buzz,250)}return exceeded};this.listen_for_enhanced=function(args){if(multiboost.exceeded_max_boosts()){return}if(args.buzz_type=="enhanced"){var modify_url=function(c){if((typeof TopList!="undefined"&&typeof TopList.EDIT_ENHANCED_IMAGE!="undefined")||(typeof ClassifyQuiz!="undefined"&&typeof ClassifyQuiz.EDIT_ENHANCED_IMAGE!="undefined")){if(typeof TopList!="undefined"){TopList.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}if(typeof ClassifyQuiz!="undefined"){ClassifyQuiz.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}}else{if(c<40){setTimeout(function(){modify_url(c+1)},250)}else{alert("We are unable to process your request at this time.")}}};modify_url(0)}};this.select_tier=function(args){if(multiboost.contact_customer_service()){alert("There is a problem with your account. Please contact support@buzzfeed.com")}else{multiboost.tier_id=args.tier;multiboost.tier=multiboost.TIER_DEFINITIONS[multiboost.tier_id];if(!multiboost.tier){return}var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME),next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);obj=eval("("+unescape(obj_str)+")")||{};if(multiboost.boost_list.length>multiboost.tier.max_boosts){multiboost.boost_list=multiboost.boost_list.splice(0,multiboost.tier.max_boosts)}createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:obj.overrides})),null,".buzzfeed.com");multiboost.refresh_boosted_buzz_preview();multiboost.choose_buzz();universal_dom.get_bucket_elements("current-tier").each(function(el){el.update(multiboost.tier.name)});universal_dom.get_bucket_elements("next-tier").each(function(el){el.update(next_tier&&next_tier.name?next_tier.name:multiboost.tier.name)});universal_dom.get_bucket_elements("max-buzz-for-tier").each(function(el){el.update(multiboost.tier.max_boosts)});if(multiboost.boost_list&&multiboost.boost_list.length>0){universal_dom.get_bucket_elements("has-no-buzz").each(function(el){el.hide()})}}};this.load_boost_list=function(){var boost_list=[];var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);if(obj_str){obj=eval("("+unescape(obj_str)+")");boost_list=obj.boosts}return boost_list};this.boost_list_upsell=function(){if(multiboost.boost_list.length>=multiboost.tier.max_boosts&&multiboost.tier.level<3){var preview_elm=$(multiboost.boost_list_preview_element);preview_elm.select(".upsell").each(function(el){el.remove()});var li=document.createElement("li"),next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);li.className="upsell preview";li.innerHTML='<div class="msg">Want to boost more posts?<br /><a href="javascript:;" rel:gtrack_id="upgrade-tier/choose" class="bf_dom" rel:bf_bucket_data="{\'upgrade-tier\':{\'choose_buzz\':true}}" onclick="return false;">Upgrade</a> to '+(next_tier?next_tier.name:"a higher plan")+".</div>";preview_elm.appendChild(li);universal_dom.update(preview_elm)}};this.already_boosted_this=function(id){alert("This buzz already has been boosted and cannot be reboosted until its current campaign finishes.");multiboost.remove_buzz_from_boost_list({id:id})};this.add_buzz_to_boost_list=function(args){if(multiboost.exceeded_max_boosts()){return}var id=args.campaignid;if(!id){multiboost.debug("add_buzz_to_boost_list requires campaignid",args)}var ok=true;multiboost.already_boosted.each(function(id){if(id==args.campaignid){multiboost.already_boosted_this(id);ok=false}});if(ok){if(multiboost.boost_list.length<multiboost.tier.max_boosts){var dup=false;multiboost.boost_list.each(function(bid){if(id==bid){dup=true}});if(!dup){multiboost.boost_list.push(id)}}var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);obj=eval("("+unescape(obj_str)+")")||{};createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:obj.overrides})),null,".buzzfeed.com");universal_dom.get_bucket_elements("selected-buzz-count").each(function(el){el.update(multiboost.boost_list.length)});universal_dom.get_bucket_elements("has-no-buzz").each(function(el){el.hide()});multiboost.refresh_boosted_buzz_preview();try{if(window!=window.top){window.top.multiboost.get_boosts_setup();window.top.multiboost.update_cart_icon()}else{multiboost.update_cart_icon()}}catch(e){}if(multiboost.boost_list.length){universal_dom.get_bucket_elements("requires-selected-buzz").each(function(el){el.removeClassName("hidden")})}}multiboost._retrigger_gtrack("2")};this.help_dialog=function(args){if(!args.article){return false}universal_dom.get_bucket_elements("boost-help-dialog").each(function(el){el.select(".article").each(function(el2){if(el2.id==args.article){el2.show()}else{el2.hide()}});el.removeClassName("hidden");el.show()})};this.confirm_removal_buzz_from_boost_list=function(args){universal_dom.get_bucket_elements("remove-buzz").each(function(el){el.args=args;universal_dom.assign_handler({bucket:"remove-buzz-button",event:"click",handler:function(e){multiboost.remove_buzz_from_boost_list(el.args);el.hide()}});el.removeClassName("hidden");el.show()})};this.remove_buzz_from_boost_list=function(args){var id=args.campaignid;if(!id){multiboost.debug("add_buzz_to_boost_list requires campaignid",args)}var list=[];multiboost.boost_list.each(function(bid){if(bid!=id){list.push(bid)}});delete multiboost.buzz_cache[id];multiboost.boost_list=list;var obj_str=readCookie(multiboost.BOOST_COOKIE_NAME);var obj=eval("("+unescape(obj_str)+")")||{};createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:obj.overrides})),null,".buzzfeed.com");universal_dom.get_bucket_elements("selected-buzz-count").each(function(el){el.update(multiboost.boost_list.length)});if(multiboost.boost_list.length==0){universal_dom.get_bucket_elements("has-no-buzz").each(function(el){el.show()})}multiboost.refresh_boosted_buzz_preview();multiboost.update_customized_buzz();try{if(window!=window.top){window.top.multiboost.get_boosts_setup();window.top.multiboost.update_cart_icon()}else{multiboost.update_cart_icon()}}catch(e){}if(multiboost.boost_list.length==0){universal_dom.get_bucket_elements("requires-selected-buzz").each(function(el){el.addClassName("hidden")})}multiboost._retrigger_gtrack("3")};this.refresh_boosted_buzz_preview=function(){if(!window.location.href.match(/\/(buzz|_)?(old_)?boost(2)?(_modal)?/)){return}if(!multiboost.tier){return}var missing_buzzes=[];multiboost.boost_list.each(function(bid){if(!multiboost.buzz_cache[bid]){missing_buzzes.push(bid)}});if(missing_buzzes.length>0){var ajax=(new BF_Request).request;ajax("/buzzfeed/_temp_wrapper",{method:"get",parameters:{action:"get_buzzes",buzz_ids:missing_buzzes.join(",")},onSuccess:multiboost._refresh_boosted_buzz_preview,while_processing:{show:multiboost.boost_list_preview_spinner,hide:multiboost.boost_list_preview_element}})}else{multiboost._refresh_buzz_preview({container:$(multiboost.boost_list_preview_element),buzz_list:multiboost.boost_list.slice(0,multiboost.tier.max_boosts).map(function(i){return multiboost.buzz_cache[i]})})}};this._refresh_boosted_buzz_preview=function(r){var obj=eval("("+r.responseText+")");obj.buzzes.each(function(buzz){multiboost.buzz_cache[buzz.campaignid]=buzz});var buzz_list=multiboost.boost_list.slice(0,multiboost.tier.max_boosts).map(function(i){return multiboost.buzz_cache[i]});multiboost._refresh_buzz_preview({container:$(multiboost.boost_list_preview_element),buzz_list:buzz_list});multiboost.update_customized_buzz()};this._refresh_buzz_preview=function(args){if(!args.container){return}var container=$(args.container),buzz_list=args.buzz_list,template_cache={},h3_regex=new RegExp("<h3>"),p_regex=new RegExp('<p class="description">');container.innerHTML="";if(buzz_list&&buzz_list.length>0){buzz_list.each(function(data){var template;if(data){data.image_root=BF_STATIC.image_root;data.user_image=data.user_image||"/static/images/public/defaults/user.jpg";if(!args.template){var templateElement=(data.form=="link"?"preview-link-template":"preview-common-template");if(!template_cache[templateElement]){template_str=$(templateElement).innerHTML;template_str=template_str.replace(/%7B/g,"{");template_str=template_str.replace(/%7D/g,"}");template_cache[templateElement]=new Template(template_str)}template=template_cache[templateElement]}else{template=args.template}data.static_root=BF_STATIC.static_root;var html=template.evaluate(data);var li=document.createElement("li");li.className="preview"+(multiboost.buzz_cache[data.campaignid]?" selected":"")+(data.boosted?" already_boosted":"");li.innerHTML=html;container.appendChild(li);try{if(data.boosted){multiboost.already_boosted.push(data.campaignid)}}catch(e){}}});var imgs=container.getElementsByTagName("img");for(var i=0;i<imgs.length;i++){$(imgs[i]).removeClassName("ad_boost_image")}}multiboost.boost_list_upsell();universal_dom.update(container)};this.search_for_user_posts=function(args){var username=args.username,ajax=(new BF_Request()).request,pagination=$$("#modal_search .pagination").first();if(username==""){return false}if(pagination){pagination.hide()}if(multiboost.search_page<1){multiboost.search_page=1}ajax("/buzzfeed/_temp_wrapper",{method:"get",parameters:{action:"recent_buzz",usernames:username,flag_boosted:1,page:multiboost.search_page},onSuccess:multiboost._search_for_user_posts,while_processing:{show:multiboost.boost_search_spinner,hide:multiboost.boost_search_element}})};this._search_for_user_posts=function(r){var obj=eval("("+r.responseText+")"),container=$(multiboost.boost_search_element),pagination=$$("#modal_search .pagination").first();if(obj.buzzes&&obj.buzzes.length>0){multiboost._refresh_buzz_preview({container:container,buzz_list:obj.buzzes});if(pagination){pagination.show()}}else{container.innerHTML='<p class="suggest">No posts were found. Please check to see if the username exists.</p>';if(pagination){pagination.hide()}}multiboost._retrigger_gtrack("5")};this.customize_buzz=function(){if(!multiboost.contact_customer_service()){multiboost.set_page({step:"customize"});multiboost.update_customized_buzz()}};this.toggle_fb_contenteditable=function(el){var contenteditable=el.hasClassName("contenteditable");el.select(".editable").each(function(elm){if(contenteditable){elm.contentEditable=false;elm.removeAttribute("contentEditable");var obj=eval("("+elm.getAttribute("rel:bf_bucket_data")+")");elm.innerHTML=multiboost.buzz_cache[obj.edit.id][obj.edit.field]}else{elm.setAttribute("contentEditable",true)}});if(contenteditable){el.removeClassName("contenteditable")}else{el.addClassName("contenteditable")}return false};this.filter_facebook_text=function(str){return str.replace(/<[^>]*>/g,"").replace(/(&rsquo;|&lsquo;)/ig,"'").replace(/(&rdquo;|&ldash;)/ig,'"').replace(/(&mdash;|&ndash;)/ig,"-").replace(/&([A-Z0-9\-\#]+);/ig,"").replace(/[^\w\d \-\;\&\.\,\!\'\"\?]/g,"")};this.update_customized_buzz=function(){var buzz_list=multiboost.boost_list.slice(0,multiboost.tier.max_boosts).reject(function(i){return(typeof(multiboost.buzz_cache[i])=="undefined")}).map(function(i){return multiboost.buzz_cache[i]});var temp=document.createElement("ul");temp.className="hidden";var fb_temp=document.createElement("ul");fb_temp.className="hidden";var kw_temp=document.createElement("ul");kw_temp.className="hidden";document.getElementsByTagName("BODY")[0].appendChild(temp);document.getElementsByTagName("BODY")[0].appendChild(fb_temp);document.getElementsByTagName("BODY")[0].appendChild(kw_temp);var subsequent_punctuation=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");buzz_list.each(function(buzz){if(!buzz){return}if(!buzz.link_url){buzz.link_url=""}if(!buzz.fb_name){buzz.fb_name=buzz.title.unescapeHTML();buzz.fb_name=multiboost.filter_facebook_text(buzz.fb_name).substr(0,24).strip();while(buzz.fb_name.match(subsequent_punctuation)){buzz.fb_name=buzz.fb_name.replace(subsequent_punctuation,"$1 $2")}}if(!buzz.fb_blurb){buzz.fb_blurb=buzz.blurb.unescapeHTML();buzz.fb_blurb=multiboost.filter_facebook_text(buzz.fb_blurb).substr(0,89).strip();while(buzz.fb_blurb.match(subsequent_punctuation)){buzz.fb_blurb=buzz.fb_blurb.replace(subsequent_punctuation,"$1 $2")}}if(!buzz.fb_link_url){buzz.fb_link_url=buzz.link_url.replace(/<[^>]*>/g,"")}buzz.unique_id=buzz.campaignid});multiboost._refresh_buzz_preview({container:temp,buzz_list:buzz_list});multiboost._refresh_buzz_preview({container:fb_temp,buzz_list:buzz_list,template:multiboost.FACEBOOK_BUZZ_AD});multiboost._refresh_buzz_preview({container:kw_temp,buzz_list:buzz_list,template:multiboost.FACEBOOK_BUZZ_KEYWORDS});boosts=temp.getElementsByTagName("LI");fbs=fb_temp.getElementsByTagName("LI");kws=kw_temp.getElementsByTagName("LI");var table=$(multiboost.customization_table);table.update("");table.addClassName("loading");for(var i=0;i<boosts.length;i++){var tr=document.createElement("tr"),td1=document.createElement("td"),td2=document.createElement("td"),td3=document.createElement("td"),td4=document.createElement("td"),td5=document.createElement("td");tr.id="preview-"+buzz_list[i].campaignid;td1.className="notice";td1.innerHTML='<div class="cellbox c"><span>&nbsp;</span></div>';tr.appendChild(td1);td2.className="boost_preview";td2.innerHTML='<div class="cellbox c">'+boosts[i].innerHTML+"</div>";tr.appendChild(td2);if(multiboost.tier.level==1){td3.className="fb_preview upsell";var next_id=(parseInt(multiboost.tier_id)+1)+"";var next_tier=(multiboost.TIER_DEFINITIONS[next_id]?multiboost.TIER_DEFINITIONS[next_id]:false);td3.colSpan=2;td3.innerHTML='<div class="cellbox c"><div class="msg"><a href="javascript:;" rel:gtrack_id="upgrade-tier/customize" class="bf_dom" rel:bf_bucket_data="{\'upgrade-tier\':{\'customize_buzz\':true}}" onclick="return false;">Upgrade</a> to '+(next_tier?next_tier.name:"a higher plan")+" for Facebook promotion. </div></div>";tr.appendChild(td3)}else{td3.className="fb_preview";if(fb_errors){if(fb_errors[buzz_list[i].campaignid]){td3.className+=" fb_err"}else{td3.className+=" fb_ok"}}td3.innerHTML='<div class="cellbox c">'+fbs[i].innerHTML+"</div>";tr.appendChild(td3);td4.className="targeting";td4.innerHTML=(multiboost.hide_targeting?"&nbsp;":'<div class="cellbox c">'+kws[i].innerHTML+"</div>");tr.appendChild(td4)}td5.className="actions";td5.innerHTML='<div class="cellbox c"><a class="bf_dom pull-it" href="" title="Remove from Campaign" onclick="return false" rel:bf_bucket_data="{\'confirm-removal-buzz-from-list\':{\'campaignid\':\''+buzz_list[i].campaignid+"'}}\"></a></div>";tr.appendChild(td5);table.appendChild(tr);if(multiboost.tier.level!=1){multiboost.toggle_fb_contenteditable($$("#preview-"+buzz_list[i].campaignid+" .fb_preview .cellbox").first())}multiboost.updateMaxLength((buzz_list[i].campaignid+"-fb_name-length"),24,buzz_list[i].fb_name.length);multiboost.updateMaxLength((buzz_list[i].campaignid+"-fb_blurb-length"),89,buzz_list[i].fb_blurb.length)}universal_dom.update(table);multiboost._retrigger_gtrack("6");table.removeClassName("loading");temp.parentNode.removeChild(temp);fb_temp.parentNode.removeChild(fb_temp);kw_temp.parentNode.removeChild(kw_temp)};this.edit_buzz=function(args){var value=args.target.innerHTML;if(args.update){value=value.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/<[^>]*>/g,"")}value=value.replace(/&nbsp;/ig," ");value=value.replace(/<br>/ig,"");var max=args.field=="fb_name"?24:89;if(value.length>max){value=value.substr(0,max)}var subsequent_punctuation=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");value=value.replace(/[^\w\d \.\,\!\']/g,"");while(value.match(subsequent_punctuation)){value=value.replace(subsequent_punctuation,"$1 $2")}multiboost.buzz_cache[args.id][args.field]=value;multiboost.buzz_cache[args.id].edited=true;$$("#preview-"+args.id+" td.notice").first().removeClassName("warning");if(args.update){multiboost.update_customized_buzz()}if(args.field=="fb_name"||args.field=="fb_blurb"){multiboost.updateMaxLength((args.id+"-"+args.field+"-length"),max,value.length)}};this.i_am_selected=function(el){while(el.tagName.toLowerCase()!="li"&&el.parentNode){el=el.parentNode}if(el.tagName.toLowerCase()=="li"){el.addClassName("selected")}};this.updateMaxLength=function(input_id,maxlen,value){var len=maxlen-value;if($(input_id)){$(input_id).update('<span class="'+(len<=5?"warning":"")+'">'+len+"</span> character"+(len==1?"":"s")+" remaining")}};this.has_added_buzz=function(id){var added=false;if(!multiboost.boost_list){multiboost.boost_list=[]}multiboost.boost_list.slice(0,multiboost.tier.max_boosts).each(function(i){if(id==i){added=true;throw $break}});return added};this.update_cart_icon=function(){if(!multiboost.tier){return}var num=(multiboost.boost_list?multiboost.boost_list.slice(0,multiboost.tier.max_boosts).length:0);universal_dom.get_bucket_elements("boost-cart").each(function(el){if(num>0){if(!el.hasClassName("boost")){el.addClassName("boost")}el.update('<a href="'+BF_STATIC.web_root+'/boost" rel:gtrack_id="utils/boost/'+num+'"><span class="text">Boost</span><span class="num">'+num+"</span></a>")}else{el.removeClassName("boost");el.update('<a rel:gtrack_id="utils/advertise" href="'+BF_STATIC.web_root+'/advertise">Advertise</a>')}var p=el.up(".has_gtrack_unit");if(p){gtrack._init(p)}})};this._retrigger_gtrack=function(str){var el=$("multiboost_container");if(el&&typeof(gtrack)!="undefined"){gtrack._init(el,{skip_impression:true})}};this.start_timer=function(s){$("modal_close_timer_seconds").update(s+" second"+(s!=1?"s":""));$("modal_close_timer").show();var modal_ct_intv=setInterval(function(){--s;$("modal_close_timer_seconds").update(s+" second"+(s!=1?"s":""));if(s<1){clearInterval(modal_ct_intv);top.BF_UI.closeDialog(bf_boost_manager.BOOST_DIALOG_ID,{})}},1000)}};var multiboost=new BF_MultiBoost();BuzzLoader.register(multiboost.init,2);var trackVideo=function(d,b,e,f){if(!e){e=""}if(!f){f=""}var h=gtrack.findCatLabel(d);var i=h?h:gtrack.tt_page;var j=$(d);var a=j[bfjs.read_attr]("src");if(!a){a=f}var g=a?(a.split("?").length>=0?a.split("?")[0].replace(new RegExp(/^http:\/\//i),"").replace(new RegExp(/^www\./i),""):""):"";var c={ready:function(){gtrack.track_events(i,e+"[nc]video:load",g,null,true)},finish:function(){gtrack.track_events(i,e+"[nc]video:end",g,null,true)},play:function(){gtrack.track_events(i,e+"[nc]video:play",g,null,true);document.fire("video:play",{playerid:d})}};if(typeof c[b]!="undefined"){c[b]()}};var VimeoTrackVideo=function(){var b=this;var a={};this.init=function(){if((bfjs.isMobile()&&$(".video-embed.vimeo").length)||(!bfjs.isMobile()&&$$(".video_vimeo").length)){if(window.addEventListener){window.addEventListener("message",b.addVideoListener,false)}else{window.attachEvent("onmessage",b.addVideoListener,false)}}};this.addVideoListener=function(g){if(typeof g.origin=="undefined"||g.origin!="http://player.vimeo.com"){return}var d=null,c=null,h=null;if(bfjs.isMobile()){d=JSON.parse(g.data);h="#"+d.player_id}else{d=g.data.evalJSON();h=d.player_id}c=$(h);if(!d||!c){return}if(d.event=="ready"){a[h]={};var f=c[bfjs.read_attr]("src").split("?")[0];if(bfjs.isMobile()){c=$(h)[0]}b.addEvent("addEventListener","play",c,f);b.addEvent("addEventListener","finish",c,f)}if(a[h]&&!a[h][d.event]){trackVideo(h,d.event);a[h][d.event]=true}};this.addEvent=function(g,f,d,c){var e={method:g};if(f){e.value=f}d.contentWindow.postMessage(JSON.stringify(e),c)};this.init()};bfjs.onPageLoad(function(){new VimeoTrackVideo()});var YT_PLAYERS={};var YoutubeTrackVideo=function(){var b=this;var a={},c={};this.init=function(){if(isIE8()){document.observe("video:dfp",function(e){var d=$(e.target.id).select("object");if(!d.length||!d[0].getAttribute("id")){return}c[d[0].getAttribute("id")]={src:e.memo.src,dfp:e.memo.dfp}})}};this.addVideoListener=function(d){a[d]={};var e=$(d).readAttribute("src"),f="";if(e==null){e=c[d].src;if(c[d].dfp){f="dfp/"}}else{if(e){f=e.match(/dfp=true/)?"dfp/":""}}this.addEvent(d,f,e)};this.getVideoTimestamp=function(d){return Math.floor($(d).getCurrentTime())};this.addEvent=function(d,g,f){var e="yt"+Math.floor(Math.random()*100000);YT_PLAYERS[e]={pollIntervalID:0,onStateChanged:function(i){var h=b.getEventType(i);if(h=="play"){if(this.pollIntervalID===0){this.pollIntervalID=setInterval(function(){var j=b.getVideoTimestamp(d);b.ad_tracking(j)},1000)}}else{if(h=="paused"||h=="finish"){clearInterval(this.pollIntervalID);this.pollIntervalID=0}}if(!a[d][i]){if(h){trackVideo(d,h,g,f)}a[d][i]=true}}};if($(d).addEventListener){$(d).addEventListener("onStateChange","YT_PLAYERS."+e+".onStateChanged",false)}else{$(d).attachEvent("onStateChange","YT_PLAYERS."+e+".onStateChanged",false)}};this.ad_tracking=function(m){var g=BF_STATIC.generated_timestamp;var d=1417409999;var o=1404172799;var i=163;var j=142;var e=BF_STATIC.campaignid=="3224023";var f=BF_STATIC.campaignid=="3208472";var l=BF_STATIC.campaignid=="3307928";var n=BF_STATIC.campaignid=="3289486";var h=0;if(typeof m!=="undefined"){h=parseInt(m,10)}if(BF_STATIC.tt_page=="Buzz"){if((f||e)&&(o>g)&&j===parseInt(m,10)){var k=document.createElement("script");k.src="http://mono.vizu.com/cdn/00/01/17/62/beacon_flyover.js?vzsid=buzzfeedproper&ord="+(Math.random()*100000000000000000);document.getElementsByTagName("head")[0].appendChild(k);if(e){trackPixel("http://ohlone.vizu.com/a.gif?vzcid=11762&vzadid=targetvideo&vzsid=buzzfeedproper&ord=[timestamp]")}}else{if(i===parseInt(m,10)&&(n||l)&&(d>g)&&i===parseInt(m,10)){var k=document.createElement("script");k.src="http://mono.vizu.com/cdn/00/01/24/04/beacon_flyover.js?vzsid=buzzfeedproper&ord="+(Math.random()*100000000000000000);document.getElementsByTagName("head")[0].appendChild(k);if(l){trackPixel("http://ohlone.vizu.com/a.gif?vzcid=12404&vzadid=friskies&vzsid=buzzfeedproper&ord=[timestamp]")}}}}};this.getEventType=function(e){var d="";switch(e){case -1:d="ready";break;case 0:d="finish";break;case 1:d="play";break;case 2:d="paused";break}return d};this.init()};var youtube_track_video=!bfjs.isMobile()?new YoutubeTrackVideo():"";function onYouTubePlayerReady(a){if(youtube_track_video){youtube_track_video.addVideoListener(a)}}var BFTestRunner=function(){this.__mock_objects={};this.called={};this.init=function(){test_runner.force_testmode_on_ajax();this.load_files([{type:"text/css",url:"http://yui.yahooapis.com/2.7.0/build/logger/assets/logger.css"},{type:"text/css",url:"http://yui.yahooapis.com/2.7.0/build/yuitest/assets/testlogger.css"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/yahoo-dom-event/yahoo-dom-event.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/logger/logger-min.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/yuitest/yuitest-min.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/yahoo/yahoo-min.js"},{type:"text/javascript",url:"http://yui.yahooapis.com/2.7.0/build/json/json-min.js"}]);this.observe("page_load:done",function(){test_runner.load_tests()});document.observe("dom:loaded",function(e){test_runner.fire_event("page_load",{})})};this.on_page=function(page){if(window.location.href.indexOf(page)!=-1){return true}else{var params=window.location.search;if(page.indexOf("?")!=-1){params=params.replace(/\?/,"&")}window.location.href=BF_STATIC.web_root+page+params}return false};this.append_to_function=function(old_fn,appendage){this.__mock_objects["special-"+old_fn]=eval(old_fn);this.mock(old_fn,function(){eval("var supr="+test_runner.__mock_objects[old_fn]);supr(eval(old_fn+".arguments"));appendage(eval(old_fn+".arguments"))})};this.force_testmode_on_ajax=function(params){if(typeof test_runner._request=="undefined"){this._request=Ajax.Request;this._request_events=Ajax.Request.Events;this.mock("Ajax.Request",function(path,params){params.parameters.testmode="on";Ajax.Request.Events=test_runner._request_events;new test_runner._request(path,params)},"special")}};this.remove_special=function(method){if(typeof this.__mock_objects[method]!="undefined"){eval(method+"="+this.__mock_objects["special-"+method])}};this.mock=function(method,fn,prefix){if(prefix){prefix+="-"}else{prefix=""}this.__mock_objects[prefix+method]=eval(method);var object_path=method.split(".");var first_word=eval(object_path[0]);if(typeof first_word=="undefined"||typeof first_word=="object"){this._mock_object(object_path,[]);object_path=method.split(".");var fn_name=object_path.pop();var obj=eval(object_path.join("."));obj[fn_name]=fn}else{if(typeof first_word=="function"&&object_path[1]){var obj=function(){};var old=first_word;for(var each in old.prototype){obj.prototype[each]=old.prototype[each]}obj.prototype[object_path[1]]=fn}}return obj};this.unmock=function(method){if(typeof test_runner.__mock_objects[method]!="undefined"){eval(method+"="+test_runner.__mock_objects[method])}};this.unmock_all=function(){for(var method in test_runner.__mock_objects){if(method.match(/^special-/)){continue}test_runner.unmock(method)}};this._mock_object=function(object_to_build,object_built){object_built.push(object_to_build.shift());var test;try{test=eval(object_built.join("."))}catch(e){var str=object_built.join(".")+" = new Object();";eval(str)}if(test=="undefined"){var str=object_built.join(".")+" = new Object();";eval(str)}if(object_to_build.length>0){this._mock_object(object_to_build,object_built)}};this._init_testmode=function(code){if(typeof test_runner=="undefined"){window.setTimeout(function(){test_runner._init_testmode(code)},200);return}test_runner.run=function(suite){code.suite=suite};code.reload_count=0;code.ajax=function(url,params){try{var response=code.suite.get_response(url,params.parameters);if(params.while_processing.show){$(params.while_processing.show).addClassName("hidden")}params.onSuccess({status:200,responseText:Object.toJSON(response)})}catch(e){if(code.reload_count++<15){window.setTimeout(function(){code.ajax(url,params)},200)}}}};this.generate_event_handler_tests=function(suite,tests){var test_case=new YAHOO.tool.TestCase({name:"Auto-generated event handler tests"});for(var handler in tests){tests[handler].each(function(btn){if(typeof btn.el!="undefined"){btn.id=btn.id||btn.el.className||btn.el.tagName}else{btn.el=$(btn.id)}test_case["test_"+btn.id+"_is_hooked_up_to_"+handler+"_handler"]=function(handler,btn){if(typeof btn.setup!="undefined"){btn.setup()}var called={};if(typeof btn.preface!="undefined"){eval(btn.preface)}test_runner.mock(handler,function(){called[handler]=true;called.arguments=arguments});if(btn.el==null){btn.el=$(btn.id)}test_runner.Assert.isObject(btn.el,"Found "+btn.id+" element on the page");test_runner.UserAction.click(btn.el);test_runner.Assert.areSame(true,called[handler],"Called "+handler+" from "+btn.el.innerHTML+" element ("+btn.id+")");if(btn.args){btn.args.each(function(expected,idx){test_runner.Assert.isDeeply(expected,called.arguments[idx],"Got expected argument in position "+idx)})}}.curry(handler,btn)})}suite.add(test_case)};this.generate_dependency_tests=function(suite,dependencies){var test_case=new YAHOO.tool.TestCase({name:"Auto-generated dependency tests"});dependencies.each(function(dependency){if(typeof dependency=="string"){test_case["test_"+dependency+"_element_id_exists"]=function(dependency){test_runner.Assert.elementIDExists(dependency)}.curry(dependency)}else{if(typeof dependency=="object"){if(dependency.test=="is_defined"){test_case["test_"+dependency.id+"_is_defined"]=function(dependency){test_runner.Assert.isObject(eval(dependency.id),dependency.id+" is loaded")}.curry(dependency)}}}});suite.add(test_case)};this.profile=function(object_name,object){test_runner.call_profile={};YAHOO.tool.TestRunner.subscribe(YAHOO.tool.TestRunner.COMPLETE_EVENT,function(){console.dir({coverage:test_runner.call_profile})});for(var each in object){if(typeof object[each]!="function"){continue}var rnd_name=each+"_"+(new Date()).getTime();object[rnd_name]=object[each];test_runner.call_profile[each]=0;object[each]=Function(object[each].argumentNames(),'test_runner.call_profile["'+each+'"]+=1;'+object_name+"."+rnd_name+"("+(object[each].argumentNames()).join(",")+")")}};var temp=BFW_Util.getCookie("bf_trace_path");this.trace_path=(temp==null)?new Array():eval("("+unescape(temp)+")");this.trace=function(object_name){var object=eval(object_name);var temp={};for(var key in object){temp[key]=object[key]}for(var each in temp){if(typeof object[each]!="function"){continue}if(object[each].toString().match(/trace_wrapper/)){continue}var rnd_name=each+"_"+(new Date()).getTime();object[rnd_name]=object[each];object[each]=Function(object[each].argumentNames(),'				var trace_wrapper = true; var __trace_context="unknown";				try{__trace_context = arguments.callee.caller.toString();}catch(e){} 				var __trace_result;					var __trace_e; 				var __log = {args:arguments,calling:"'+object_name+"."+each+'",context:__trace_context}; 				test_runner.trace_path.push(__log); 				console.dir({"calling_'+object_name+"."+each+'":__log}); 				try {					__trace_e="";					__trace_result='+object_name+"."+rnd_name+"("+(object[each].argumentNames()).join(",")+');				} catch(e){__trace_e=e}; 				__log = {error:__trace_e,_args:arguments,result:__trace_result,called:"'+object_name+"."+each+'",context:__trace_context}; 				test_runner.trace_path.push(__log); 				console.dir({"called_'+object_name+"."+each+'":__log}); 				BFW_Util.setCookie({name:"bf_trace_path",value:escape(Object.toJSON(test_runner.trace_path))}); 				if ( __trace_e != "" ) throw(__trace_e); 				return __trace_result')}};this.dump_trace=function(){var dump=window.open("","");test_runner.trace_path.each(function(entry){var str="<li>";for(var each in entry){str+="<b>"+each+"</b>: "+entry[each]+" ("+typeof entry[each]+") <br />"}str+="</li>";dump.document.writeln(str)})};this.clear_trace=function(){BFW_Util.deleteCookie("bf_trace_path");test_runner.trace_path=new Array()};this.wait_until=function(fn_timer,fn_run,deadlock_suffix){if(fn_timer()){fn_run()}else{if(!deadlock_suffix){deadlock_suffix=(new Date()).getTime();Facebook["__deadlock_"+deadlock_suffix]=0}else{if(Facebook["__deadlock_"+deadlock_suffix]++>100){fn_run()}}window.setTimeout(function(){test_runner.wait_until(fn_timer,fn_run,deadlock_suffix)},200)}};this.add=function(obj){var tr=YAHOO.tool.TestRunner;tr.add(obj)};this.run=function(suite){this._run(true,suite)};this.local_run=function(suite){this._run(false,suite)};this._run=function(post_to_server,suite){var tr=YAHOO.tool.TestRunner;tr.subscribe(tr.TEST_PASS_EVENT,test_runner.unmock_all);tr.subscribe(tr.TEST_FAIL_EVENT,test_runner.unmock_all);if(post_to_server){tr.subscribe(tr.COMPLETE_EVENT,function(results){var oReporter=new YAHOO.tool.TestReporter(BF_STATIC.web_root+"/_fixtures",YAHOO.tool.TestFormat.JSON);oReporter.report(results.results)})}var logger=new YAHOO.tool.TestLogger();if(window.location.href.match(/test_method=/i)){var params=window.location.href.split("&");params.each(function(args){if(args.match(/test_method=/i)){var trash=args.split(/=/);var test_method=trash[1];suite.items.each(function(test){for(var each in test){if(each.match(/^test_/i)&&each!=test_method){delete test[each]}}})}})}if(suite){tr.add(suite)}tr.run()};this.log_in=function(session){var default_session={session_key:"1234567812345678123456781234567812345678123456781234567812345678marcos",display_name:"Test%20User",image:"",username:"marcos",facebook_uid:"",show_account_settings:"true",registration_path:"signin",is_facebook_user:"false",terminal_user:"false",last_active:123456789,isa:"false",user_id:1234567};var obj=session?session:{};for(var key in default_session){if(typeof obj[key]=="undefined"){obj[key]=default_session[key]}}BFW_Util.setCookie({name:BFW_COOKIE,value:obj.session_key});var info_cookie="display_name="+obj.display_name;info_cookie+="&image="+obj.image;info_cookie+="&username="+obj.username;info_cookie+="&facebook_uid="+obj.facebook_uid;info_cookie+="&show_account_settings="+obj.show_account_settings;info_cookie+="&registration_path="+obj.registration_path;info_cookie+="&is_facebook_user="+obj.is_facebook_user;info_cookie+="&terminal_user="+obj.terminal_user;info_cookie+="&isa="+obj.isa;BFW_Util.setCookie({name:BFW_INFO_COOKIE,value:info_cookie})};this.log_out=function(){BFW_Util.deleteCookie(BFW_COOKIE);BFW_Util.deleteCookie(BFW_INFO_COOKIE);BFW_Util.deleteCookie(DEFAULT_USER)};this.extendAssertions=function(){test_runner.Assert=YAHOO.util.Assert;test_runner.UserAction={};for(var each in YAHOO.util.UserAction){if(each=="click"){test_runner.UserAction[each]=function(obj){if(obj.click){obj.click()}else{YAHOO.util.UserAction.click(obj)}}}else{test_runner.UserAction[each]=YAHOO.util.UserAction[each]}}test_runner.Assert.isVisible=function(id,msg){var value=$(id).visible()&&!$(id).hasClassName("hidden");test_runner.Assert.areEqual(true,value,msg?msg:id+" is visible")};test_runner.Assert.isHidden=function(id,msg){var value=$(id).visible()&&!$(id).hasClassName("hidden");test_runner.Assert.areEqual(false,value,msg?msg:id+" is hidden")};test_runner.Assert.isLike=function(str,regex,msg){test_runner.Assert.isNotNull(str.match(regex),msg?msg:str+" matches regex")};test_runner.Assert.isNotLike=function(str,regex,msg){test_runner.Assert.isNull(str.match(regex),msg?msg:str+" matches regex")};test_runner.Assert.elementIDExists=function(id,msg){test_runner.Assert.isNotNull($(id),msg?msg:id+" is on the page")};test_runner.Assert.isDeeply=function(obj1,obj2,msg){if(typeof obj1=="object"){for(var each in obj1){test_runner.Assert.isDeeply(obj1[each],obj2[each],msg)}}else{test_runner.Assert.areSame(obj1,obj2,msg)}}};this.load_tests=function(){var params=test_runner.parse_params();var tests_to_run=params.test_suite?test_runner.__test_suites[params.test_suite]():[];if(params.tests){var tests=params.tests.split(",");for(var i=0;i<tests.length;i++){tests_to_run.push(test_runner.__tests[tests[i]])}}if(params.test){tests_to_run.push(test_runner.__tests[params.test])}test_runner._wait_for_yahoo(test_runner.extendAssertions);test_runner._wait_for_yahoo(function(){test_runner.load_files(tests_to_run)})};this._wait_for_yahoo=function(fn){if(typeof this.__wait_count=="undefined"){this.__wait_count=0}else{if(this.__wait_count++>1000){alert("Took too long to load Yahoo files");return}}if(typeof YAHOO=="undefined"||typeof YAHOO.util=="undefined"||typeof YAHOO.util.UserAction=="undefined"||typeof YAHOO.util.Assert=="undefined"){window.setTimeout(function(e){test_runner._wait_for_yahoo(fn)},200)}else{fn()}};this.cookie=function(key){var cookie_arr=document.cookie.split(";");var cookie={};for(var i=0;i<cookie_arr.length;i++){var key_val=cookie_arr[i].split("=");key_val[0]=key_val[0].replace(/ /g,"");cookie[key_val[0]]=key_val[1]}return unescape(cookie[key])};this.parse_params=function(str){var params={};if(!str){str=window.location.search.substring(1)}var key_values=str.split("&");for(var i=0;i<key_values.length;i++){var data=key_values[i].split("=");if(data.length==2){params[data[0]]=data[1]}else{params[data[0]]=true}}return params};this.$=function(id){if($(id)){return $(id)}return $(test_runner.DOM_SYNONYMS[id])};this.load_files=function(files){if(typeof files=="string"){files=[{type:"text/javascript",url:files}]}for(var i=0;i<files.length;i++){var file_data=files[i];if(typeof file_data=="undefined"){continue}if(typeof file_data=="string"){file_data={type:"text/javascript",url:file_data}}if(file_data.type=="text/javascript"){this.load_javascript(file_data)}else{if(file_data.type=="text/css"){this.load_css(file_data)}else{console.error("unrecognized file type to load: "+file_data.type)}}}};this.load_javascript=function(data){var tag=document.createElement("script");tag.setAttribute("type",data.type);tag.setAttribute("src",data.url);tag.setAttribute("defer","false");if(document.getElementsByTagName("HEAD")=="undefined"){this.observe("page_load",function(){document.getElementsByTagName("HEAD")[0].appendChild(tag)})}else{document.getElementsByTagName("HEAD")[0].appendChild(tag)}};this.load_css=function(data){var tag=document.createElement("link");tag.setAttribute("rel","stylesheet");tag.setAttribute("type",data.type);tag.setAttribute("href",data.url);if(document.getElementsByTagName("HEAD")=="undefined"){this.observe("page_load",function(e){document.getElementsByTagName("HEAD")[0].appendChild(tag)})}else{document.getElementsByTagName("HEAD")[0].appendChild(tag)}};this.observe=function(ev,fn){if(!this.__EVENTS[ev]){this.__EVENTS[ev]=[]}this.__EVENTS[ev].push(fn)};this.fire_event=function(ev,args){var fns=test_runner.__EVENTS[ev]?test_runner.__EVENTS[ev]:[];for(var i=0;i<fns.length;i++){fns[i](args)}if(ev.indexOf(":done")==-1){test_runner.fire_event(ev+":done",args)}};this.__EVENTS={};this.DOM_SYNONYMS={};this.__tests={buzz_stats:"/static/js/public/test/buzz_stats.js",demo:"/static/js/public/test/demo.js",login:"/static/js/public/test/login.js",register:"/static/js/public/test/register.js",profile:"/static/js/public/test/profile.js",prepopulated_quickpost:"/static/js/public/test/prepopulated_quickpost_test.js",save_buzz:"/static/js/public/test/save_buzz_test.js",facebook2:"/static/js/public/test/facebook2_test.js",badges:"/static/js/public/test/badge_test.js",session_tracking:"/static/js/public/test/session_test.js",micro_sites:"/static/js/public/test/microsite_test.js",handler_test:"/static/js/public/test/generic_handler.js",signup:"/static/js/public/test/new_signup_page.js",settings:"/static/js/public/test/new_settings.js",quickpost:"/static/js/public/test/quickpost_test.js",dashboard:"/static/js/public/test/dashboard_test.js","dashboard-stats":"/static/js/public/test/dashboard-stats-test.js",dashboard_ad:"/static/js/public/test/dashboard_ad_test.js",dashboard_widget:"/static/js/public/test/dashboard_widget_test.js",dashboard_user_stats:"/static/js/public/test/dashboard_user_stats_test.js",realtimeweb:"/static/js/public/test/realtimeweb_test.js",user_switching:"/static/js/public/test/user_switching_test.js",user_tracking:"/static/js/public/test/user_tracking.js",user_panel:"/static/js/public/test/user_panel_test.js",universal_dom_traversal:"/static/js/public/test/universal_dom_traversal_test.js",social:"/static/js/public/test/social_test.js"};this.__test_suites={all:function(){var suite=[];for(var each in test_runner.__tests){suite.push(test_runner.__tests[each])}return suite}}};test_runner=new BFTestRunner();if(test_runner.parse_params()["testmode"]=="on"){test_runner.init()}var BF_Pixel=new (function(){var a=this;this.save=function(e){if(typeof e!="object"){return false}if(!e.hasOwnProperty("dir")){return false}var b=new Image(),d=e.hasOwnProperty("params")?e.params:{},c=a.web_path()+e.dir;d.z=Math.round((Math.random()*100000000));d="?"+a.encode_params(d);c+=d;b.setAttribute("height","1");b.setAttribute("width","1");if(BF_STATIC.env=="dev"||BF_STATIC.bf_env=="dev"){console.log("BF Pixel: "+c)}else{b.setAttribute("src",c)}return c};this.web_path=function(){if(BF_STATIC.env=="stage"||BF_STATIC.bf_env=="stage"){return"http://pixel.stage.buzzfeed.com/"}else{return"http://pixel.buzzfeed.com/"}};this.encode_params=function(d){var b=[];for(var c in d){b.push(encodeURIComponent(c)+"="+encodeURIComponent(d[c]))}return b.join("&")}})();var Carousel=function(){var b={id:"carousel",next:"cc-next",prev:"cc-prev",item:"thumbnail",items:"thumbnails",show:3};var c=function(d){for(var e=0;e<b.show;e++){d[e].removeClassName("hidden")}};var a=function(){return $$("#"+b.id+" ."+b.item+":not(.hidden)")};return{init:function(e){if(e){b=$H(b).merge(e);b=b._object}var f=this;var d=$$("#"+b.id+" ."+b.item);if(d.length>b.show){if($$("#"+b.id+" ."+b.next).length){$$("#"+b.id+" ."+b.next)[0].removeClassName("hidden");universal_dom.assign_handler({bucket:"carousel_next",event:"click",handler:f.next})}if($$("#"+b.id+" ."+b.prev).length){$$("#"+b.id+" ."+b.prev)[0].removeClassName("hidden");universal_dom.assign_handler({bucket:"carousel_prev",event:"click",handler:f.prev})}}c(d)},next:function(f){Event.stop(f);var h=a();h.each(function(i){i.addClassName("hidden")});for(var e=0;e<h.length;e++){var g=h[e];h[e].remove();$$("."+b.items)[0].insert(g)}var d=$$("#"+b.id+"  ."+b.item);for(var e=0;e<b.show&&d.length>e;e++){d[e].removeClassName("hidden")}},prev:function(g){Event.stop(g);var k=a();k.each(function(i){i.addClassName("hidden")});for(var f=k.length;f>0;f--){var h=k[f-1];k[f-1].remove();$$("."+b.items)[0].insert({top:h})}var d=$$("#"+b.id+"  ."+b.item);for(var f=d.length,e=0;e<b.show;e++,f--){d[f-1].removeClassName("hidden")}}}};var BFcarousel=Carousel();